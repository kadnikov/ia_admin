"use strict";var App=angular.module("app",["ngLocale","ngCookies","ngResource","ngSanitize","pascalprecht.translate","ui.bootstrap","ui.router","ui.utils","ui.layout","angular-growl","angularMoment","angularUtils.directives.dirPagination","schemaForm","angular-jqgrid","app.partials","app.common.config","app.common.directives","app.common.services","app.search.services","app.todo.controllers","app.todo.services","app.system.controllers","app.system.services","app.cmis.services"]);angular.module("angular-jqgrid",[]).directive("jqGrid",function(){return{restrict:"EA",template:"<table></table>",scope:{dataset:"=",options:"=",callback:"=",pager:"="},link:function(scope,element,attributes){var jqGrid=null,height=attributes.height||"100%",init=function(){var gridObj;if(void 0===scope.dataset)return gridObj;var options={};return options.data=scope.dataset,options=$.extend(!0,options,scope.options),options.height=height,gridObj=$(element.children()[0]).jqGrid(options),scope.callback&&scope.callback(gridObj),gridObj};$(window).on("resize",function(){var parentElement=angular.element(element).parent();jqGrid.setGridWidth(parentElement.width())});var onOptionsChanged=function(){jqGrid=init()},unwatchOptions=scope.$watch("options",onOptionsChanged,!0),onDatasetChanged=function(dataset){var startDataChanged=(new Date).getTime();if(jqGrid){if(jqGrid.jqGrid("clearGridData"),jqGrid.get(0).p.treeGrid){var perfTime=(new Date).getTime();jqGrid.get(0).addJSONData({rows:dataset}),console.log("addJSONData : ",(new Date).getTime()-perfTime,"ms")}else jqGrid.jqGrid("setGridParam",{datatype:"local",data:dataset,rowNum:dataset.length});return console.log("onDatasetChanged : ",(new Date).getTime()-startDataChanged,"ms"),jqGrid.trigger("reload")}jqGrid=init()},unwatchDataset=scope.$watch("dataset",onDatasetChanged,!1);element.on("$destroy",function(){unwatchDataset(),unwatchOptions()})}}}),angular.module("app.common.config",[]).config(["$urlRouterProvider","$locationProvider",function($urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!1)}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/iaadmin/frontend/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$translateProvider.useLocalStorage(),$translateProvider.useMissingTranslationHandlerLog()}]).config(["growlProvider",function(growlProvider){growlProvider.globalTimeToLive(5e3)}]),angular.module("app.common.directives",[]).directive("staticInclude",["$http","$templateCache","$compile",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=$("<div/>").html(response).contents();element.html(contents),$compile(contents)(scope)})}}]),angular.module("app.common.services",[]).service("NotificationService",["$rootScope","growl",function($rootScope,growl){function displayNotification(message,type){"success"===type?growl.addSuccessMessage(message):"warn"===type?growl.addWarnMessage(message):"info"===type?growl.addInfoMessage(message):growl.addErrorMessage(message)}var flashMessageQueue=[];return $rootScope.$on("$stateChangeSuccess",function(){for(;flashMessageQueue.length>0;){var item=flashMessageQueue.shift();item&&displayNotification(item.message,item.type)}}),{flashMessage:function(message,type){flashMessageQueue.push({message:message,type:type||"info"})}}}]),angular.module("app.search.services",["ngResource"]).factory("Search",["$resource",function($resource){var api=$resource("/api/docs/search",{},{query:{method:"GET",isArray:!1}});return{findBySearchTerm:function(searchTerm,pageNumber,pageSize){return api.query({page:pageNumber,searchTerm:searchTerm,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.cmis.services",["ngResource"]).factory("CMIS",["$resource","NotificationService",function($resource){var api=$resource("/jooq/browser/test/root?cmisselector=children&objectId=:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1}});return{query:function(folderId,pageNumber,pageSize){return api.query({id:folderId,page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.system.controllers",[]).constant("paginationConfig",{pageSize:200}).config(["$stateProvider",function($stateProvider){$stateProvider.state("system",{url:"/","abstract":!0,template:"<ui-view/>"}).state("system.index",{url:"",controller:"SystemListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["System","paginationConfig",function(System,paginationConfig){return System.query(0,paginationConfig.pageSize)}]}}).state("system.add",{url:"system/add",controller:"AddSystemController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("system.edit",{url:"system/:systemId/edit",controller:"EditSystemController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}}).state("system.view",{url:"system/:systemId",controller:"ViewSystemController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}})}]).controller("SystemListController",["$scope","$state","searchResults","paginationConfig",function($scope,$state,searchResults,paginationConfig){console.log("Rendering documents."),$scope.todos=searchResults.content,console.log(searchResults),console.log(searchResults.totalElements),console.log(paginationConfig.pageSize),$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.addTodo=function(){$state.go("system.add")}}]).controller("AddSystemController",["$scope","$state","System",function($scope,$state,System){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("system.view",{systemId:added.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),System.save($scope.todo,onSuccess)}}}]).controller("DeleteSystemController",["$scope","$modalInstance","$state","System","deletedTodo",function($scope,$modalInstance,$state,System,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("system.index",{},{reload:!0,inherit:!0,notify:!0})};System.delete($scope.todo,onSuccess)}}]).controller("EditSystemController",["$scope","$state","updatedTodo","System",function($scope,$state,updatedTodo,System){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.todo.data=JSON.stringify($scope.todo.data),$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("system.view",{systemId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),System.update($scope.todo,onSuccess)}}}]).controller("ViewSystemController",["$scope","$state","$modal","viewedTodo",function($scope,$state,$modal,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("system.edit",{systemId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showDeleteDialog=function(){$modal.open({templateUrl:"frontend/partials/todo/delete-todo-modal.html",controller:"DeleteSystemController",resolve:{deletedTodo:function(){return $scope.todo}}})}}]),angular.module("app.system.services",["ngResource"]).factory("System",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/system/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(pageNumber,pageSize){return api.query({page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]),angular.module("app.todo.controllers",[]).constant("paginationConfig",{pageSize:200}).config(["$stateProvider",function($stateProvider){$stateProvider.state("todo",{url:"/","abstract":!0,template:"<ui-view/>"}).state("todo.index",{url:"",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["Todos","paginationConfig",function(Todos,paginationConfig){return Todos.query(0,paginationConfig.pageSize)}]}}).state("todo.tree",{url:"todo/tree",controller:"TodoTreeController",templateUrl:"frontend/partials/todo/todo-tree.html",resolve:{searchResults:["CMIS","paginationConfig","$stateParams",function(CMIS,paginationConfig){return CMIS.query("0",0,paginationConfig.pageSize)}]}}).state("todo.page",{url:"todo/page/:pageNumber/size/:pageSize",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["Todos","$stateParams",function(Todos,$stateParams){return Todos.query($stateParams.pageNumber-1,$stateParams.pageSize)}]}}).state("todo.add",{url:"todo/add",controller:"AddTodoController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("todo.edit",{url:"todo/:todoId/edit",controller:"EditTodoController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.editform",{url:"todo/:todoId/editform",controller:"EditFormController",templateUrl:"frontend/partials/todo/edit-form.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.search",{url:"todo/search/:searchTerm/page/:pageNumber/size/:pageSize",controller:"SearchResultController",templateUrl:"frontend/partials/search/search-results.html",resolve:{searchTerm:["$stateParams",function($stateParams){return $stateParams.searchTerm}],searchResults:["Search","$stateParams",function(Search,$stateParams){return $stateParams.searchTerm?Search.findBySearchTerm($stateParams.searchTerm,$stateParams.pageNumber-1,$stateParams.pageSize):null}]}}).state("todo.view",{url:"todo/:todoId",controller:"ViewTodoController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}})}]).controller("TodoListController",["$scope","$state","searchResults","paginationConfig",function($scope,$state,searchResults,paginationConfig){console.log("Rendering documents."),$scope.todos=searchResults.content,console.log(searchResults),console.log(searchResults.totalElements),console.log(paginationConfig.pageSize),$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.addTodo=function(){$state.go("todo.add")},$scope.openTree=function(){$state.go("todo.tree")},$scope.pageChanged=function(newPageNumber){$state.go("todo.page",{pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("EditTodoController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.todo.data=JSON.stringify($scope.todo.data),$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),Todos.update($scope.todo,onSuccess)}}}]).controller("SearchController",["$scope","$state","paginationConfig",function($scope,$state,paginationConfig){var userWritingSearchTerm=!1,minimumSearchTermLength=3;$scope.missingChars=minimumSearchTermLength,$scope.searchTerm="",$scope.searchFieldBlur=function(){userWritingSearchTerm=!1},$scope.searchFieldFocus=function(){userWritingSearchTerm=!0},$scope.showMissingCharacterText=function(){return userWritingSearchTerm&&$scope.searchTerm.length<minimumSearchTermLength?!0:!1},$scope.search=function(){$scope.searchTerm.length<minimumSearchTermLength?$scope.missingChars=minimumSearchTermLength-$scope.searchTerm.length:($scope.missingChars=0,$state.go("todo.search",{searchTerm:$scope.searchTerm,pageNumber:1,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0}))}}]).controller("SearchResultController",["$scope","$state","paginationConfig","searchTerm","searchResults",function($scope,$state,paginationConfig,searchTerm,searchResults){console.log("Rendering search results page."),$scope.todos=searchResults.content,$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.pageChanged=function(newPageNumber){$state.go("todo.search",{searchTerm:searchTerm,pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("DocumentModalController",["$scope","$modalInstance","$state","Todos","viewedDoc",function($scope,$modalInstance,$state,Todos,viewedDoc){$scope.todo=viewedDoc,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.editDocument=function(){}}]).controller("TodoTreeController",["$scope","$state","$modal","Todos","searchResults","paginationConfig",function($scope,$state,$modal,Todos,searchResults,paginationConfig){console.log("Rendering documents tree.");var cmis_root="/jooq/browser/test/root";$("#treecontainer").jstree({core:{data:{url:function(node){return"#"===node.id?cmis_root+"?objectId=0&cmisselector=children":cmis_root+"?objectId="+node.id+"&cmisselector=children"},dataFilter:function(data){var nodes=[];return $.each(JSON.parse(data).objects,function(i,item){var node={};node.id=item.object.properties["cmis:objectId"].value,node.data={type:item.object.properties["cmis:objectTypeId"].value},node.text=item.object.properties["cmis:name"].value,"cmis:folder"==item.object.properties["cmis:objectTypeId"].value&&(node.children=!0),nodes.push(node)}),JSON.stringify(nodes)},data:function(node){return console.log(node),{id:node.id,text:"1"}}}}}),$("#treecontainer").on("select_node.jstree",function(e,data){if(console.log("node_id: "+data.node.type+" - "+data.node.id),"cmis:folder"==data.node.data.type)$scope.loadGrid(data.node.id);else{var docid=parseInt(data.node.id);$scope.openDocument(Todos,docid)}}),$scope.openDocument=function(Todos,docid){var viewsUrl="/api/docs/"+docid;$.getJSON(viewsUrl,function(viewdata){"view"==viewdata.type?$scope.loadGrid("0",viewdata):($scope.todo=viewdata,$modal.open({templateUrl:"frontend/partials/todo/document-view-modal.html",controller:"DocumentModalController",resolve:{viewedDoc:function(){return $scope.todo}}}))})},$scope.loadGrid=function(folderId,viewdata){console.log("Rendering documents grid."),$("#jqGrid").jqGrid("GridUnload");var dateOptions={dataInit:function(element){$(element).datepicker({id:"orderDate_datePicker",dateFormat:"yy-mm-dd",maxDate:new Date(2020,0,1),showOn:"focus"})},sopt:["gt","lt","eq"]},editSettings={recreateForm:!0,jqModal:!1,reloadAfterSubmit:!1,closeOnEscape:!0,savekey:[!0,13],closeAfterEdit:!0,afterShowForm:function(){$("#lui_"+grid[0].id).hide()}},addSettings={recreateForm:!0,jqModal:!1,reloadAfterSubmit:!1,savekey:[!0,13],closeOnEscape:!0,closeAfterAdd:!0,afterShowForm:function(){$("#lui_"+grid[0].id).hide()}},delSettings={processing:!0},id=folderId,viewEntriesUrl=cmis_root+"?objectId="+id+"&cmisselector=children",sys_fields=["id","type","title","description","modifier","modificationTime","autor","creationTime"],fields=["id","title","description","modifier","modificationTime"],rowSize=paginationConfig.pageSize,columns=[{name:"id",key:!0,width:75,jsonmap:"object.properties.cmis:objectId.value"},{name:"type",label:"Тип",width:100,jsonmap:"object.properties.cmis:objectTypeId.value"},{name:"title",label:"Заголовок",width:150,jsonmap:"object.properties.cmis:name.value"},{name:"description",label:"Описание",width:150,jsonmap:"object.properties.cmis:description.value"},{name:"author",label:"Создал",width:150,jsonmap:"object.properties.cmis:createdBy.value"},{name:"creationTime",label:"Дата создания",width:150,jsonmap:"object.properties.cmis:creationDate.value",formatter:"date",formatoptions:{srcformat:"U/1000",newformat:"d.m.Y H:i"},sorttype:"date",searchoptions:dateOptions},{name:"modifier",label:"Изменил",width:150,jsonmap:"object.properties.cmis:lastModifiedBy.value"},{name:"modificationTime",label:"Дата изменения",width:150,jsonmap:"object.properties.cmis:lastModificationDate.value",formatter:"date",formatoptions:{srcformat:"U/1000",newformat:"d.m.Y H:i"},sorttype:"date",searchoptions:dateOptions}];console.log(viewdata),null!=viewdata&&(viewEntriesUrl=viewdata.data.query+"?fields=",fields=[],columns=[],$.each(viewdata.data.columnDescriptions,function(i,item){if(0!=item.visible){var colWidth=140;item.width&&(colWidth=parseInt(item.width));var fieldOps={name:item.field,label:item.name,width:colWidth};item.sortField&&(fieldOps.index=item.sortField),-1==$.inArray(item.field,sys_fields)&&(fieldOps.jsonmap="data."+item.field,fields.push(item.field)),"INTEGER"==item.type&&(fieldOps.searchoptions={sopt:["gt","lt","eq"]}),"DATE"==item.type&&(fieldOps.sorttype="date",fieldOps.searchoptions=dateOptions),columns.push(fieldOps)}}),console.log(columns),viewEntriesUrl+=fields.join(),viewEntriesUrl+="&size="+rowSize,console.log(viewEntriesUrl));var fixGridWidth=function(grid){var gviewScrollWidth=grid[0].parentNode.parentNode.parentNode.scrollWidth,mainWidth=jQuery("#main").width(),gridScrollWidth=grid[0].scrollWidth,htable=jQuery("table.ui-jqgrid-htable",grid[0].parentNode.parentNode.parentNode),scrollWidth=gridScrollWidth;if(htable.length>0){var hdivScrollWidth=htable[0].scrollWidth;hdivScrollWidth>gridScrollWidth&&(scrollWidth=hdivScrollWidth)}if(gviewScrollWidth!=scrollWidth||scrollWidth>mainWidth){var newGridWidth=mainWidth>=scrollWidth?scrollWidth:mainWidth;newGridWidth!=gviewScrollWidth&&(grid.jqGrid("setGridWidth",newGridWidth),console.log("Width fixed."))}},fixGridHeight=function(grid){var gviewNode=grid[0].parentNode.parentNode.parentNode,bdiv=jQuery(".ui-jqgrid-bdiv",gviewNode);if(bdiv.length){var delta=bdiv[0].scrollHeight-bdiv[0].clientHeight,height=grid.height();0!==delta&&height&&height-delta>0&&(grid.setGridHeight(height-delta),console.log("Height fixed."))}},fixGridSize=function(grid){fixGridWidth(grid),fixGridHeight(grid)};$(window).resize(function(){fixGridSize($("#jqGrid"))}),$("#jqGrid").jqGrid({url:viewEntriesUrl,mtype:"GET",datatype:"json",page:1,colModel:columns,autowidth:!0,shrinkToFit:!0,maxHeight:500,rowNum:paginationConfig.pageSize,serializeGridData:function(postData){return"number"==typeof postData.page&&postData.page--,postData.sort=null!=postData.sidx&&""!=postData.sidx?postData.sidx+","+postData.sord:"ID,DESC",postData},jsonReader:{repeatitems:!1,root:function(data){return data.content?data.content:data.objects},total:function(data){return data.totalPages},page:function(data){return data.number+1},records:function(data){return data.totalElements?data.totalElements:data.numItems}},onSelectRow:function(ids){if(null==ids)loadGridCMIS("0");else{var rowData=$("#jqGrid").getRowData(ids);if(console.log("Type: "+rowData.type),"cmis:folder"==rowData.type)$scope.loadGrid(ids);else{console.log("request doc "+ids);var docid=parseInt(ids);$scope.openDocument(Todos,docid)}}},scroll:1,emptyrecords:"Scroll to bottom to retrieve new page",pager:"#jqGridPager",loadComplete:function(){fixGridSize($("#jqGrid")),$("tr.jqgrow",this).contextMenu("folderMenu",{bindings:{edit:function(trigger){$("#jqGrid").editGridRow(trigger.id,editSettings)},add:function(){$("#jqGrid").editGridRow("new",addSettings)},del:function(trigger){$("#del").hasClass("ui-state-disabled")===!1&&$("#jqGrid").delGridRow(trigger.id,delSettings)}},onContextMenu:function(event){var rowId=$(event.target).closest("tr.jqgrow").attr("id");return $("#del").attr("disabled",Number(rowId)%2===0),Number(rowId)%2===0?$("#del").attr("disabled","disabled").addClass("ui-state-disabled"):$("#del").removeAttr("disabled").removeClass("ui-state-disabled"),!0}})}}),$("#jqGrid").navGrid("#jqGridPager",{search:!0,add:!1,edit:!1,del:!1,refresh:!0},{},{},{},{multipleSearch:!0,uniqueSearchFields:!0,multipleGroup:!0})},$scope.loadGrid("0")}]).controller("AddTodoController",["$scope","$state","Todos",function($scope,$state,Todos){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("todo.view",{todoId:added.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),Todos.save($scope.todo,onSuccess)}}}]).controller("DeleteTodoController",["$scope","$modalInstance","$state","Todos","deletedTodo",function($scope,$modalInstance,$state,Todos,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("todo.index",{},{reload:!0,inherit:!0,notify:!0})};Todos.delete($scope.todo,onSuccess)}}]).controller("EditFormController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo;var typeUrl="/api/system/s/"+$scope.todo.type;$.ajax({type:"GET",url:typeUrl,dataType:"json",async:!1,success:function(res){$scope.schema=res.data.schema}}),$scope.form=["*"],$scope.model=$scope.todo.data,$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=$scope.model,Todos.update($scope.todo,onSuccess)}}}]).controller("ViewTodoController",["$scope","$state","$modal","viewedTodo",function($scope,$state,$modal,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("todo.edit",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showEditFormPage=function(){$state.go("todo.editform",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showDeleteDialog=function(){$modal.open({templateUrl:"frontend/partials/todo/delete-todo-modal.html",controller:"DeleteTodoController",resolve:{deletedTodo:function(){return $scope.todo}}})}}]),angular.module("app.todo.services",["ngResource"]).factory("Todos",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/docs/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(pageNumber,pageSize){return api.query({page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]),angular.module("demo",["blueimp.fileupload"]).config(["$httpProvider","fileUploadProvider",function($httpProvider,fileUploadProvider){delete $httpProvider.defaults.headers.common["X-Requested-With"],fileUploadProvider.defaults.redirect=window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s")}]).controller("DemoFileUploadController",["$scope","$http","$filter","$window",function($scope){$scope.options={url:url}}]).controller("FileDestroyController",["$scope","$http",function($scope,$http){var state,file=$scope.file;file.url?(file.$state=function(){return state},file.$destroy=function(){return state="pending",$http({url:file.deleteUrl,method:file.deleteType}).then(function(){state="resolved",$scope.clear(file)},function(){state="rejected"})}):file.$cancel||file._index||(file.$cancel=function(){$scope.clear(file)})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZHVsZS9jb21tb24vYW5ndWxhci1qcWdyaWQuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5jb25maWcuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5kaXJlY3RpdmVzLmpzIiwibW9kdWxlL2NvbW1vbi9jb21tb24uc2VydmljZXMuanMiLCJtb2R1bGUvc2VhcmNoL3NlYXJjaC5zZXJ2aWNlcy5qcyIsIm1vZHVsZS90b2RvL2NtaXMuc2VydmljZXMuanMiLCJtb2R1bGUvdG9kby9zeXN0ZW0uY29udHJvbGxlcnMuanMiLCJtb2R1bGUvdG9kby9zeXN0ZW0uc2VydmljZXMuanMiLCJtb2R1bGUvdG9kby90b2RvLmNvbnRyb2xsZXJzLmpzIiwibW9kdWxlL3RvZG8vdG9kby5zZXJ2aWNlcy5qcyIsIm1vZHVsZS90b2RvL3RvZG8udXBsb2FkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBQSxLQUFBLFFBQUEsT0FBQSxPQUNBLFdBQ0EsWUFDQSxhQUNBLGFBQ0EseUJBQ0EsZUFDQSxZQUNBLFdBQ0EsWUFDQSxnQkFDQSxnQkFDQSx3Q0FDQSxhQUNBLGlCQUdBLGVBR0Esb0JBQUEsd0JBQUEsc0JBR0Esc0JBR0EsdUJBQUEsb0JBRUEseUJBQUEsc0JBRUEscUJDSkEsU0FBQSxPQUFBLHFCQUFBLFVBQUEsU0FBQSxXQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsa0JBQ0EsT0FDQSxRQUFBLElBQ0EsUUFBQSxJQUNBLFNBQUEsSUFDQSxNQUFBLEtBRUEsS0FBQSxTQUFBLE1BQUEsUUFBQSxZQUNBLEdBQUEsUUFBQSxLQUNBLE9BQUEsV0FBQSxRQUFBLE9BRUEsS0FBQSxXQUNBLEdBQUEsUUFFQSxJQUFBLFNBQUEsTUFBQSxRQUVBLE1BQUEsUUFHQSxJQUFBLFdBY0EsT0FaQSxTQUFBLEtBQUEsTUFBQSxRQUVBLFFBQUEsRUFBQSxRQUFBLEVBQUEsUUFBQSxNQUFBLFNBRUEsUUFBQSxPQUFBLE9BRUEsUUFBQSxFQUFBLFFBQUEsV0FBQSxJQUFBLE9BQUEsU0FFQSxNQUFBLFVBQ0EsTUFBQSxTQUFBLFNBR0EsUUFPQSxHQUFBLFFBQUEsR0FBQSxTQUFBLFdBQ0EsR0FBQSxlQUFBLFFBQUEsUUFBQSxTQUFBLFFBQ0EsUUFBQSxhQUFBLGNBQUEsVUFNQSxJQUFBLGtCQUFBLFdBQ0EsT0FBQSxRQUdBLGVBQUEsTUFBQSxPQUFBLFVBQUEsa0JBQUEsR0FFQSxpQkFBQSxTQUFBLFNBQ0EsR0FBQSxtQkFBQSxHQUFBLE9BQUEsU0FDQSxJQUFBLE9BQUEsQ0FJQSxHQUZBLE9BQUEsT0FBQSxpQkFFQSxPQUFBLElBQUEsR0FBQSxFQUFBLFNBQUEsQ0FDQSxHQUFBLFdBQUEsR0FBQSxPQUFBLFNBQ0EsUUFBQSxJQUFBLEdBQUEsYUFDQSxLQUFBLFVBRUEsUUFBQSxJQUFBLGtCQUFBLEdBQUEsT0FBQSxVQUFBLFNBQUEsVUFHQSxRQUFBLE9BQUEsZ0JBQ0EsU0FBQSxRQUNBLEtBQUEsUUFDQSxPQUFBLFFBQUEsUUFRQSxPQUZBLFNBQUEsSUFBQSx1QkFBQSxHQUFBLE9BQUEsVUFBQSxpQkFBQSxNQUVBLE9BQUEsUUFBQSxVQUlBLE9BQUEsUUFLQSxlQUFBLE1BQUEsT0FBQSxVQUFBLGtCQUFBLEVBS0EsU0FBQSxHQUFBLFdBQUEsV0FDQSxpQkFDQSx1QkM1SEEsUUFBQSxPQUFBLHdCQUNBLFFBQUEscUJBQUEsb0JBQ0EsU0FBQSxtQkFBQSxtQkFDQSxtQkFBQSxVQUFBLEtBR0Esa0JBQUEsV0FBQSxNQUdBLFFBQUEscUJBQUEsU0FBQSxvQkFFQSxtQkFBQSxzQkFDQSxPQUFBLDBCQUNBLE9BQUEsVUFHQSxtQkFBQSxrQkFBQSxNQUNBLG1CQUFBLGtCQUNBLG1CQUFBLHFDQUVBLFFBQUEsZ0JBQUEsU0FBQSxlQUNBLGNBQUEsaUJBQUEsUUNyQkEsUUFBQSxPQUFBLDRCQUNBLFVBQUEsaUJBQUEsUUFBQSxpQkFBQSxXQUFBLFNBQUEsTUFBQSxlQUFBLFVBQ0EsTUFBQSxVQUFBLE1BQUEsUUFBQSxPQUNBLEdBQUEsY0FBQSxNQUFBLGFBRUEsT0FBQSxJQUFBLGNBQUEsTUFBQSxpQkFBQSxRQUFBLFNBQUEsVUFDQSxHQUFBLFVBQUEsRUFBQSxVQUFBLEtBQUEsVUFBQSxVQUNBLFNBQUEsS0FBQSxVQUNBLFNBQUEsVUFBQSxhQ1JBLFFBQUEsT0FBQSwwQkFDQSxRQUFBLHVCQUFBLGFBQUEsUUFBQSxTQUFBLFdBQUEsT0FHQSxRQUFBLHFCQUFBLFFBQUEsTUFDQSxZQUFBLEtBQ0EsTUFBQSxrQkFBQSxTQUNBLFNBQUEsS0FDQSxNQUFBLGVBQUEsU0FDQSxTQUFBLEtBQ0EsTUFBQSxlQUFBLFNBRUEsTUFBQSxnQkFBQSxTQVZBLEdBQUEscUJBeUJBLE9BVkEsWUFBQSxJQUFBLHNCQUFBLFdBQ0EsS0FBQSxrQkFBQSxPQUFBLEdBQUEsQ0FDQSxHQUFBLE1BQUEsa0JBQUEsT0FDQSxPQUNBLG9CQUFBLEtBQUEsUUFBQSxLQUFBLFVBT0EsYUFBQSxTQUFBLFFBQUEsTUFDQSxrQkFBQSxNQUFBLFFBQUEsUUFBQSxLQUFBLE1BQUEsY0M3QkEsUUFBQSxPQUFBLHVCQUFBLGVBQ0EsUUFBQSxVQUFBLFlBQUEsU0FBQSxXQUNBLEdBQUEsS0FBQSxVQUFBLHVCQUNBLE9BQUEsT0FBQSxNQUFBLFNBQUEsSUFHQSxRQUNBLGlCQUFBLFNBQUEsV0FBQSxXQUFBLFVBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUFBLFdBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxZQUFBLGNDUkEsUUFBQSxPQUFBLHFCQUFBLGVBQ0EsUUFBQSxRQUFBLFlBQUEsc0JBQUEsU0FBQSxXQUNBLEdBQUEsS0FBQSxVQUFBLDhEQUFBLEdBQUEsUUFDQSxPQUFBLE9BQUEsTUFBQSxVQUFBLFNBQUEsSUFHQSxRQUNBLE1BQUEsU0FBQSxTQUFBLFdBQUEsVUFDQSxNQUFBLEtBQUEsT0FBQSxHQUFBLFNBQUEsS0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLFlBQUEsY0NSQSxRQUFBLE9BQUEsNkJBQ0EsU0FBQSxvQkFDQSxTQUFBLE1BR0EsUUFBQSxpQkFDQSxTQUFBLGdCQUNBLGVBQ0EsTUFBQSxVQUNBLElBQUEsSUFDQSxZQUFBLEVBQ0EsU0FBQSxlQUVBLE1BQUEsZ0JBQ0EsSUFBQSxHQUNBLFdBQUEsdUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGVBQUEsU0FBQSxtQkFBQSxTQUFBLE9BQUEsa0JBQ0EsTUFBQSxRQUFBLE1BQUEsRUFBQSxpQkFBQSxlQUlBLE1BQUEsY0FDQSxJQUFBLGFBQ0EsV0FBQSxzQkFDQSxZQUFBLHlDQUVBLE1BQUEsZUFDQSxJQUFBLHdCQUNBLFdBQUEsdUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGFBQUEsU0FBQSxlQUFBLFNBQUEsT0FBQSxjQUNBLE1BQUEsY0FBQSxTQUNBLE9BQUEsSUFBQSxhQUFBLFVBRUEsVUFJQSxNQUFBLGVBQ0EsSUFBQSxtQkFDQSxXQUFBLHVCQUNBLFlBQUEsd0NBQ0EsU0FDQSxZQUFBLFNBQUEsZUFBQSxTQUFBLE9BQUEsY0FDQSxNQUFBLGNBQUEsU0FDQSxPQUFBLElBQUEsYUFBQSxVQUVBLGFBTUEsV0FBQSx3QkFBQSxTQUFBLFNBQUEsZ0JBQUEsbUJBQ0EsU0FBQSxPQUFBLE9BQUEsY0FBQSxrQkFDQSxRQUFBLElBQUEsd0JBQ0EsT0FBQSxNQUFBLGNBQUEsUUFDQSxRQUFBLElBQUEsZUFDQSxRQUFBLElBQUEsY0FBQSxlQUNBLFFBQUEsSUFBQSxpQkFBQSxVQUNBLE9BQUEsWUFDQSxZQUFBLGNBQUEsT0FBQSxFQUNBLGFBQUEsaUJBQUEsU0FDQSxXQUFBLGNBQUEsZUFHQSxPQUFBLFFBQUEsV0FDQSxPQUFBLEdBQUEsa0JBSUEsV0FBQSx1QkFBQSxTQUFBLFNBQUEsU0FDQSxTQUFBLE9BQUEsT0FBQSxRQUNBLFFBQUEsSUFBQSxrQ0FDQSxPQUFBLFFBRUEsT0FBQSxTQUFBLFdBQ0EsR0FBQSxPQUFBLFNBQUEsT0FBQSxDQUNBLEdBQUEsV0FBQSxTQUFBLE9BQ0EsT0FBQSxHQUFBLGVBQUEsU0FBQSxNQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsUUFBQSxLQUFBLEtBQUEsS0FBQSxNQUFBLE9BQUEsS0FBQSxNQUNBLE9BQUEsS0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSwwQkFBQSxTQUFBLGlCQUFBLFNBQUEsU0FBQSxjQUNBLFNBQUEsT0FBQSxlQUFBLE9BQUEsT0FBQSxhQUNBLE9BQUEsS0FBQSxZQUVBLE9BQUEsT0FBQSxXQUNBLGVBQUEsUUFBQSxXQUdBLE9BQUEsT0FBQSxXQUNBLEdBQUEsV0FBQSxXQUNBLGVBQUEsUUFDQSxPQUFBLEdBQUEsbUJBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsUUFBQSxPQUFBLE9BQUEsS0FBQSxlQUlBLFdBQUEsd0JBQUEsU0FBQSxTQUFBLGNBQUEsU0FDQSxTQUFBLE9BQUEsT0FBQSxZQUFBLFFBQ0EsUUFBQSxJQUFBLGFBQ0EsT0FBQSxLQUFBLFlBQ0EsT0FBQSxLQUFBLEtBQUEsS0FBQSxVQUFBLE9BQUEsS0FBQSxNQUNBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxTQUNBLE9BQUEsR0FBQSxlQUFBLFNBQUEsUUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxPQUFBLE9BQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsd0JBQUEsU0FBQSxTQUFBLFNBQUEsYUFDQSxTQUFBLE9BQUEsT0FBQSxPQUFBLFlBQ0EsUUFBQSxJQUFBLG1DQUNBLE9BQUEsS0FBQSxXQUVBLE9BQUEsYUFBQSxXQUNBLE9BQUEsR0FBQSxlQUFBLFNBQUEsT0FBQSxLQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEtBSUEsT0FBQSxpQkFBQSxXQUNBLE9BQUEsTUFDQSxZQUFBLGdEQUNBLFdBQUEseUJBQ0EsU0FDQSxZQUFBLFdBQ0EsTUFBQSxRQUFBLGFDeklBLFFBQUEsT0FBQSx1QkFBQSxlQUNBLFFBQUEsVUFBQSxZQUFBLHNCQUFBLFNBQUEsVUFBQSxxQkFDQSxHQUFBLEtBQUEsVUFBQSxtQkFBQSxHQUFBLFFBQ0EsT0FBQSxPQUFBLE1BQUEsVUFBQSxTQUFBLEdBQ0EsS0FBQSxPQUFBLE9BQ0EsTUFBQSxPQUFBLFFBQ0EsUUFBQSxPQUFBLFFBR0EsUUFDQSxTQUFBLFNBQUEsS0FBQSxpQkFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLFdBQ0Esb0JBQUEsYUFBQSxvQ0FBQSxXQUNBLHFCQUdBLE1BQUEsU0FBQSxXQUFBLFVBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLFlBQUEsVUFFQSxJQUFBLFNBQUEsUUFDQSxNQUFBLEtBQUEsS0FBQSxHQUFBLFNBQUEsVUFFQSxLQUFBLFNBQUEsS0FBQSxpQkFDQSxJQUFBLEtBQUEsS0FBQSxTQUFBLE9BQ0Esb0JBQUEsYUFBQSxpQ0FBQSxXQUNBLGdCQUFBLFVBR0EsT0FBQSxTQUFBLEtBQUEsaUJBQ0EsSUFBQSxPQUFBLEtBQUEsU0FBQSxTQUNBLG9CQUFBLGFBQUEsb0NBQUEsV0FDQSxnQkFBQSxnQkMvQkEsUUFBQSxPQUFBLDJCQUNBLFNBQUEsb0JBQ0EsU0FBQSxNQUdBLFFBQUEsaUJBQ0EsU0FBQSxnQkFDQSxlQUNBLE1BQUEsUUFDQSxJQUFBLElBQ0EsWUFBQSxFQUNBLFNBQUEsZUFFQSxNQUFBLGNBQ0EsSUFBQSxHQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGVBQUEsUUFBQSxtQkFBQSxTQUFBLE1BQUEsa0JBQ0EsTUFBQSxPQUFBLE1BQUEsRUFBQSxpQkFBQSxlQUlBLE1BQUEsYUFDQSxJQUFBLFlBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsZUFBQSxPQUFBLG1CQUFBLGVBQUEsU0FBQSxLQUFBLGtCQUNBLE1BQUEsTUFBQSxNQUFBLElBQUEsRUFBQSxpQkFBQSxlQUlBLE1BQUEsYUFDQSxJQUFBLHVDQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGVBQUEsUUFBQSxlQUFBLFNBQUEsTUFBQSxjQUNBLE1BQUEsT0FBQSxNQUFBLGFBQUEsV0FBQSxFQUFBLGFBQUEsZUFJQSxNQUFBLFlBQ0EsSUFBQSxXQUNBLFdBQUEsb0JBQ0EsWUFBQSx5Q0FFQSxNQUFBLGFBQ0EsSUFBQSxvQkFDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxhQUFBLFFBQUEsZUFBQSxTQUFBLE1BQUEsY0FDQSxNQUFBLGNBQUEsT0FDQSxNQUFBLElBQUEsYUFBQSxRQUVBLFVBSUEsTUFBQSxpQkFDQSxJQUFBLHdCQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGFBQUEsUUFBQSxlQUFBLFNBQUEsTUFBQSxjQUNBLE1BQUEsY0FBQSxPQUNBLE1BQUEsSUFBQSxhQUFBLFFBRUEsVUFJQSxNQUFBLGVBQ0EsSUFBQSwwREFDQSxXQUFBLHlCQUNBLFlBQUEsK0NBQ0EsU0FDQSxZQUFBLGVBQUEsU0FBQSxjQUNBLE1BQUEsY0FBQSxhQUVBLGVBQUEsU0FBQSxlQUFBLFNBQUEsT0FBQSxjQUNBLE1BQUEsY0FBQSxXQUNBLE9BQUEsaUJBQUEsYUFBQSxXQUFBLGFBQUEsV0FBQSxFQUFBLGFBQUEsVUFHQSxVQUlBLE1BQUEsYUFDQSxJQUFBLGVBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsWUFBQSxRQUFBLGVBQUEsU0FBQSxNQUFBLGNBQ0EsTUFBQSxjQUFBLE9BQ0EsTUFBQSxJQUFBLGFBQUEsUUFFQSxhQU1BLFdBQUEsc0JBQUEsU0FBQSxTQUFBLGdCQUFBLG1CQUNBLFNBQUEsT0FBQSxPQUFBLGNBQUEsa0JBQ0EsUUFBQSxJQUFBLHdCQUNBLE9BQUEsTUFBQSxjQUFBLFFBQ0EsUUFBQSxJQUFBLGVBQ0EsUUFBQSxJQUFBLGNBQUEsZUFDQSxRQUFBLElBQUEsaUJBQUEsVUFDQSxPQUFBLFlBQ0EsWUFBQSxjQUFBLE9BQUEsRUFDQSxhQUFBLGlCQUFBLFNBQ0EsV0FBQSxjQUFBLGVBR0EsT0FBQSxRQUFBLFdBQ0EsT0FBQSxHQUFBLGFBR0EsT0FBQSxTQUFBLFdBQ0EsT0FBQSxHQUFBLGNBR0EsT0FBQSxZQUFBLFNBQUEsZUFDQSxPQUFBLEdBQUEsYUFDQSxXQUFBLGNBQUEsU0FBQSxpQkFBQSxXQUNBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxRQUlBLFdBQUEsc0JBQUEsU0FBQSxTQUFBLGNBQUEsUUFDQSxTQUFBLE9BQUEsT0FBQSxZQUFBLE9BQ0EsUUFBQSxJQUFBLGFBQ0EsT0FBQSxLQUFBLFlBQ0EsT0FBQSxLQUFBLEtBQUEsS0FBQSxVQUFBLE9BQUEsS0FBQSxNQUNBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxTQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsUUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxNQUFBLE9BQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsb0JBQUEsU0FBQSxTQUFBLG1CQUNBLFNBQUEsT0FBQSxPQUFBLGtCQUVBLEdBQUEsd0JBQUEsRUFDQSx3QkFBQSxDQUVBLFFBQUEsYUFBQSx3QkFDQSxPQUFBLFdBQUEsR0FFQSxPQUFBLGdCQUFBLFdBQ0EsdUJBQUEsR0FHQSxPQUFBLGlCQUFBLFdBQ0EsdUJBQUEsR0FHQSxPQUFBLHlCQUFBLFdBQ0EsTUFBQSx3QkFDQSxPQUFBLFdBQUEsT0FBQSx5QkFDQSxHQUlBLEdBR0EsT0FBQSxPQUFBLFdBQ0EsT0FBQSxXQUFBLE9BQUEsd0JBQ0EsT0FBQSxhQUFBLHdCQUFBLE9BQUEsV0FBQSxRQUdBLE9BQUEsYUFBQSxFQUNBLE9BQUEsR0FBQSxlQUNBLFdBQUEsT0FBQSxXQUFBLFdBQUEsRUFBQSxTQUFBLGlCQUFBLFdBQ0EsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLFNBTUEsV0FBQSwwQkFBQSxTQUFBLFNBQUEsbUJBQUEsYUFBQSxnQkFDQSxTQUFBLE9BQUEsT0FBQSxpQkFBQSxXQUFBLGVBQ0EsUUFBQSxJQUFBLGtDQUNBLE9BQUEsTUFBQSxjQUFBLFFBRUEsT0FBQSxZQUNBLFlBQUEsY0FBQSxPQUFBLEVBQ0EsYUFBQSxpQkFBQSxTQUNBLFdBQUEsY0FBQSxlQUdBLE9BQUEsWUFBQSxTQUFBLGVBQ0EsT0FBQSxHQUFBLGVBQ0EsV0FBQSxXQUFBLFdBQUEsY0FBQSxTQUFBLGlCQUFBLFdBQ0EsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLFFBS0EsV0FBQSwyQkFBQSxTQUFBLGlCQUFBLFNBQUEsUUFBQSxZQUNBLFNBQUEsT0FBQSxlQUFBLE9BQUEsTUFBQSxXQUNBLE9BQUEsS0FBQSxVQUVBLE9BQUEsT0FBQSxXQUNBLGVBQUEsUUFBQSxXQUdBLE9BQUEsYUFBQSxnQkFPQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxTQUFBLFFBQUEsZ0JBQUEsbUJBQ0EsU0FBQSxPQUFBLE9BQUEsT0FBQSxNQUFBLGNBQUEsa0JBRUEsUUFBQSxJQUFBLDRCQUNBLElBQ0EsV0FBQSx5QkFDQSxHQUFBLGtCQUFBLFFBQ0EsTUFDQSxNQUNBLElBQUEsU0FBQSxNQUNBLE1BQUEsTUFBQSxLQUFBLEdBQ0EsVUFBQSxvQ0FDQSxVQUFBLGFBQUEsS0FBQSxHQUFBLDBCQUVBLFdBQUEsU0FBQSxNQUNBLEdBQUEsU0FXQSxPQVZBLEdBQUEsS0FBQSxLQUFBLE1BQUEsTUFBQSxRQUFBLFNBQUEsRUFBQSxNQUNBLEdBQUEsUUFDQSxNQUFBLEdBQUEsS0FBQSxPQUFBLFdBQUEsaUJBQUEsTUFDQSxLQUFBLE1BQUEsS0FBQSxLQUFBLE9BQUEsV0FBQSxxQkFBQSxPQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUEsV0FBQSxhQUFBLE1BQ0EsZUFBQSxLQUFBLE9BQUEsV0FBQSxxQkFBQSxRQUFBLEtBQUEsVUFBQSxHQUNBLE1BQUEsS0FBQSxRQUlBLEtBQUEsVUFBQSxRQUVBLEtBQUEsU0FBQSxNQUVBLE1BREEsU0FBQSxJQUFBLE9BQ0EsR0FBQSxLQUFBLEdBQUEsS0FBQSxVQU1BLEVBQUEsa0JBQUEsR0FBQSxxQkFBQSxTQUFBLEVBQUEsTUFFQSxHQURBLFFBQUEsSUFBQSxZQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUEsS0FBQSxLQUFBLElBQ0EsZUFBQSxLQUFBLEtBQUEsS0FBQSxLQUNBLE9BQUEsU0FBQSxLQUFBLEtBQUEsUUFDQSxDQUNBLEdBQUEsT0FBQSxTQUFBLEtBQUEsS0FBQSxHQUVBLFFBQUEsYUFBQSxNQUFBLFVBSUEsT0FBQSxhQUFBLFNBQUEsTUFBQSxPQUNBLEdBQUEsVUFBQSxhQUFBLEtBQ0EsR0FBQSxRQUFBLFNBQUEsU0FBQSxVQUNBLFFBQUEsU0FBQSxLQUNBLE9BQUEsU0FBQSxJQUFBLFdBRUEsT0FBQSxLQUFBLFNBQ0EsT0FBQSxNQUNBLFlBQUEsa0RBQ0EsV0FBQSwwQkFDQSxTQUNBLFVBQUEsV0FDQSxNQUFBLFFBQUEsYUFRQSxPQUFBLFNBQUEsU0FBQSxTQUFBLFVBQ0EsUUFBQSxJQUFBLDZCQUVBLEVBQUEsV0FBQSxPQUFBLGFBQ0EsSUFBQSxjQUdBLFNBQUEsU0FBQSxTQUNBLEVBQUEsU0FBQSxZQUNBLEdBQUEsdUJBQ0EsV0FBQSxXQUVBLFFBQUEsR0FBQSxNQUFBLEtBQUEsRUFBQSxHQUNBLE9BQUEsV0FJQSxNQUFBLEtBQUEsS0FBQSxPQUVBLGNBQ0EsY0FBQSxFQUNBLFNBQUEsRUFDQSxtQkFBQSxFQUNBLGVBQUEsRUFDQSxVQUFBLEVBQUEsSUFDQSxnQkFBQSxFQUNBLGNBQUEsV0FDQSxFQUFBLFFBQUEsS0FBQSxHQUFBLElBQUEsU0FHQSxhQUNBLGNBQUEsRUFDQSxTQUFBLEVBQ0EsbUJBQUEsRUFDQSxVQUFBLEVBQUEsSUFDQSxlQUFBLEVBQ0EsZUFBQSxFQUNBLGNBQUEsV0FDQSxFQUFBLFFBQUEsS0FBQSxHQUFBLElBQUEsU0FHQSxhQUNBLFlBQUEsR0FHQSxHQUFBLFNBRUEsZUFBQSxVQUFBLGFBQUEsR0FBQSx5QkFDQSxZQUFBLEtBQUEsT0FBQSxRQUFBLGNBQUEsV0FBQSxtQkFBQSxRQUFBLGdCQUNBLFFBQUEsS0FBQSxRQUFBLGNBQUEsV0FBQSxvQkFDQSxRQUFBLGlCQUFBLFNBQ0EsVUFDQSxLQUFBLEtBQUEsS0FBQSxFQUFBLE1BQUEsR0FBQSxRQUFBLDBDQUNBLEtBQUEsT0FBQSxNQUFBLE1BQUEsTUFBQSxJQUFBLFFBQUEsOENBQ0EsS0FBQSxRQUFBLE1BQUEsWUFBQSxNQUFBLElBQUEsUUFBQSxzQ0FDQSxLQUFBLGNBQUEsTUFBQSxXQUFBLE1BQUEsSUFBQSxRQUFBLDZDQUNBLEtBQUEsU0FBQSxNQUFBLFNBQUEsTUFBQSxJQUFBLFFBQUEsMkNBQ0EsS0FBQSxlQUFBLE1BQUEsZ0JBQUEsTUFBQSxJQUFBLFFBQUEsNENBQ0EsVUFBQSxPQUFBLGVBQUEsVUFBQSxTQUFBLFVBQUEsYUFDQSxTQUFBLE9BQ0EsY0FBQSxjQUVBLEtBQUEsV0FBQSxNQUFBLFVBQUEsTUFBQSxJQUFBLFFBQUEsZ0RBQ0EsS0FBQSxtQkFBQSxNQUFBLGlCQUFBLE1BQUEsSUFBQSxRQUFBLG9EQUNBLFVBQUEsT0FBQSxlQUFBLFVBQUEsU0FBQSxVQUFBLGFBQ0EsU0FBQSxPQUNBLGNBQUEsYUFHQSxTQUFBLElBQUEsVUFDQSxNQUFBLFdBQ0EsZUFBQSxTQUFBLEtBQUEsTUFBQSxXQUNBLFVBQ0EsV0FDQSxFQUFBLEtBQUEsU0FBQSxLQUFBLG1CQUFBLFNBQUEsRUFBQSxNQUVBLEdBQUEsR0FBQSxLQUFBLFFBQUEsQ0FDQSxHQUFBLFVBQUEsR0FDQSxNQUFBLFFBQUEsU0FBQSxTQUFBLEtBQUEsT0FDQSxJQUFBLFdBQUEsS0FBQSxLQUFBLE1BQUEsTUFBQSxLQUFBLEtBQUEsTUFBQSxTQUNBLE1BQUEsWUFBQSxTQUFBLE1BQUEsS0FBQSxXQUNBLElBQUEsRUFBQSxRQUFBLEtBQUEsTUFBQSxjQUNBLFNBQUEsUUFBQSxRQUFBLEtBQUEsTUFDQSxPQUFBLEtBQUEsS0FBQSxRQUVBLFdBQUEsS0FBQSxPQUFBLFNBQUEsZUFBQSxNQUFBLEtBQUEsS0FBQSxRQUNBLFFBQUEsS0FBQSxPQUNBLFNBQUEsU0FBQSxPQUNBLFNBQUEsY0FBQSxhQUVBLFFBQUEsS0FBQSxhQUdBLFFBQUEsSUFBQSxTQUNBLGdCQUFBLE9BQUEsT0FDQSxnQkFBQSxTQUFBLFFBQ0EsUUFBQSxJQUFBLGdCQUVBLElBQUEsY0FBQSxTQUFBLE1BQ0EsR0FBQSxrQkFBQSxLQUFBLEdBQUEsV0FBQSxXQUFBLFdBQUEsWUFDQSxVQUFBLE9BQUEsU0FBQSxRQUNBLGdCQUFBLEtBQUEsR0FBQSxZQUNBLE9BQUEsT0FBQSx5QkFBQSxLQUFBLEdBQUEsV0FBQSxXQUFBLFlBQ0EsWUFBQSxlQUNBLElBQUEsT0FBQSxPQUFBLEVBQUEsQ0FDQSxHQUFBLGlCQUFBLE9BQUEsR0FBQSxXQUNBLGlCQUFBLGtCQUNBLFlBQUEsaUJBRUEsR0FBQSxrQkFBQSxhQUFBLFlBQUEsVUFBQSxDQUNBLEdBQUEsY0FBQSxXQUFBLFlBQUEsWUFBQSxTQUVBLGVBQUEsbUJBQ0EsS0FBQSxPQUFBLGVBQUEsY0FDQSxRQUFBLElBQUEsbUJBS0EsY0FBQSxTQUFBLE1BQ0EsR0FBQSxXQUFBLEtBQUEsR0FBQSxXQUFBLFdBQUEsV0FHQSxLQUFBLE9BQUEsa0JBQUEsVUFDQSxJQUFBLEtBQUEsT0FBQSxDQUNBLEdBQUEsT0FBQSxLQUFBLEdBQUEsYUFBQSxLQUFBLEdBQUEsYUFDQSxPQUFBLEtBQUEsUUFDQSxLQUFBLE9BQUEsUUFBQSxPQUFBLE1BQUEsSUFDQSxLQUFBLGNBQUEsT0FBQSxPQUNBLFFBQUEsSUFBQSxvQkFNQSxZQUFBLFNBQUEsTUFDQSxhQUFBLE1BQ0EsY0FBQSxNQUdBLEdBQUEsUUFBQSxPQUFBLFdBQ0EsWUFBQSxFQUFBLGNBSUEsRUFBQSxXQUFBLFFBQ0EsSUFBQSxlQUNBLE1BQUEsTUFDQSxTQUFBLE9BQ0EsS0FBQSxFQUNBLFNBQUEsUUFDQSxXQUFBLEVBQ0EsYUFBQSxFQUVBLFVBQUEsSUFDQSxPQUFBLGlCQUFBLFNBRUEsa0JBQUEsU0FBQSxVQVNBLE1BUkEsZ0JBQUEsVUFBQSxNQUNBLFNBQUEsT0FHQSxTQUFBLEtBREEsTUFBQSxTQUFBLE1BQUEsSUFBQSxTQUFBLEtBQ0EsU0FBQSxLQUFBLElBQUEsU0FBQSxLQUVBLFVBRUEsVUFFQSxZQUNBLGFBQUEsRUFDQSxLQUFBLFNBQUEsTUFDQSxNQUFBLE1BQUEsUUFDQSxLQUFBLFFBRUEsS0FBQSxTQUVBLE1BQUEsU0FBQSxNQUNBLE1BQUEsTUFBQSxZQUVBLEtBQUEsU0FBQSxNQUNBLE1BQUEsTUFBQSxPQUFBLEdBRUEsUUFBQSxTQUFBLE1BQ0EsTUFBQSxNQUFBLGNBQ0EsS0FBQSxjQUVBLEtBQUEsV0FHQSxZQUFBLFNBQUEsS0FDQSxHQUFBLE1BQUEsSUFDQSxhQUFBLFNBQ0EsQ0FDQSxHQUFBLFNBQUEsRUFBQSxXQUFBLFdBQUEsSUFFQSxJQURBLFFBQUEsSUFBQSxTQUFBLFFBQUEsTUFDQSxlQUFBLFFBQUEsS0FDQSxPQUFBLFNBQUEsU0FDQSxDQUNBLFFBQUEsSUFBQSxlQUFBLElBQ0EsSUFBQSxPQUFBLFNBQUEsSUFDQSxRQUFBLGFBQUEsTUFBQSxVQUlBLE9BQUEsRUFDQSxhQUFBLHdDQUNBLE1BQUEsZUFDQSxhQUFBLFdBQ0EsWUFBQSxFQUFBLFlBQ0EsRUFBQSxZQUFBLE1BQUEsWUFBQSxjQUNBLFVBQ0EsS0FBQSxTQUFBLFNBRUEsRUFBQSxXQUFBLFlBQUEsUUFBQSxHQUFBLGVBRUEsSUFBQSxXQUNBLEVBQUEsV0FBQSxZQUFBLE1BQUEsY0FFQSxJQUFBLFNBQUEsU0FDQSxFQUFBLFFBQUEsU0FBQSx3QkFBQSxHQUVBLEVBQUEsV0FBQSxXQUFBLFFBQUEsR0FBQSxlQUlBLGNBQUEsU0FBQSxPQUNBLEdBQUEsT0FBQSxFQUFBLE1BQUEsUUFBQSxRQUFBLGFBQUEsS0FBQSxLQVNBLE9BTkEsR0FBQSxRQUFBLEtBQUEsV0FBQSxPQUFBLE9BQUEsSUFBQSxHQUNBLE9BQUEsT0FBQSxJQUFBLEVBQ0EsRUFBQSxRQUFBLEtBQUEsV0FBQSxZQUFBLFNBQUEscUJBRUEsRUFBQSxRQUFBLFdBQUEsWUFBQSxZQUFBLHNCQUVBLFFBS0EsRUFBQSxXQUFBLFFBQUEsZ0JBQ0EsUUFBQSxFQUNBLEtBQUEsRUFDQSxNQUFBLEVBQ0EsS0FBQSxFQUNBLFNBQUEsYUFLQSxnQkFBQSxFQUFBLG9CQUFBLEVBQUEsZUFBQSxLQUtBLE9BQUEsU0FBQSxRQUVBLFdBQUEscUJBQUEsU0FBQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsT0FDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxRQUVBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxPQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsTUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsd0JBQUEsU0FBQSxpQkFBQSxTQUFBLFFBQUEsY0FDQSxTQUFBLE9BQUEsZUFBQSxPQUFBLE1BQUEsYUFDQSxPQUFBLEtBQUEsWUFFQSxPQUFBLE9BQUEsV0FDQSxlQUFBLFFBQUEsV0FHQSxPQUFBLE9BQUEsV0FDQSxHQUFBLFdBQUEsV0FDQSxlQUFBLFFBQ0EsT0FBQSxHQUFBLGlCQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLE9BQUEsT0FBQSxPQUFBLEtBQUEsZUFHQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxjQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsWUFBQSxPQUNBLFFBQUEsSUFBQSxhQUNBLE9BQUEsS0FBQSxXQUNBLElBQUEsU0FBQSxpQkFBQSxPQUFBLEtBQUEsSUFFQSxHQUFBLE1BRUEsS0FBQSxNQUNBLElBQUEsUUFDQSxTQUFBLE9BQ0EsT0FBQSxFQUNBLFFBQUEsU0FBQSxLQUNBLE9BQUEsT0FBQSxJQUFBLEtBQUEsVUFJQSxPQUFBLE1BQ0EsS0FHQSxPQUFBLE1BQUEsT0FBQSxLQUFBLEtBQ0EsT0FBQSxTQUFBLFdBQ0EsR0FBQSxPQUFBLFNBQUEsT0FBQSxDQUNBLEdBQUEsV0FBQSxTQUFBLFNBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxRQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsUUFBQSxLQUFBLEtBQUEsT0FBQSxNQUNBLE1BQUEsT0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSxzQkFBQSxTQUFBLFNBQUEsU0FBQSxhQUNBLFNBQUEsT0FBQSxPQUFBLE9BQUEsWUFDQSxRQUFBLElBQUEsbUNBQ0EsT0FBQSxLQUFBLFdBRUEsT0FBQSxhQUFBLFdBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxPQUFBLEtBQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsS0FHQSxPQUFBLGlCQUFBLFdBQ0EsT0FBQSxHQUFBLGlCQUFBLE9BQUEsT0FBQSxLQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEtBR0EsT0FBQSxpQkFBQSxXQUNBLE9BQUEsTUFDQSxZQUFBLGdEQUNBLFdBQUEsdUJBQ0EsU0FDQSxZQUFBLFdBQ0EsTUFBQSxRQUFBLGFDdG5CQSxRQUFBLE9BQUEscUJBQUEsZUFDQSxRQUFBLFNBQUEsWUFBQSxzQkFBQSxTQUFBLFVBQUEscUJBQ0EsR0FBQSxLQUFBLFVBQUEsaUJBQUEsR0FBQSxRQUNBLE9BQUEsT0FBQSxNQUFBLFVBQUEsU0FBQSxHQUNBLEtBQUEsT0FBQSxPQUNBLE1BQUEsT0FBQSxRQUNBLFFBQUEsT0FBQSxRQUdBLFFBQ0EsU0FBQSxTQUFBLEtBQUEsaUJBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUNBLG9CQUFBLGFBQUEsb0NBQUEsV0FDQSxxQkFHQSxNQUFBLFNBQUEsV0FBQSxVQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxZQUFBLFVBRUEsSUFBQSxTQUFBLFFBQ0EsTUFBQSxLQUFBLEtBQUEsR0FBQSxTQUFBLFVBRUEsS0FBQSxTQUFBLEtBQUEsaUJBQ0EsSUFBQSxLQUFBLEtBQUEsU0FBQSxPQUNBLG9CQUFBLGFBQUEsaUNBQUEsV0FDQSxnQkFBQSxVQUdBLE9BQUEsU0FBQSxLQUFBLGlCQUNBLElBQUEsT0FBQSxLQUFBLFNBQUEsU0FDQSxvQkFBQSxhQUFBLG9DQUFBLFdBQ0EsZ0JBQUEsZ0JDL0JBLFFBQUEsT0FBQSxRQUNBLHVCQUVBLFFBQ0EsZ0JBQUEscUJBQ0EsU0FBQSxjQUFBLDBCQUNBLGVBQUEsU0FBQSxRQUFBLE9BQUEsb0JBQ0EsbUJBQUEsU0FBQSxTQUFBLE9BQUEsU0FBQSxLQUFBLFFBQ0EsWUFDQSwyQkFLQSxXQUFBLDRCQUNBLFNBQUEsUUFBQSxVQUFBLFVBQ0EsU0FBQSxRQUNBLE9BQUEsU0FDQSxJQUFBLFFBS0EsV0FBQSx5QkFDQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQ0EsR0FDQSxPQURBLEtBQUEsT0FBQSxJQUVBLE1BQUEsS0FDQSxLQUFBLE9BQUEsV0FDQSxNQUFBLFFBRUEsS0FBQSxTQUFBLFdBRUEsTUFEQSxPQUFBLFVBQ0EsT0FDQSxJQUFBLEtBQUEsVUFDQSxPQUFBLEtBQUEsYUFDQSxLQUNBLFdBQ0EsTUFBQSxXQUNBLE9BQUEsTUFBQSxPQUVBLFdBQ0EsTUFBQSxlQUlBLEtBQUEsU0FBQSxLQUFBLFNBQ0EsS0FBQSxRQUFBLFdBQ0EsT0FBQSxNQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBBcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAgICduZ0xvY2FsZScsXG4gICAgJ25nQ29va2llcycsXG4gICAgJ25nUmVzb3VyY2UnLFxuICAgICduZ1Nhbml0aXplJyxcbiAgICAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScsXG4gICAgJ3VpLmJvb3RzdHJhcCcsXG4gICAgJ3VpLnJvdXRlcicsXG4gICAgJ3VpLnV0aWxzJyxcbiAgICAndWkubGF5b3V0JyxcbiAgICAnYW5ndWxhci1ncm93bCcsXG4gICAgJ2FuZ3VsYXJNb21lbnQnLFxuICAgICdhbmd1bGFyVXRpbHMuZGlyZWN0aXZlcy5kaXJQYWdpbmF0aW9uJyxcbiAgICAnc2NoZW1hRm9ybScsXG4gICAgJ2FuZ3VsYXItanFncmlkJyxcblxuICAgIC8vUGFydGlhbHNcbiAgICAnYXBwLnBhcnRpYWxzJyxcblxuICAgIC8vQ29tbW9uXG4gICAgJ2FwcC5jb21tb24uY29uZmlnJywgJ2FwcC5jb21tb24uZGlyZWN0aXZlcycsICdhcHAuY29tbW9uLnNlcnZpY2VzJyxcblxuICAgIC8vU2VhcmNoXG4gICAgJ2FwcC5zZWFyY2guc2VydmljZXMnLFxuXG4gICAgLy9Ub2RvXG4gICAgJ2FwcC50b2RvLmNvbnRyb2xsZXJzJywgJ2FwcC50b2RvLnNlcnZpY2VzJyxcbiAgICBcbiAgICAnYXBwLnN5c3RlbS5jb250cm9sbGVycycsICdhcHAuc3lzdGVtLnNlcnZpY2VzJyxcbiAgICBcbiAgICAnYXBwLmNtaXMuc2VydmljZXMnXG5cbl0pO1xuXG4iLCIvKlxyXG4qIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxyXG4qXHJcbiogQ29weXJpZ2h0IChjKSAyMDE2IERldmVsZXIgZGV2Z2luaWVcclxuKlxyXG4qIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXHJcbiogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xyXG4qIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcclxuKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxyXG4qXHJcbiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXHJcbiogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cclxuKlxyXG4qIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxyXG4qIFNPRlRXQVJFLlxyXG4qL1xyXG5cclxuLyogZ2xvYmFsICQgKi9cclxuLyogZ2xvYmFsIGFuZ3VsYXIgKi9cclxuLyogZ2xvYmFsIGpRdWVyeSAqL1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXItanFncmlkJywgW10pLmRpcmVjdGl2ZSgnanFHcmlkJywgZnVuY3Rpb24oKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgdGVtcGxhdGU6ICc8dGFibGU+PC90YWJsZT4nLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgZGF0YXNldDogJz0nLFxyXG4gICAgICBvcHRpb25zOiAnPScsXHJcbiAgICAgIGNhbGxiYWNrOiAnPScsXHJcbiAgICAgIHBhZ2VyOiAnPSdcclxuICAgIH0sXHJcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xyXG4gICAgICB2YXIganFHcmlkID0gbnVsbDtcclxuICAgICAgdmFyIGhlaWdodCA9IGF0dHJpYnV0ZXMuaGVpZ2h0IHx8ICcxMDAlJztcclxuXHJcbiAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGdyaWRPYmo7XHJcblxyXG4gICAgICAgIGlmIChzY29wZS5kYXRhc2V0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIC8vIEV4Y2VwdGlvbiBwcm9jZXNzIGlmIGRhdGFzZXQgaXMgZW1wdHkuXHJcbiAgICAgICAgICByZXR1cm4gZ3JpZE9iajtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBvcHRpb25zID0ge307XHJcblxyXG4gICAgICAgIG9wdGlvbnMuZGF0YSA9IHNjb3BlLmRhdGFzZXQ7XHJcblxyXG4gICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCBvcHRpb25zLCBzY29wZS5vcHRpb25zKTtcclxuXHJcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4gICAgICAgIGdyaWRPYmogPSAkKGVsZW1lbnQuY2hpbGRyZW4oKVswXSkuanFHcmlkKG9wdGlvbnMpO1xyXG5cclxuICAgICAgICBpZiAoc2NvcGUuY2FsbGJhY2spIHtcclxuICAgICAgICAgIHNjb3BlLmNhbGxiYWNrKGdyaWRPYmopO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGdyaWRPYmo7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL1xyXG4gICAgICAvLyBFdmVudHNcclxuICAgICAgLy9cclxuICAgICAgLy8gV2luZG93IFJlc2l6ZVxyXG4gICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBwYXJlbnRFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpLnBhcmVudCgpO1xyXG4gICAgICAgIGpxR3JpZC5zZXRHcmlkV2lkdGgocGFyZW50RWxlbWVudC53aWR0aCgpKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgKiBXYXRjaGVzXHJcbiAgICAgICovXHJcbiAgICAgIHZhciBvbk9wdGlvbnNDaGFuZ2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAganFHcmlkID0gaW5pdCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdmFyIHVud2F0Y2hPcHRpb25zID0gc2NvcGUuJHdhdGNoKCdvcHRpb25zJywgb25PcHRpb25zQ2hhbmdlZCwgdHJ1ZSk7XHJcblxyXG4gICAgICB2YXIgb25EYXRhc2V0Q2hhbmdlZCA9IGZ1bmN0aW9uKGRhdGFzZXQpIHtcclxuICAgICAgICB2YXIgc3RhcnREYXRhQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIGlmIChqcUdyaWQpIHtcclxuXHJcbiAgICAgICAgICBqcUdyaWQuanFHcmlkKCdjbGVhckdyaWREYXRhJyk7XHJcbiAgICAgICAgICAvLyAvLyBCdWdmaXggOiDqsLHsi6Ag7ZuEIHVuZGVmaW5lZCDtlonsnYQg7KCc6rGw7ZWY6riwIOychO2VtCBncmlkRGF0YSDquLjsnbTrpbwg7LK07YGsIO2bhCDruYjqsJIg7ZWg64u5XHJcbiAgICAgICAgICBpZigganFHcmlkLmdldCgwKS5wLnRyZWVHcmlkKSB7XHJcbiAgICAgICAgICAgIHZhciBwZXJmVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBqcUdyaWQuZ2V0KDApLmFkZEpTT05EYXRhKHtcclxuICAgICAgICAgICAgICByb3dzIDogZGF0YXNldFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZEpTT05EYXRhIDogJywgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBwZXJmVGltZSwgJ21zJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAganFHcmlkLmpxR3JpZCgnc2V0R3JpZFBhcmFtJywge1xyXG4gICAgICAgICAgICAgIGRhdGF0eXBlOiAnbG9jYWwnLFxyXG4gICAgICAgICAgICAgIGRhdGE6IGRhdGFzZXQsXHJcbiAgICAgICAgICAgICAgcm93TnVtOiBkYXRhc2V0Lmxlbmd0aFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vXHJcbiAgICAgICAgICAvLyBqcUdyaWQudHJpZ2dlcigncmVsb2FkR3JpZCcpO1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkRhdGFzZXRDaGFuZ2VkIDogJywgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydERhdGFDaGFuZ2VkLCAnbXMnKTtcclxuXHJcbiAgICAgICAgICByZXR1cm4ganFHcmlkLnRyaWdnZXIoJ3JlbG9hZCcpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIGpxR3JpZCA9IGluaXQoKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgdmFyIHVud2F0Y2hEYXRhc2V0ID0gc2NvcGUuJHdhdGNoKCdkYXRhc2V0Jywgb25EYXRhc2V0Q2hhbmdlZCwgZmFsc2UpO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICogVGVhciBEb3duXHJcbiAgICAgICovXHJcbiAgICAgIGVsZW1lbnQub24oJyRkZXN0cm95JywgZnVuY3Rpb24gb25EZXN0cm95KCkge1xyXG4gICAgICAgIHVud2F0Y2hEYXRhc2V0KCk7XHJcbiAgICAgICAgdW53YXRjaE9wdGlvbnMoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG4gIH07XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuY29tbW9uLmNvbmZpZycsIFtdKVxuICAgIC5jb25maWcoWyckdXJsUm91dGVyUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG4gICAgICAgICAgICAvLyBXaXRob3V0IHNlcnZlciBzaWRlIHN1cHBvcnQgaHRtbDUgbXVzdCBiZSBkaXNhYmxlZC5cbiAgICAgICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5jb25maWcoWyckdHJhbnNsYXRlUHJvdmlkZXInLCBmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIEluaXRpYWxpemUgYW5ndWxhci10cmFuc2xhdGVcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVN0YXRpY0ZpbGVzTG9hZGVyKHtcbiAgICAgICAgICAgIHByZWZpeDogJy9pYWFkbWluL2Zyb250ZW5kL2kxOG4vJyxcbiAgICAgICAgICAgIHN1ZmZpeDogJy5qc29uJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXIucHJlZmVycmVkTGFuZ3VhZ2UoJ2VuJyk7XG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJMb2coKTtcbiAgICB9XSlcbiAgICAuY29uZmlnKFsnZ3Jvd2xQcm92aWRlcicsIGZ1bmN0aW9uIChncm93bFByb3ZpZGVyKSB7XG4gICAgICAgIGdyb3dsUHJvdmlkZXIuZ2xvYmFsVGltZVRvTGl2ZSg1MDAwKTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5kaXJlY3RpdmVzJywgW10pXG4gICAgLmRpcmVjdGl2ZSgnc3RhdGljSW5jbHVkZScsIFsnJGh0dHAnLCAnJHRlbXBsYXRlQ2FjaGUnLCAnJGNvbXBpbGUnLCBmdW5jdGlvbiAoJGh0dHAsICR0ZW1wbGF0ZUNhY2hlLCAkY29tcGlsZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgdGVtcGxhdGVQYXRoID0gYXR0cnMuc3RhdGljSW5jbHVkZTtcblxuICAgICAgICAgICAgJGh0dHAuZ2V0KHRlbXBsYXRlUGF0aCwge2NhY2hlOiAkdGVtcGxhdGVDYWNoZX0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gJCgnPGRpdi8+JykuaHRtbChyZXNwb25zZSkuY29udGVudHMoKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoY29udGVudHMpO1xuICAgICAgICAgICAgICAgICRjb21waWxlKGNvbnRlbnRzKShzY29wZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5zZXJ2aWNlcycsIFtdKVxuICAgIC5zZXJ2aWNlKCdOb3RpZmljYXRpb25TZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgJ2dyb3dsJywgZnVuY3Rpb24gKCRyb290U2NvcGUsIGdyb3dsKSB7XG4gICAgICAgIHZhciBmbGFzaE1lc3NhZ2VRdWV1ZSA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb24obWVzc2FnZSwgdHlwZSkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZFN1Y2Nlc3NNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2FybicpIHtcbiAgICAgICAgICAgICAgICBncm93bC5hZGRXYXJuTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2luZm8nKSB7XG4gICAgICAgICAgICAgICAgZ3Jvd2wuYWRkSW5mb01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZEVycm9yTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERpc3BsYXkgYWxsIGZsYXNoIG5vdGlmaWNhdGlvbnMgYWZ0ZXIgc3RhdGUgaGFzIGNoYW5nZWRcbiAgICAgICAgJHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdWNjZXNzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHdoaWxlIChmbGFzaE1lc3NhZ2VRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBmbGFzaE1lc3NhZ2VRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb3RpZmljYXRpb24oaXRlbS5tZXNzYWdlLCBpdGVtLnR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUHVibGljIEFQSVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2ZsYXNoTWVzc2FnZSc6IGZ1bmN0aW9uIChtZXNzYWdlLCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgZmxhc2hNZXNzYWdlUXVldWUucHVzaCh7bWVzc2FnZTogbWVzc2FnZSwgdHlwZTogdHlwZSB8fCAnaW5mbyd9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuc2VhcmNoLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1NlYXJjaCcsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgICAgIHZhciBhcGkgPSAkcmVzb3VyY2UoJy9hcGkvZG9jcy9zZWFyY2gnLCB7fSwge1xuICAgICAgICAgICAgJ3F1ZXJ5JzogIHttZXRob2Q6J0dFVCcsIGlzQXJyYXk6ZmFsc2V9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaW5kQnlTZWFyY2hUZXJtOiBmdW5jdGlvbihzZWFyY2hUZXJtLCBwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkucXVlcnkoe3BhZ2U6IHBhZ2VOdW1iZXIsIHNlYXJjaFRlcm06IHNlYXJjaFRlcm0sIHNpemU6IHBhZ2VTaXplLCBzb3J0OiAnSUQsREVTQyd9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNtaXMuc2VydmljZXMnLCBbJ25nUmVzb3VyY2UnXSlcbiAgICAuZmFjdG9yeSgnQ01JUycsIFsnJHJlc291cmNlJywgJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UsIE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGFwaSA9ICRyZXNvdXJjZSgnL2pvb3EvYnJvd3Nlci90ZXN0L3Jvb3Q/Y21pc3NlbGVjdG9yPWNoaWxkcmVuJm9iamVjdElkPTppZCcsIHtcImlkXCI6IFwiQGlkXCJ9LCB7XG4gICAgICAgICAgICBxdWVyeTogIHttZXRob2Q6ICdHRVQnLCBwYXJhbXM6IHt9LCBpc0FycmF5OiBmYWxzZX1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHF1ZXJ5OiBmdW5jdGlvbihmb2xkZXJJZCwgcGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpLnF1ZXJ5KHtpZDogZm9sZGVySWQsIHBhZ2U6IHBhZ2VOdW1iZXIsIHNpemU6IHBhZ2VTaXplLCBzb3J0OiAnSUQsREVTQyd9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLnN5c3RlbS5jb250cm9sbGVycycsIFtdKVxuICAgIC5jb25zdGFudCgncGFnaW5hdGlvbkNvbmZpZycsIHtcbiAgICAgICAgcGFnZVNpemU6IDIwMFxuICAgIH0pXG4gICAgXG4gICAgLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnc3lzdGVtJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPHVpLXZpZXcvPidcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3N5c3RlbS5pbmRleCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1N5c3RlbUxpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3RvZG8tbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBcdHNlYXJjaFJlc3VsdHM6IFsnU3lzdGVtJywgJ3BhZ2luYXRpb25Db25maWcnLCBmdW5jdGlvbihTeXN0ZW0sIHBhZ2luYXRpb25Db25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLnF1ZXJ5KDAsIHBhZ2luYXRpb25Db25maWcucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdzeXN0ZW0uYWRkJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdzeXN0ZW0vYWRkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FkZFN5c3RlbUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vYWRkLXRvZG8uaHRtbCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnc3lzdGVtLmVkaXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3N5c3RlbS86c3lzdGVtSWQvZWRpdCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0U3lzdGVtQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9lZGl0LXRvZG8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRUb2RvOiBbJ1N5c3RlbScsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihTeXN0ZW0sICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuc3lzdGVtSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5nZXQoJHN0YXRlUGFyYW1zLnN5c3RlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3N5c3RlbS52aWV3Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdzeXN0ZW0vOnN5c3RlbUlkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1ZpZXdTeXN0ZW1Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3ZpZXctdG9kby5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlld2VkVG9kbzogWydTeXN0ZW0nLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oU3lzdGVtLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnN5c3RlbUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uZ2V0KCRzdGF0ZVBhcmFtcy5zeXN0ZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgXSlcbiAgICAuY29udHJvbGxlcignU3lzdGVtTGlzdENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnc2VhcmNoUmVzdWx0cycsJ3BhZ2luYXRpb25Db25maWcnLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgc2VhcmNoUmVzdWx0cywgcGFnaW5hdGlvbkNvbmZpZykge1xuICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIGRvY3VtZW50cy4nKTtcbiAgICAgICAgJHNjb3BlLnRvZG9zID0gc2VhcmNoUmVzdWx0cy5jb250ZW50O1xuICAgICAgICBjb25zb2xlLmxvZyhzZWFyY2hSZXN1bHRzKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzKTtcbiAgICAgICAgY29uc29sZS5sb2cocGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSk7XG4gICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0ge1xuICAgICAgICAgICAgY3VycmVudFBhZ2U6IHNlYXJjaFJlc3VsdHMubnVtYmVyICsgMSxcbiAgICAgICAgICAgIGl0ZW1zUGVyUGFnZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSxcbiAgICAgICAgICAgIHRvdGFsSXRlbXM6IHNlYXJjaFJlc3VsdHMudG90YWxFbGVtZW50c1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLmFkZFRvZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnc3lzdGVtLmFkZCcpO1xuICAgICAgICB9O1xuXG4gICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ0FkZFN5c3RlbUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnU3lzdGVtJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIFN5c3RlbSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBhZGQgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB7fTtcblxuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N5c3RlbS52aWV3Jywge3N5c3RlbUlkOiBhZGRlZC5pZH0sIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2RvLmRhdGE9SlNPTi5wYXJzZSgkc2NvcGUudG9kby5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLnNhdmUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ0RlbGV0ZVN5c3RlbUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbW9kYWxJbnN0YW5jZScsICckc3RhdGUnLCAnU3lzdGVtJywgJ2RlbGV0ZWRUb2RvJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkbW9kYWxJbnN0YW5jZSwgJHN0YXRlLCBTeXN0ZW0sIGRlbGV0ZWRUb2RvKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IGRlbGV0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N5c3RlbS5pbmRleCcsIHt9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgU3lzdGVtLmRlbGV0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKSAgICAgICAgXG5cbiAgICAuY29udHJvbGxlcignRWRpdFN5c3RlbUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAndXBkYXRlZFRvZG8nLCAnU3lzdGVtJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHVwZGF0ZWRUb2RvLCBTeXN0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04uc3RyaW5naWZ5KCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3lzdGVtLnZpZXcnLCB7c3lzdGVtSWQ6IHVwZGF0ZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04ucGFyc2UoJHNjb3BlLnRvZG8uZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbS51cGRhdGUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ1ZpZXdTeXN0ZW1Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJyRtb2RhbCcsICd2aWV3ZWRUb2RvJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRtb2RhbCwgdmlld2VkVG9kbykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyB2aWV3IHRvZG8gZW50cnkgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdmlld2VkVG9kbztcblxuICAgICAgICAgICAgJHNjb3BlLnNob3dFZGl0UGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyhcInN5c3RlbS5lZGl0XCIsIHtzeXN0ZW1JZDogJHNjb3BlLnRvZG8uaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0RlbGV0ZURpYWxvZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2RlbGV0ZS10b2RvLW1vZGFsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGVsZXRlU3lzdGVtQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRUb2RvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS50b2RvO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuc3lzdGVtLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1N5c3RlbScsIFsnJHJlc291cmNlJywgJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UsIE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGFwaSA9ICRyZXNvdXJjZSgnL2FwaS9zeXN0ZW0vOmlkJywge1wiaWRcIjogXCJAaWRcIn0sIHtcbiAgICAgICAgICAgIHF1ZXJ5OiAge21ldGhvZDogJ0dFVCcsIHBhcmFtczoge30sIGlzQXJyYXk6IGZhbHNlfSxcbiAgICAgICAgICAgIGdldDogICAge21ldGhvZDogJ0dFVCd9LFxuICAgICAgICAgICAgc2F2ZToge21ldGhvZDogJ1BPU1QnfSxcbiAgICAgICAgICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCd9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWxldGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkuZGVsZXRlKHRvZG8sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmRlbGV0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcXVlcnk6IGZ1bmN0aW9uKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5xdWVyeSh7cGFnZTogcGFnZU51bWJlciwgc2l6ZTogcGFnZVNpemUsIHNvcnQ6ICdJRCxERVNDJ30pLiRwcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24odG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQoe2lkOiB0b2RvSWR9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlOiBmdW5jdGlvbih0b2RvLCBzdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBhcGkuc2F2ZSh0b2RvLCBmdW5jdGlvbihhZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmFkZC5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGFkZGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUodG9kbywgZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLnVwZGF0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAudG9kby5jb250cm9sbGVycycsIFtdKVxuICAgIC5jb25zdGFudCgncGFnaW5hdGlvbkNvbmZpZycsIHtcbiAgICAgICAgcGFnZVNpemU6IDIwMFxuICAgIH0pXG4gICAgXG4gICAgLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kbycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzx1aS12aWV3Lz4nXG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmluZGV4Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVG9kb0xpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3RvZG8tbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBcdHNlYXJjaFJlc3VsdHM6IFsnVG9kb3MnLCAncGFnaW5hdGlvbkNvbmZpZycsIGZ1bmN0aW9uKFRvZG9zLCBwYWdpbmF0aW9uQ29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLnF1ZXJ5KDAsIHBhZ2luYXRpb25Db25maWcucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLnRyZWUnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vdHJlZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb2RvVHJlZUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdG9kby10cmVlLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIFx0c2VhcmNoUmVzdWx0czogWydDTUlTJywgJ3BhZ2luYXRpb25Db25maWcnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oQ01JUywgcGFnaW5hdGlvbkNvbmZpZywkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ01JUy5xdWVyeSgnMCcsMCwgcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLnBhZ2UnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vcGFnZS86cGFnZU51bWJlci9zaXplLzpwYWdlU2l6ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb2RvTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdG9kby1saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIFx0c2VhcmNoUmVzdWx0czogWydUb2RvcycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihUb2RvcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLnF1ZXJ5KCRzdGF0ZVBhcmFtcy5wYWdlTnVtYmVyIC0gMSwgJHN0YXRlUGFyYW1zLnBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kby5hZGQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vYWRkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FkZFRvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2FkZC10b2RvLmh0bWwnXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uZWRpdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby86dG9kb0lkL2VkaXQnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRWRpdFRvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2VkaXQtdG9kby5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFRvZG86IFsnVG9kb3MnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oVG9kb3MsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMudG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUb2Rvcy5nZXQoJHN0YXRlUGFyYW1zLnRvZG9JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmVkaXRmb3JtJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvLzp0b2RvSWQvZWRpdGZvcm0nLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRWRpdEZvcm1Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2VkaXQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFRvZG86IFsnVG9kb3MnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oVG9kb3MsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMudG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUb2Rvcy5nZXQoJHN0YXRlUGFyYW1zLnRvZG9JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLnNlYXJjaCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby9zZWFyY2gvOnNlYXJjaFRlcm0vcGFnZS86cGFnZU51bWJlci9zaXplLzpwYWdlU2l6ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZWFyY2hSZXN1bHRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy9zZWFyY2gvc2VhcmNoLXJlc3VsdHMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFRlcm06IFsnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5zZWFyY2hUZXJtO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hSZXN1bHRzOiBbJ1NlYXJjaCcsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihTZWFyY2gsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuc2VhcmNoVGVybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2VhcmNoLmZpbmRCeVNlYXJjaFRlcm0oJHN0YXRlUGFyYW1zLnNlYXJjaFRlcm0sICRzdGF0ZVBhcmFtcy5wYWdlTnVtYmVyIC0gMSwgJHN0YXRlUGFyYW1zLnBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kby52aWV3Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvLzp0b2RvSWQnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVmlld1RvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3ZpZXctdG9kby5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlld2VkVG9kbzogWydUb2RvcycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihUb2RvcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy50b2RvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLmdldCgkc3RhdGVQYXJhbXMudG9kb0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5jb250cm9sbGVyKCdUb2RvTGlzdENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnc2VhcmNoUmVzdWx0cycsJ3BhZ2luYXRpb25Db25maWcnLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgc2VhcmNoUmVzdWx0cywgcGFnaW5hdGlvbkNvbmZpZykge1xuICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIGRvY3VtZW50cy4nKTtcbiAgICAgICAgJHNjb3BlLnRvZG9zID0gc2VhcmNoUmVzdWx0cy5jb250ZW50O1xuICAgICAgICBjb25zb2xlLmxvZyhzZWFyY2hSZXN1bHRzKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzKTtcbiAgICAgICAgY29uc29sZS5sb2cocGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSk7XG4gICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0ge1xuICAgICAgICAgICAgY3VycmVudFBhZ2U6IHNlYXJjaFJlc3VsdHMubnVtYmVyICsgMSxcbiAgICAgICAgICAgIGl0ZW1zUGVyUGFnZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSxcbiAgICAgICAgICAgIHRvdGFsSXRlbXM6IHNlYXJjaFJlc3VsdHMudG90YWxFbGVtZW50c1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLmFkZFRvZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby5hZGQnKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5vcGVuVHJlZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnRyZWUnKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5wYWdlQ2hhbmdlZCA9IGZ1bmN0aW9uKG5ld1BhZ2VOdW1iZXIpIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby5wYWdlJyxcbiAgICAgICAgICAgICAgICB7cGFnZU51bWJlcjogbmV3UGFnZU51bWJlciwgcGFnZVNpemU6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemV9LFxuICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG4gICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ0VkaXRUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICd1cGRhdGVkVG9kbycsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCB1cGRhdGVkVG9kbywgVG9kb3MpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04uc3RyaW5naWZ5KCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby52aWV3Jywge3RvZG9JZDogdXBkYXRlZC5pZH0sIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2RvLmRhdGE9SlNPTi5wYXJzZSgkc2NvcGUudG9kby5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgVG9kb3MudXBkYXRlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLFxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcpIHtcblxuICAgICAgICAgICAgdmFyIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoID0gMztcblxuICAgICAgICAgICAgJHNjb3BlLm1pc3NpbmdDaGFycyA9IG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoO1xuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaFRlcm0gPSBcIlwiO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXNlcldyaXRpbmdTZWFyY2hUZXJtID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoRmllbGRGb2N1cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHVzZXJXcml0aW5nU2VhcmNoVGVybSA9IHRydWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd01pc3NpbmdDaGFyYWN0ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJXcml0aW5nU2VhcmNoVGVybSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaFRlcm0ubGVuZ3RoIDwgbWluaW11bVNlYXJjaFRlcm1MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGggPCBtaW5pbXVtU2VhcmNoVGVybUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gbWluaW11bVNlYXJjaFRlcm1MZW5ndGggLSAkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB7c2VhcmNoVGVybTogJHNjb3BlLnNlYXJjaFRlcm0sIHBhZ2VOdW1iZXI6IDEsIHBhZ2VTaXplOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1dKVxuICAuY29udHJvbGxlcignU2VhcmNoUmVzdWx0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdwYWdpbmF0aW9uQ29uZmlnJywgJ3NlYXJjaFRlcm0nLCAnc2VhcmNoUmVzdWx0cycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBwYWdpbmF0aW9uQ29uZmlnLCBzZWFyY2hUZXJtLCBzZWFyY2hSZXN1bHRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIHNlYXJjaCByZXN1bHRzIHBhZ2UuJyk7XG4gICAgICAgICAgICAkc2NvcGUudG9kb3MgPSBzZWFyY2hSZXN1bHRzLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgICRzY29wZS5wYWdpbmF0aW9uID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBzZWFyY2hSZXN1bHRzLm51bWJlciArIDEsXG4gICAgICAgICAgICAgICAgaXRlbXNQZXJQYWdlOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplLFxuICAgICAgICAgICAgICAgIHRvdGFsSXRlbXM6IHNlYXJjaFJlc3VsdHMudG90YWxFbGVtZW50c1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLnBhZ2VDaGFuZ2VkID0gZnVuY3Rpb24obmV3UGFnZU51bWJlcikge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndG9kby5zZWFyY2gnLFxuICAgICAgICAgICAgICAgICAgICB7c2VhcmNoVGVybTogc2VhcmNoVGVybSwgcGFnZU51bWJlcjogbmV3UGFnZU51bWJlciwgcGFnZVNpemU6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemV9LFxuICAgICAgICAgICAgICAgICAgICB7cmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWV9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgICAgICBcbiAgLmNvbnRyb2xsZXIoJ0RvY3VtZW50TW9kYWxDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJG1vZGFsSW5zdGFuY2UnLCAnJHN0YXRlJywgJ1RvZG9zJywgJ3ZpZXdlZERvYycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgVG9kb3MsIHZpZXdlZERvYykge1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB2aWV3ZWREb2M7XG5cbiAgICAgICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS5lZGl0RG9jdW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKSAgICAgIFxuICAuY29udHJvbGxlcignVG9kb1RyZWVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJyRtb2RhbCcsICdUb2RvcycsICdzZWFyY2hSZXN1bHRzJywncGFnaW5hdGlvbkNvbmZpZycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkbW9kYWwsIFRvZG9zLCBzZWFyY2hSZXN1bHRzLCBwYWdpbmF0aW9uQ29uZmlnKSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBkb2N1bWVudHMgdHJlZS4nKTtcbiAgICAgICAgdmFyIGN1cnJlbnREZWZGb3JtSWQ9Jyc7XG4gICAgICAgIHZhciBjbWlzX3Jvb3Q9IFwiL2pvb3EvYnJvd3Nlci90ZXN0L3Jvb3RcIjtcblx0XHQgICAgJCgnI3RyZWVjb250YWluZXInKS5qc3RyZWUoe1xuXHRcdCAgICAnY29yZScgOiB7XG5cdFx0ICAgICAgJ2RhdGEnIDoge1xuXHRcdCAgICAgICAgXCJ1cmxcIiA6IGZ1bmN0aW9uIChub2RlKSB7XG5cdFx0XHRcdFx0ICByZXR1cm4gbm9kZS5pZCA9PT0gJyMnID9cblx0XHRcdFx0XHRcdGNtaXNfcm9vdCtcIj9vYmplY3RJZD0wJmNtaXNzZWxlY3Rvcj1jaGlsZHJlblwiIDpcblx0XHRcdFx0XHRcdGNtaXNfcm9vdCtcIj9vYmplY3RJZD1cIitub2RlLmlkK1wiJmNtaXNzZWxlY3Rvcj1jaGlsZHJlblwiO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFwiZGF0YUZpbHRlclwiIDogZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0XHR2YXIgbm9kZXMgPSBbXTtcblx0XHRcdFx0XHQkLmVhY2goSlNPTi5wYXJzZShkYXRhKS5vYmplY3RzLCBmdW5jdGlvbihpLGl0ZW0pe1xuXHRcdFx0XHRcdFx0dmFyIG5vZGUgPSB7fTtcblx0XHRcdFx0XHRcdG5vZGUuaWQ9IGl0ZW0ub2JqZWN0LnByb3BlcnRpZXNbXCJjbWlzOm9iamVjdElkXCJdLnZhbHVlO1xuXHRcdFx0XHRcdFx0bm9kZS5kYXRhID0ge1widHlwZVwiOiBpdGVtLm9iamVjdC5wcm9wZXJ0aWVzW1wiY21pczpvYmplY3RUeXBlSWRcIl0udmFsdWV9O1xuXHRcdFx0XHRcdFx0bm9kZS50ZXh0PWl0ZW0ub2JqZWN0LnByb3BlcnRpZXNbXCJjbWlzOm5hbWVcIl0udmFsdWU7XG5cdFx0XHRcdFx0XHRpZiAoaXRlbS5vYmplY3QucHJvcGVydGllc1tcImNtaXM6b2JqZWN0VHlwZUlkXCJdLnZhbHVlPT1cImNtaXM6Zm9sZGVyXCIpe25vZGUuY2hpbGRyZW49dHJ1ZX1cblx0XHRcdFx0XHRcdG5vZGVzLnB1c2gobm9kZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdCAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5vZGVzKTtcblx0XHRcdFx0ICAgfSxcblx0XHQgICAgICAgIFwiZGF0YVwiIDogZnVuY3Rpb24gKG5vZGUpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhub2RlICk7XG5cdFx0ICAgICAgICAgIHJldHVybiB7IFwiaWRcIiA6IG5vZGUuaWQsIFwidGV4dFwiOiBcIjFcIiB9O1xuXHRcdCAgICAgICAgfVxuXHRcdCAgICAgIH1cblx0XHQgICAgfVxuXHRcdCAgfSk7XG5cdFx0ICAvLyQoXCIjdHJlZWNvbnRhaW5lclwiKS5qc3RyZWUoJ2NyZWF0ZV9ub2RlJywgJyMnLCB7J2lkJyA6ICcwJywgJ3RleHQnIDogJ1Jvb3QgZm9sZGVyJ30sICdsYXN0Jyk7XG5cdFx0ICAkKCcjdHJlZWNvbnRhaW5lcicpLm9uKFwic2VsZWN0X25vZGUuanN0cmVlXCIsIGZ1bmN0aW9uIChlLCBkYXRhKSB7XG5cdFx0XHQgIGNvbnNvbGUubG9nKFwibm9kZV9pZDogXCIrIGRhdGEubm9kZS50eXBlICsgXCIgLSBcIiArIGRhdGEubm9kZS5pZCk7IFxuXHRcdFx0ICBpZiAoZGF0YS5ub2RlLmRhdGEudHlwZT09XCJjbWlzOmZvbGRlclwiKXtcblx0XHRcdFx0JHNjb3BlLmxvYWRHcmlkKGRhdGEubm9kZS5pZCk7XG5cdFx0XHQgIH1lbHNle1xuXHRcdFx0XHR2YXIgZG9jaWQgPSBwYXJzZUludChkYXRhLm5vZGUuaWQpO1xuXHRcdFx0XHQvLyRzdGF0ZS5nbygndG9kby52aWV3Jywge3RvZG9JZDogZG9jaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuXHRcdFx0XHQkc2NvcGUub3BlbkRvY3VtZW50KFRvZG9zLCBkb2NpZCk7XG5cdFx0XHQgIH1cblx0XHRcdCAgXG5cdFx0XHR9KTtcblx0JHNjb3BlLm9wZW5Eb2N1bWVudCA9IGZ1bmN0aW9uKFRvZG9zLCBkb2NpZCl7XG5cdFx0dmFyIHZpZXdzVXJsID0gJy9hcGkvZG9jcy8nK2RvY2lkO1xuXHRcdCQuZ2V0SlNPTih2aWV3c1VybCwgZnVuY3Rpb24odmlld2RhdGEpIHtcblx0ICAgICAgICBpZiAodmlld2RhdGEudHlwZT09J3ZpZXcnKXtcblx0XHRcdFx0JHNjb3BlLmxvYWRHcmlkKCcwJyx2aWV3ZGF0YSk7XG5cdCAgICAgICAgfWVsc2V7XG5cdCAgICAgICAgXHQkc2NvcGUudG9kbyA9ICB2aWV3ZGF0YTtcblx0XHRcdFx0JG1vZGFsLm9wZW4oe1xuXHRcdCAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9kb2N1bWVudC12aWV3LW1vZGFsLmh0bWwnLFxuXHRcdCAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEb2N1bWVudE1vZGFsQ29udHJvbGxlcicsXG5cdFx0ICAgICAgICAgICAgcmVzb2x2ZToge1xuXHRcdCAgICAgICAgICAgICAgICB2aWV3ZWREb2M6IGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudG9kbztcblx0ICAgICAgICAgICAgICAgICAgICAgICAgfVxuXHRcdCAgICAgICAgICAgIH1cblx0XHRcdFx0fSk7IFxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHR9XG5cdCRzY29wZS5sb2FkR3JpZCA9IGZ1bmN0aW9uKGZvbGRlcklkLHZpZXdkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgZG9jdW1lbnRzIGdyaWQuJyk7XG4gICAgICAgIFxuICAgIFx0JChcIiNqcUdyaWRcIikuanFHcmlkKCdHcmlkVW5sb2FkJyk7XG4gICAgXHR2YXIgZGF0ZU9wdGlvbnM9IHtcbiAgICBcdFx0XHQvLyBkYXRhSW5pdCBpcyB0aGUgY2xpZW50LXNpZGUgZXZlbnQgdGhhdCBmaXJlcyB1cG9uIGluaXRpYWxpemluZyB0aGUgdG9vbGJhciBzZWFyY2ggZmllbGQgZm9yIGEgY29sdW1uXG4gICAgXHRcdFx0Ly8gdXNlIGl0IHRvIHBsYWNlIGEgdGhpcmQgcGFydHkgY29udHJvbCB0byBjdXN0b21pemUgdGhlIHRvb2xiYXJcbiAgICBcdFx0XHRkYXRhSW5pdDogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICBcdFx0XHRcdCQoZWxlbWVudCkuZGF0ZXBpY2tlcih7XG4gICAgXHRcdFx0XHRcdGlkOiAnb3JkZXJEYXRlX2RhdGVQaWNrZXInLFxuICAgIFx0XHRcdFx0XHRkYXRlRm9ybWF0OiAneXktbW0tZGQnLFxuICAgIFx0XHRcdFx0XHQvL21pbkRhdGU6IG5ldyBEYXRlKDIwMTAsIDAsIDEpLFxuICAgIFx0XHRcdFx0XHRtYXhEYXRlOiBuZXcgRGF0ZSgyMDIwLCAwLCAxKSxcbiAgICBcdFx0XHRcdFx0c2hvd09uOiAnZm9jdXMnXG4gICAgXHRcdFx0XHR9KTtcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdC8vIHNob3cgc2VhcmNoIG9wdGlvbnNcbiAgICBcdFx0XHRzb3B0OiBbXCJndFwiLFwibHRcIixcImVxXCJdIC8vIGd0ID0gZ3JlYXRlciAsIGx0ID0gbGVzcyAsIGVxID0gZXF1YWwgdG9cdFx0XHRcdFx0XHRcdFxuICAgIFx0XHR9O1xuICAgIFx0dmFyIGVkaXRTZXR0aW5ncyA9IHtcbiAgICBcdFx0XHRyZWNyZWF0ZUZvcm06dHJ1ZSxcbiAgICBcdFx0XHRqcU1vZGFsOmZhbHNlLFxuICAgIFx0XHRcdHJlbG9hZEFmdGVyU3VibWl0OmZhbHNlLFxuICAgIFx0XHRcdGNsb3NlT25Fc2NhcGU6dHJ1ZSxcbiAgICBcdFx0XHRzYXZla2V5OiBbdHJ1ZSwxM10sXG4gICAgXHRcdFx0Y2xvc2VBZnRlckVkaXQ6dHJ1ZSxcbiAgICBcdFx0XHRhZnRlclNob3dGb3JtOmZ1bmN0aW9uKCl7XG4gICAgXHRcdFx0XHQkKFwiI2x1aV9cIitncmlkWzBdLmlkKS5oaWRlKCk7XG4gICAgXHRcdFx0fVxuICAgIFx0XHR9O1xuICAgIFx0dmFyIGFkZFNldHRpbmdzID0ge1xuICAgIFx0XHRcdHJlY3JlYXRlRm9ybTp0cnVlLFxuICAgIFx0XHRcdGpxTW9kYWw6ZmFsc2UsXG4gICAgXHRcdFx0cmVsb2FkQWZ0ZXJTdWJtaXQ6ZmFsc2UsXG4gICAgXHRcdFx0c2F2ZWtleTogW3RydWUsMTNdLFxuICAgIFx0XHRcdGNsb3NlT25Fc2NhcGU6dHJ1ZSxcbiAgICBcdFx0XHRjbG9zZUFmdGVyQWRkOnRydWUsXG4gICAgXHRcdFx0YWZ0ZXJTaG93Rm9ybTpmdW5jdGlvbigpe1xuICAgIFx0XHRcdFx0JChcIiNsdWlfXCIrZ3JpZFswXS5pZCkuaGlkZSgpO1xuICAgIFx0XHRcdH1cbiAgICBcdFx0fTtcbiAgICBcdHZhciBkZWxTZXR0aW5ncyA9IHtcbiAgICBcdFx0XHRwcm9jZXNzaW5nOnRydWVcbiAgICBcdFx0fTtcbiAgICBcdFx0XG4gICAgXHR2YXIgaWQ9Zm9sZGVySWQ7XG4gICAgXHRcbiAgICBcdHZhciB2aWV3RW50cmllc1VybCA9IGNtaXNfcm9vdCsnP29iamVjdElkPScraWQrJyZjbWlzc2VsZWN0b3I9Y2hpbGRyZW4nO1xuICAgIFx0dmFyIHN5c19maWVsZHM9WydpZCcsICd0eXBlJywgJ3RpdGxlJywgJ2Rlc2NyaXB0aW9uJywgJ21vZGlmaWVyJywgJ21vZGlmaWNhdGlvblRpbWUnLCdhdXRvcicsJ2NyZWF0aW9uVGltZSddO1xuICAgIFx0dmFyIGZpZWxkcz1bJ2lkJywgJ3RpdGxlJywgJ2Rlc2NyaXB0aW9uJywgJ21vZGlmaWVyJywgJ21vZGlmaWNhdGlvblRpbWUnXTtcbiAgICBcdHZhciByb3dTaXplPXBhZ2luYXRpb25Db25maWcucGFnZVNpemU7XG4gICAgXHR2YXIgY29sdW1ucyA9W1xuICAgIFx0XHRcdHsgbmFtZTogJ2lkJywga2V5OiB0cnVlLCB3aWR0aDogNzUsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOm9iamVjdElkLnZhbHVlJ30sXG4gICAgXHRcdFx0eyBuYW1lOiAndHlwZScsIGxhYmVsIDogXCLQotC40L9cIix3aWR0aDogMTAwLCBqc29ubWFwOiAnb2JqZWN0LnByb3BlcnRpZXMuY21pczpvYmplY3RUeXBlSWQudmFsdWUnIH0sXG4gICAgXHRcdFx0eyBuYW1lOiAndGl0bGUnLCBsYWJlbCA6IFwi0JfQsNCz0L7Qu9C+0LLQvtC6XCIsd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6bmFtZS52YWx1ZScgfSxcbiAgICBcdFx0XHR7IG5hbWU6ICdkZXNjcmlwdGlvbicsIGxhYmVsIDogXCLQntC/0LjRgdCw0L3QuNC1XCIsIHdpZHRoOiAxNTAsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOmRlc2NyaXB0aW9uLnZhbHVlJyB9LFxuICAgIFx0XHRcdHsgbmFtZTogJ2F1dGhvcicsIGxhYmVsIDogXCLQodC+0LfQtNCw0LtcIiwgd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6Y3JlYXRlZEJ5LnZhbHVlJyB9LFxuICAgIFx0XHRcdHsgbmFtZTogJ2NyZWF0aW9uVGltZScsIGxhYmVsIDogXCLQlNCw0YLQsCDRgdC+0LfQtNCw0L3QuNGPXCIsIHdpZHRoOiAxNTAsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOmNyZWF0aW9uRGF0ZS52YWx1ZScgLCBcbiAgICBcdFx0XHRcdFx0XHRmb3JtYXR0ZXI6J2RhdGUnLCBmb3JtYXRvcHRpb25zOiB7c3JjZm9ybWF0OiAnVS8xMDAwJywgbmV3Zm9ybWF0OidkLm0uWSBIOmknfSxcbiAgICBcdFx0XHRcdFx0XHRzb3J0dHlwZTonZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNob3B0aW9uczogZGF0ZU9wdGlvbnNcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdHsgbmFtZTogJ21vZGlmaWVyJywgbGFiZWwgOiBcItCY0LfQvNC10L3QuNC7XCIsIHdpZHRoOiAxNTAsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOmxhc3RNb2RpZmllZEJ5LnZhbHVlJyB9LFxuICAgIFx0XHRcdHsgbmFtZTogJ21vZGlmaWNhdGlvblRpbWUnLCBsYWJlbCA6IFwi0JTQsNGC0LAg0LjQt9C80LXQvdC10L3QuNGPXCIsIHdpZHRoOiAxNTAsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOmxhc3RNb2RpZmljYXRpb25EYXRlLnZhbHVlJywgXG4gICAgXHRcdFx0XHRcdFx0Zm9ybWF0dGVyOidkYXRlJywgZm9ybWF0b3B0aW9uczoge3NyY2Zvcm1hdDogJ1UvMTAwMCcsIG5ld2Zvcm1hdDonZC5tLlkgSDppJ30sXG4gICAgXHRcdFx0XHRcdFx0c29ydHR5cGU6J2RhdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaG9wdGlvbnM6IGRhdGVPcHRpb25zXG4gICAgXHRcdFx0fVxuICAgIFx0XHRdO1xuICAgIFx0Y29uc29sZS5sb2codmlld2RhdGEpO1xuICAgIFx0aWYgKHZpZXdkYXRhIT1udWxsKXtcbiAgICBcdFx0dmlld0VudHJpZXNVcmwgPSB2aWV3ZGF0YS5kYXRhLnF1ZXJ5Kyc/ZmllbGRzPSc7XG4gICAgXHRcdGZpZWxkcz1bXTtcbiAgICBcdFx0Y29sdW1ucz1bXTtcbiAgICBcdFx0JC5lYWNoKHZpZXdkYXRhLmRhdGEuY29sdW1uRGVzY3JpcHRpb25zLCBmdW5jdGlvbihpLGl0ZW0pe1xuICAgIFx0XHRcdFxuICAgIFx0XHRcdGlmIChpdGVtLnZpc2libGUhPWZhbHNlKXtcbiAgICBcdFx0XHRcdHZhciBjb2xXaWR0aCA9IDE0MDtcbiAgICBcdFx0XHRcdGlmIChpdGVtLndpZHRoKSBjb2xXaWR0aCA9IHBhcnNlSW50KGl0ZW0ud2lkdGgpO1xuICAgIFx0XHRcdFx0dmFyIGZpZWxkT3BzID0ge1wibmFtZVwiOiBpdGVtLmZpZWxkLCBcImxhYmVsXCI6IGl0ZW0ubmFtZSwgXCJ3aWR0aFwiOiBjb2xXaWR0aH07XG4gICAgXHRcdFx0XHRpZiAoaXRlbS5zb3J0RmllbGQpIHtmaWVsZE9wcy5pbmRleCA9IGl0ZW0uc29ydEZpZWxkfVxuICAgIFx0XHRcdFx0aWYgKCQuaW5BcnJheShpdGVtLmZpZWxkLCBzeXNfZmllbGRzKT09LTEpe1xuICAgIFx0XHRcdFx0XHRmaWVsZE9wcy5qc29ubWFwPVwiZGF0YS5cIitpdGVtLmZpZWxkO1xuICAgIFx0XHRcdFx0XHRmaWVsZHMucHVzaChpdGVtLmZpZWxkKTtcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHRcdGlmIChpdGVtLnR5cGU9PSdJTlRFR0VSJykgZmllbGRPcHMuc2VhcmNob3B0aW9ucz17c29wdDogW1wiZ3RcIixcImx0XCIsXCJlcVwiXSB9O1xuICAgIFx0XHRcdFx0aWYgKGl0ZW0udHlwZT09J0RBVEUnKSB7XG4gICAgXHRcdFx0XHRcdGZpZWxkT3BzLnNvcnR0eXBlPSdkYXRlJztcbiAgICBcdFx0XHRcdFx0ZmllbGRPcHMuc2VhcmNob3B0aW9ucz1kYXRlT3B0aW9ucztcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHRcdGNvbHVtbnMucHVzaChmaWVsZE9wcyk7XG4gICAgXHRcdFx0fVxuICAgIFx0XHR9KTtcbiAgICBcdFx0Y29uc29sZS5sb2coY29sdW1ucyk7XG4gICAgXHRcdHZpZXdFbnRyaWVzVXJsICs9ZmllbGRzLmpvaW4oKTtcbiAgICBcdFx0dmlld0VudHJpZXNVcmwgKz0nJnNpemU9Jytyb3dTaXplO1xuICAgIFx0XHRjb25zb2xlLmxvZyh2aWV3RW50cmllc1VybCk7XG4gICAgXHR9XG4gICAgXHR2YXIgZml4R3JpZFdpZHRoID0gZnVuY3Rpb24gKGdyaWQpIHtcbiAgICBcdCAgICB2YXIgZ3ZpZXdTY3JvbGxXaWR0aCA9IGdyaWRbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuc2Nyb2xsV2lkdGg7XG4gICAgXHQgICAgdmFyIG1haW5XaWR0aCA9IGpRdWVyeSgnI21haW4nKS53aWR0aCgpO1xuICAgIFx0ICAgIHZhciBncmlkU2Nyb2xsV2lkdGggPSBncmlkWzBdLnNjcm9sbFdpZHRoO1xuICAgIFx0ICAgIHZhciBodGFibGUgPSBqUXVlcnkoJ3RhYmxlLnVpLWpxZ3JpZC1odGFibGUnLCBncmlkWzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKTtcbiAgICBcdCAgICB2YXIgc2Nyb2xsV2lkdGggPSBncmlkU2Nyb2xsV2lkdGg7XG4gICAgXHQgICAgaWYgKGh0YWJsZS5sZW5ndGggPiAwKSB7XG4gICAgXHQgICAgICAgIHZhciBoZGl2U2Nyb2xsV2lkdGggPSBodGFibGVbMF0uc2Nyb2xsV2lkdGg7XG4gICAgXHQgICAgICAgIGlmICgoZ3JpZFNjcm9sbFdpZHRoIDwgaGRpdlNjcm9sbFdpZHRoKSlcbiAgICBcdCAgICAgICAgICAgIHNjcm9sbFdpZHRoID0gaGRpdlNjcm9sbFdpZHRoOyAvLyBtYXggKGdyaWRTY3JvbGxXaWR0aCwgaGRpdlNjcm9sbFdpZHRoKVxuICAgIFx0ICAgIH1cbiAgICBcdCAgICBpZiAoZ3ZpZXdTY3JvbGxXaWR0aCAhPSBzY3JvbGxXaWR0aCB8fCBzY3JvbGxXaWR0aCA+IG1haW5XaWR0aCkge1xuICAgIFx0ICAgICAgICB2YXIgbmV3R3JpZFdpZHRoID0gKHNjcm9sbFdpZHRoIDw9IG1haW5XaWR0aCk/IHNjcm9sbFdpZHRoOiBtYWluV2lkdGg7ICAvLyBtaW4gKHNjcm9sbFdpZHRoLCBtYWluV2lkdGgpXG4gICAgXHQgICAgICAgIC8vIGlmIHRoZSBncmlkIGhhcyBubyBkYXRhLCBncmlkU2Nyb2xsV2lkdGggY2FuIGJlIGxlc3MgdGhlbiBoZGl2WzBdLnNjcm9sbFdpZHRoXG4gICAgXHQgICAgICAgIGlmIChuZXdHcmlkV2lkdGggIT0gZ3ZpZXdTY3JvbGxXaWR0aCl7XG4gICAgXHQgICAgICAgICAgICBncmlkLmpxR3JpZChcInNldEdyaWRXaWR0aFwiLCBuZXdHcmlkV2lkdGgpO1xuICAgIFx0ICAgICAgICAgICAgY29uc29sZS5sb2coXCJXaWR0aCBmaXhlZC5cIilcbiAgICBcdCAgICAgICAgfVxuICAgIFx0ICAgIH1cbiAgICBcdH07XG5cbiAgICBcdHZhciBmaXhHcmlkSGVpZ2h0ID0gZnVuY3Rpb24gKGdyaWQpIHtcbiAgICBcdCAgICB2YXIgZ3ZpZXdOb2RlID0gZ3JpZFswXS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICBcdCAgICAvL3ZhciBndmlldyA9IGdyaWQucGFyZW50KCkucGFyZW50KCkucGFyZW50KCk7XG4gICAgXHQgICAgLy92YXIgYmRpdiA9IGpRdWVyeShcIiNndmlld19cIiArIGdyaWRbMF0uaWQgKyBcIiAudWktanFncmlkLWJkaXZcIik7XG4gICAgXHQgICAgdmFyIGJkaXYgPSBqUXVlcnkoXCIudWktanFncmlkLWJkaXZcIiwgZ3ZpZXdOb2RlKTtcbiAgICBcdCAgICBpZiAoYmRpdi5sZW5ndGgpIHtcbiAgICBcdCAgICAgICAgdmFyIGRlbHRhID0gYmRpdlswXS5zY3JvbGxIZWlnaHQgLSBiZGl2WzBdLmNsaWVudEhlaWdodDtcbiAgICBcdCAgICAgICAgdmFyIGhlaWdodCA9IGdyaWQuaGVpZ2h0KCk7XG4gICAgXHQgICAgICAgIGlmIChkZWx0YSAhPT0gMCAmJiBoZWlnaHQgJiYgKGhlaWdodC1kZWx0YT4wKSkge1xuICAgIFx0ICAgICAgICAgICAgZ3JpZC5zZXRHcmlkSGVpZ2h0KGhlaWdodC1kZWx0YSk7XG4gICAgXHQgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkhlaWdodCBmaXhlZC5cIilcbiAgICBcdCAgICAgICAgXG4gICAgXHQgICAgICAgIH1cbiAgICBcdCAgICB9XG4gICAgXHR9O1xuXG4gICAgXHR2YXIgZml4R3JpZFNpemUgPSBmdW5jdGlvbiAoZ3JpZCkge1xuICAgIFx0ICAgIGZpeEdyaWRXaWR0aChncmlkKTtcbiAgICBcdCAgICBmaXhHcmlkSGVpZ2h0KGdyaWQpO1xuICAgIFx0fTtcbiAgICBcdFxuICAgIFx0JCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgXHRcdGZpeEdyaWRTaXplKCQoJyNqcUdyaWQnKSk7XG4gICAgXHR9KTtcblxuICAgIFx0XG4gICAgXHQkKFwiI2pxR3JpZFwiKS5qcUdyaWQoe1xuICAgIFx0XHR1cmw6IHZpZXdFbnRyaWVzVXJsLFxuICAgIFx0XHRtdHlwZTogXCJHRVRcIixcbiAgICBcdFx0ZGF0YXR5cGU6IFwianNvblwiLFxuICAgIFx0XHRwYWdlOiAxLFxuICAgIFx0XHRjb2xNb2RlbDogY29sdW1ucyxcbiAgICBcdFx0YXV0b3dpZHRoOiB0cnVlLFxuICAgIFx0XHRzaHJpbmtUb0ZpdDogdHJ1ZSxcbiAgICBcdFx0Ly9oZWlnaHQ6JzEwMCUnLFxuICAgIFx0XHRtYXhIZWlnaHQ6IDUwMCxcbiAgICBcdFx0cm93TnVtOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplLFxuICAgIFx0XHQvL2d1aVN0eWxlOiBcImJvb3RzdHJhcFwiLFxuICAgIFx0XHRzZXJpYWxpemVHcmlkRGF0YTogZnVuY3Rpb24ocG9zdERhdGEpIHtcbiAgICBcdFx0XHRpZiAodHlwZW9mKHBvc3REYXRhLnBhZ2UpID09PSBcIm51bWJlclwiKSB7XG4gICAgXHRcdFx0XHRwb3N0RGF0YS5wYWdlLS07IC8vIGRlY3JlYXNlIHRoZSB2YWx1ZSBvZiBwYWdlIGJlZm9yZSBzZW5kaW5nIHRvIHRoZSBzZXJ2ZXJcbiAgICBcdFx0XHR9XG4gICAgXHRcdFx0aWYgKHBvc3REYXRhLnNpZHghPW51bGwgJiYgcG9zdERhdGEuc2lkeCE9Jycpe1xuICAgIFx0XHRcdFx0cG9zdERhdGEuc29ydD1wb3N0RGF0YS5zaWR4K1wiLFwiK3Bvc3REYXRhLnNvcmQ7XG4gICAgXHRcdFx0fWVsc2V7XG4gICAgXHRcdFx0XHRwb3N0RGF0YS5zb3J0PVwiSUQsREVTQ1wiXG4gICAgXHRcdFx0fVxuICAgIFx0XHRcdHJldHVybiBwb3N0RGF0YTtcbiAgICBcdFx0fSxcbiAgICBcdFx0anNvblJlYWRlcjoge1xuICAgIFx0XHRcdHJlcGVhdGl0ZW1zOiBmYWxzZSxcbiAgICBcdFx0XHRyb290OiBmdW5jdGlvbihkYXRhKXtcbiAgICBcdFx0XHRcdGlmIChkYXRhLmNvbnRlbnQpe1xuICAgIFx0XHRcdFx0XHRyZXR1cm4gZGF0YS5jb250ZW50O1xuICAgIFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0cmV0dXJuIGRhdGEub2JqZWN0cztcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdHRvdGFsOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgXHRcdFx0XHRyZXR1cm4gZGF0YS50b3RhbFBhZ2VzO1xuICAgIFx0XHRcdH0sXG4gICAgXHRcdFx0cGFnZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgXHRcdFx0XHRyZXR1cm4gZGF0YS5udW1iZXIrMTtcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdHJlY29yZHM6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIFx0XHRcdFx0aWYoZGF0YS50b3RhbEVsZW1lbnRzKXtcbiAgICBcdFx0XHRcdFx0cmV0dXJuIGRhdGEudG90YWxFbGVtZW50cztcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHRcdHJldHVybiBkYXRhLm51bUl0ZW1zO1xuICAgIFx0XHRcdH0gXG4gICAgXHRcdH0sXG4gICAgXHRcdG9uU2VsZWN0Um93OiBmdW5jdGlvbihpZHMpIHsgXG4gICAgICAgICAgICAgICAgaWYoaWRzID09IG51bGwpIHtcbiAgICBcdFx0XHRcdGxvYWRHcmlkQ01JUyhcIjBcIik7XG4gICAgXHRcdFx0fWVsc2V7XG4gICAgXHRcdFx0XHR2YXIgcm93RGF0YSA9ICQoXCIjanFHcmlkXCIpLmdldFJvd0RhdGEoaWRzKTtcbiAgICBcdFx0XHRcdGNvbnNvbGUubG9nKFwiVHlwZTogXCIrcm93RGF0YVsndHlwZSddKVxuICAgIFx0XHRcdFx0aWYgKHJvd0RhdGFbJ3R5cGUnXT09XCJjbWlzOmZvbGRlclwiKXtcbiAgICBcdFx0XHRcdFx0JHNjb3BlLmxvYWRHcmlkKGlkcyk7XG4gICAgXHRcdFx0XHR9ZWxzZXtcbiAgICBcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJyZXF1ZXN0IGRvYyBcIitpZHMpO1xuICAgIFx0XHRcdFx0XHR2YXIgZG9jaWQgPSBwYXJzZUludChpZHMpO1xuICAgIFx0XHRcdFx0XHQkc2NvcGUub3BlbkRvY3VtZW50KFRvZG9zLCBkb2NpZCk7XG4gICAgXHRcdFx0XHR9XG4gICAgXHRcdFx0fVxuICAgIFx0XHR9LFxuICAgIFx0XHRzY3JvbGw6IDEsIC8vIHNldCB0aGUgc2Nyb2xsIHByb3BlcnR5IHRvIDEgdG8gZW5hYmxlIHBhZ2luZyB3aXRoIHNjcm9sbGJhciAtIHZpcnR1YWwgbG9hZGluZyBvZiByZWNvcmRzXG4gICAgXHRcdGVtcHR5cmVjb3JkczogJ1Njcm9sbCB0byBib3R0b20gdG8gcmV0cmlldmUgbmV3IHBhZ2UnLCAvLyB0aGUgbWVzc2FnZSB3aWxsIGJlIGRpc3BsYXllZCBhdCB0aGUgYm90dG9tIFxuICAgIFx0XHRwYWdlcjogXCIjanFHcmlkUGFnZXJcIixcbiAgICBcdFx0bG9hZENvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICBcdFx0XHRmaXhHcmlkU2l6ZSgkKCcjanFHcmlkJykpO1xuICAgIFx0XHRcdCQoXCJ0ci5qcWdyb3dcIiwgdGhpcykuY29udGV4dE1lbnUoJ2ZvbGRlck1lbnUnLCB7XG4gICAgXHRcdFx0XHRiaW5kaW5nczoge1xuICAgIFx0XHRcdFx0XHQnZWRpdCc6IGZ1bmN0aW9uKHRyaWdnZXIpIHtcbiAgICBcdFx0XHRcdFx0XHQvLyB0cmlnZ2VyIGlzIHRoZSBET00gZWxlbWVudCAoXCJ0ci5qcWdyb3dcIikgd2hpY2ggYXJlIHRyaWdnZXJlZFxuICAgIFx0XHRcdFx0XHRcdCQoJyNqcUdyaWQnKS5lZGl0R3JpZFJvdyh0cmlnZ2VyLmlkLCBlZGl0U2V0dGluZ3MpO1xuICAgIFx0XHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0XHQnYWRkJzogZnVuY3Rpb24oLyp0cmlnZ2VyKi8pIHtcbiAgICBcdFx0XHRcdFx0XHQkKCcjanFHcmlkJykuZWRpdEdyaWRSb3coXCJuZXdcIiwgYWRkU2V0dGluZ3MpO1xuICAgIFx0XHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0XHQnZGVsJzogZnVuY3Rpb24odHJpZ2dlcikge1xuICAgIFx0XHRcdFx0XHRcdGlmICgkKCcjZGVsJykuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRpc2FibGVkJykgPT09IGZhbHNlKSB7XG4gICAgXHRcdFx0XHRcdFx0XHQvLyBkaXNhYmxlZCBpdGVtIGNhbiBkbyBiZSBjaG9vc2VkXG4gICAgXHRcdFx0XHRcdFx0XHQkKCcjanFHcmlkJykuZGVsR3JpZFJvdyh0cmlnZ2VyLmlkLCBkZWxTZXR0aW5ncyk7XG4gICAgXHRcdFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0XHR9XG4gICAgXHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0b25Db250ZXh0TWVudTogZnVuY3Rpb24oZXZlbnQvKiwgbWVudSovKSB7XG4gICAgXHRcdFx0XHRcdHZhciByb3dJZCA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwidHIuanFncm93XCIpLmF0dHIoXCJpZFwiKTtcbiAgICBcdFx0XHRcdFx0Ly9ncmlkLnNldFNlbGVjdGlvbihyb3dJZCk7XG4gICAgXHRcdFx0XHRcdC8vIGRpc2FibGUgbWVudSBmb3Igcm93cyB3aXRoIGV2ZW4gcm93aWRzXG4gICAgXHRcdFx0XHRcdCQoJyNkZWwnKS5hdHRyKFwiZGlzYWJsZWRcIixOdW1iZXIocm93SWQpJTIgPT09IDApO1xuICAgIFx0XHRcdFx0XHRpZiAoTnVtYmVyKHJvd0lkKSUyID09PSAwKSB7XG4gICAgXHRcdFx0XHRcdFx0JCgnI2RlbCcpLmF0dHIoXCJkaXNhYmxlZFwiLFwiZGlzYWJsZWRcIikuYWRkQ2xhc3MoJ3VpLXN0YXRlLWRpc2FibGVkJyk7XG4gICAgXHRcdFx0XHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0XHRcdFx0JCgnI2RlbCcpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKS5yZW1vdmVDbGFzcygndWktc3RhdGUtZGlzYWJsZWQnKTtcbiAgICBcdFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9KTtcbiAgICBcdFx0fVxuICAgIFx0fSk7XG4gICAgXHQkKCcjanFHcmlkJykubmF2R3JpZChcIiNqcUdyaWRQYWdlclwiLCB7ICAgICAgICAgICAgICAgIFxuICAgIFx0XHRzZWFyY2g6IHRydWUsIC8vIHNob3cgc2VhcmNoIGJ1dHRvbiBvbiB0aGUgdG9vbGJhclxuICAgIFx0XHRhZGQ6IGZhbHNlLFxuICAgIFx0XHRlZGl0OiBmYWxzZSxcbiAgICBcdFx0ZGVsOiBmYWxzZSxcbiAgICBcdFx0cmVmcmVzaDogdHJ1ZVxuICAgIFx0XHR9LFxuICAgIFx0XHR7fSwgLy8gZWRpdCBvcHRpb25zXG4gICAgXHRcdHt9LCAvLyBhZGQgb3B0aW9uc1xuICAgIFx0XHR7fSwgLy8gZGVsZXRlIG9wdGlvbnNcbiAgICBcdFx0eyBtdWx0aXBsZVNlYXJjaDogdHJ1ZSwgdW5pcXVlU2VhcmNoRmllbGRzIDogdHJ1ZSwgbXVsdGlwbGVHcm91cCA6IHRydWV9XG4gICAgXHQpO1xuXHRcdCAgfVxuXHRcdCAgXG5cblx0XHQgICRzY29wZS5sb2FkR3JpZCgnMCcpO1xuICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdBZGRUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBUb2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBhZGQgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB7fTtcblxuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IGFkZGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZG8uZGF0YT1KU09OLnBhcnNlKCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBUb2Rvcy5zYXZlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdEZWxldGVUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRtb2RhbEluc3RhbmNlJywgJyRzdGF0ZScsICdUb2RvcycsICdkZWxldGVkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgVG9kb3MsIGRlbGV0ZWRUb2RvKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IGRlbGV0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8uaW5kZXgnLCB7fSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFRvZG9zLmRlbGV0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKSAgICAgICAgXG4gICAgLmNvbnRyb2xsZXIoJ0VkaXRGb3JtQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICd1cGRhdGVkVG9kbycsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCB1cGRhdGVkVG9kbywgVG9kb3MpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgICB2YXIgdHlwZVVybD1cIi9hcGkvc3lzdGVtL3MvXCIrJHNjb3BlLnRvZG8udHlwZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJC5hamF4XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiB0eXBlVXJsLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICBcdCRzY29wZS5zY2hlbWEgPSByZXMuZGF0YS5zY2hlbWE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLmZvcm0gPSBbXG5cdCAgICBcdCAgICBcIipcIlxuXHQgICAgXHQgIF07XG5cdFxuICAgICAgICAgICAgJHNjb3BlLm1vZGVsID0gJHNjb3BlLnRvZG8uZGF0YTtcbiAgICAgICAgICAgICRzY29wZS5zYXZlVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudG9kb0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbih1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IHVwZGF0ZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPSRzY29wZS5tb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgVG9kb3MudXBkYXRlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdWaWV3VG9kb0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnJG1vZGFsJywgJ3ZpZXdlZFRvZG8nLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJG1vZGFsLCB2aWV3ZWRUb2RvKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIHZpZXcgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB2aWV3ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0VkaXRQYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwidG9kby5lZGl0XCIsIHt0b2RvSWQ6ICRzY29wZS50b2RvLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5zaG93RWRpdEZvcm1QYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwidG9kby5lZGl0Zm9ybVwiLCB7dG9kb0lkOiAkc2NvcGUudG9kby5pZH0sIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWUgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0RlbGV0ZURpYWxvZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2RlbGV0ZS10b2RvLW1vZGFsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGVsZXRlVG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkVG9kbzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudG9kbztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLnRvZG8uc2VydmljZXMnLCBbJ25nUmVzb3VyY2UnXSlcbiAgICAuZmFjdG9yeSgnVG9kb3MnLCBbJyRyZXNvdXJjZScsICdOb3RpZmljYXRpb25TZXJ2aWNlJywgZnVuY3Rpb24oJHJlc291cmNlLCBOb3RpZmljYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIHZhciBhcGkgPSAkcmVzb3VyY2UoJy9hcGkvZG9jcy86aWQnLCB7XCJpZFwiOiBcIkBpZFwifSwge1xuICAgICAgICAgICAgcXVlcnk6ICB7bWV0aG9kOiAnR0VUJywgcGFyYW1zOiB7fSwgaXNBcnJheTogZmFsc2V9LFxuICAgICAgICAgICAgZ2V0OiAgICB7bWV0aG9kOiAnR0VUJ30sXG4gICAgICAgICAgICBzYXZlOiB7bWV0aG9kOiAnUE9TVCd9LFxuICAgICAgICAgICAgdXBkYXRlOiB7bWV0aG9kOiAnUFVUJ31cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRlbGV0ZTogZnVuY3Rpb24odG9kbywgc3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5kZWxldGUodG9kbywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblNlcnZpY2UuZmxhc2hNZXNzYWdlKCd0b2RvLm5vdGlmaWNhdGlvbnMuZGVsZXRlLnN1Y2Nlc3MnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBxdWVyeTogZnVuY3Rpb24ocGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpLnF1ZXJ5KHtwYWdlOiBwYWdlTnVtYmVyLCBzaXplOiBwYWdlU2l6ZSwgc29ydDogJ0lELERFU0MnfSkuJHByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbih0b2RvSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpLmdldCh7aWQ6IHRvZG9JZH0pLiRwcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGFwaS5zYXZlKHRvZG8sIGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblNlcnZpY2UuZmxhc2hNZXNzYWdlKCd0b2RvLm5vdGlmaWNhdGlvbnMuYWRkLnN1Y2Nlc3MnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soYWRkZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24odG9kbywgc3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgYXBpLnVwZGF0ZSh0b2RvLCBmdW5jdGlvbih1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblNlcnZpY2UuZmxhc2hNZXNzYWdlKCd0b2RvLm5vdGlmaWNhdGlvbnMudXBkYXRlLnN1Y2Nlc3MnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2sodXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdkZW1vJywgW1xyXG4gICAgJ2JsdWVpbXAuZmlsZXVwbG9hZCdcclxuXSlcclxuICAgIC5jb25maWcoW1xyXG4gICAgICAgICckaHR0cFByb3ZpZGVyJywgJ2ZpbGVVcGxvYWRQcm92aWRlcicsXHJcbiAgICAgICAgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIsIGZpbGVVcGxvYWRQcm92aWRlcikge1xyXG4gICAgICAgICAgICBkZWxldGUgJGh0dHBQcm92aWRlci5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1SZXF1ZXN0ZWQtV2l0aCddO1xyXG4gICAgICAgICAgICBmaWxlVXBsb2FkUHJvdmlkZXIuZGVmYXVsdHMucmVkaXJlY3QgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKFxyXG4gICAgICAgICAgICAgICAgL1xcL1teXFwvXSokLyxcclxuICAgICAgICAgICAgICAgICcvY29ycy9yZXN1bHQuaHRtbD8lcydcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICBdKVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdEZW1vRmlsZVVwbG9hZENvbnRyb2xsZXInLCBbXHJcbiAgICAgICAgJyRzY29wZScsICckaHR0cCcsICckZmlsdGVyJywgJyR3aW5kb3cnLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5vcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICBdKVxyXG5cclxuICAgIC5jb250cm9sbGVyKCdGaWxlRGVzdHJveUNvbnRyb2xsZXInLCBbXHJcbiAgICAgICAgJyRzY29wZScsICckaHR0cCcsXHJcbiAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHApIHtcclxuICAgICAgICAgICAgdmFyIGZpbGUgPSAkc2NvcGUuZmlsZSxcclxuICAgICAgICAgICAgICAgIHN0YXRlO1xyXG4gICAgICAgICAgICBpZiAoZmlsZS51cmwpIHtcclxuICAgICAgICAgICAgICAgIGZpbGUuJHN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBmaWxlLiRkZXN0cm95ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlID0gJ3BlbmRpbmcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZmlsZS5kZWxldGVVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogZmlsZS5kZWxldGVUeXBlXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAncmVzb2x2ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNsZWFyKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9ICdyZWplY3RlZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghZmlsZS4kY2FuY2VsICYmICFmaWxlLl9pbmRleCkge1xyXG4gICAgICAgICAgICAgICAgZmlsZS4kY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jbGVhcihmaWxlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICBdKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9