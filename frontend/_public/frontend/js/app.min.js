"use strict";var App=angular.module("app",["ngLocale","ngCookies","ngResource","ngSanitize","pascalprecht.translate","ui.bootstrap","ui.router","ui.utils","ui.layout","angular-growl","angularMoment","angularUtils.directives.dirPagination","schemaForm","angular-jqgrid","app.partials","app.common.config","app.common.directives","app.common.services","app.search.services","app.todo.controllers","app.todo.services","app.system.controllers","app.system.services","app.cmis.services"]);angular.module("angular-jqgrid",[]).directive("jqGrid",function(){return{restrict:"EA",template:"<table></table>",scope:{dataset:"=",options:"=",callback:"=",pager:"="},link:function(scope,element,attributes){var jqGrid=null,height=attributes.height||"100%",init=function(){var gridObj;if(void 0===scope.dataset)return gridObj;var options={};return options.data=scope.dataset,options=$.extend(!0,options,scope.options),options.height=height,gridObj=$(element.children()[0]).jqGrid(options),scope.callback&&scope.callback(gridObj),gridObj};$(window).on("resize",function(){var parentElement=angular.element(element).parent();jqGrid.setGridWidth(parentElement.width())});var onOptionsChanged=function(){jqGrid=init()},unwatchOptions=scope.$watch("options",onOptionsChanged,!0),onDatasetChanged=function(dataset){var startDataChanged=(new Date).getTime();if(jqGrid){if(jqGrid.jqGrid("clearGridData"),jqGrid.get(0).p.treeGrid){var perfTime=(new Date).getTime();jqGrid.get(0).addJSONData({rows:dataset}),console.log("addJSONData : ",(new Date).getTime()-perfTime,"ms")}else jqGrid.jqGrid("setGridParam",{datatype:"local",data:dataset,rowNum:dataset.length});return console.log("onDatasetChanged : ",(new Date).getTime()-startDataChanged,"ms"),jqGrid.trigger("reload")}jqGrid=init()},unwatchDataset=scope.$watch("dataset",onDatasetChanged,!1);element.on("$destroy",function(){unwatchDataset(),unwatchOptions()})}}}),angular.module("app.common.config",[]).config(["$urlRouterProvider","$locationProvider",function($urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!1)}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"/iaadmin/frontend/i18n/",suffix:".json"}),$translateProvider.preferredLanguage("en"),$translateProvider.useLocalStorage(),$translateProvider.useMissingTranslationHandlerLog()}]).config(["growlProvider",function(growlProvider){growlProvider.globalTimeToLive(5e3)}]),angular.module("app.common.directives",[]).directive("staticInclude",["$http","$templateCache","$compile",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=$("<div/>").html(response).contents();element.html(contents),$compile(contents)(scope)})}}]),angular.module("app.common.services",[]).service("NotificationService",["$rootScope","growl",function($rootScope,growl){function displayNotification(message,type){"success"===type?growl.addSuccessMessage(message):"warn"===type?growl.addWarnMessage(message):"info"===type?growl.addInfoMessage(message):growl.addErrorMessage(message)}var flashMessageQueue=[];return $rootScope.$on("$stateChangeSuccess",function(){for(;flashMessageQueue.length>0;){var item=flashMessageQueue.shift();item&&displayNotification(item.message,item.type)}}),{flashMessage:function(message,type){flashMessageQueue.push({message:message,type:type||"info"})}}}]),angular.module("app.search.services",["ngResource"]).factory("Search",["$resource",function($resource){var api=$resource("/api/docs/search",{},{query:{method:"GET",isArray:!1}});return{findBySearchTerm:function(searchTerm,pageNumber,pageSize){return api.query({page:pageNumber,searchTerm:searchTerm,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.cmis.services",["ngResource"]).factory("CMIS",["$resource","NotificationService",function($resource){var api=$resource("/jooq/browser/test/root?cmisselector=children&objectId=:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1}});return{query:function(folderId,pageNumber,pageSize){return api.query({id:folderId,page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise}}}]),angular.module("app.system.controllers",[]).constant("paginationConfig",{pageSize:200}).config(["$stateProvider",function($stateProvider){$stateProvider.state("system",{url:"/","abstract":!0,template:"<ui-view/>"}).state("system.index",{url:"",controller:"SystemListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["System","paginationConfig",function(System,paginationConfig){return System.query(0,paginationConfig.pageSize)}]}}).state("system.add",{url:"system/add",controller:"AddSystemController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("system.edit",{url:"system/:systemId/edit",controller:"EditSystemController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}}).state("system.searchform",{url:"system/searchform/:systemId",controller:"SearchFormController",templateUrl:"frontend/partials/todo/search-form.html",resolve:{updatedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}}).state("system.editform",{url:"system/:systemId/editform",controller:"EditFormController",templateUrl:"frontend/partials/todo/edit-form.html",resolve:{updatedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}}).state("system.view",{url:"system/:systemId",controller:"ViewSystemController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["System","$stateParams",function(System,$stateParams){return $stateParams.systemId?System.get($stateParams.systemId):null}]}})}]).controller("SystemListController",["$scope","$state","searchResults","paginationConfig",function($scope,$state,searchResults,paginationConfig){console.log("Rendering documents."),$scope.todos=searchResults.content,console.log(searchResults),console.log(searchResults.totalElements),console.log(paginationConfig.pageSize),$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.addTodo=function(){$state.go("system.add")}}]).controller("AddSystemController",["$scope","$state","System",function($scope,$state,System){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("system.view",{systemId:added.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),System.save($scope.todo,onSuccess)}}}]).controller("DeleteSystemController",["$scope","$modalInstance","$state","System","deletedTodo",function($scope,$modalInstance,$state,System,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("system.index",{},{reload:!0,inherit:!0,notify:!0})};System.delete($scope.todo,onSuccess)}}]).controller("EditFormController",["$scope","$state","updatedTodo","System",function($scope,$state,updatedTodo,System){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.schema={type:"object",title:"schema",properties:{symbolicName:{type:"string",title:"Символьный идентификатор типа"},storage_policy:{type:"string",title:"Политика хранения"},properties:{type:"array",items:{type:"object",properties:{name:{title:"Идентификатор атрибута",type:"string"},title:{title:"Заголовок атрибута",type:"string"},type:{title:"Тип атрибута",type:"string"}},required:["name","title","type"]}}}},$scope.form=[{key:"symbolicName"},{key:"storage_policy"},{type:"tabs",tabs:[{title:"Атрибуты",items:[{key:"properties",type:"tabarray",add:"Добавить",remove:"Удалить",style:{remove:"btn-danger"},title:"{{ value.name || 'Tab '+$index }}",items:["properties[].name","properties[].title","properties[].type"]}]},{title:"Права доступа",items:[]}]}];var props=$scope.todo.data.schema.properties,model=$scope.todo.data;model.symbolicName=$scope.todo.symbolicName,model.properties=[];for(var prop in props){var mprop={name:prop,title:props[prop].title,type:props[prop].type};model.properties.push(mprop)}console.log(model),$scope.model=model,$scope.saveTodo=function(){if($scope.todoForm.$valid){for(var onSuccess=function(updated){$state.go("system.view",{systemId:updated.id},{reload:!0,inherit:!0,notify:!0})},resprops=$scope.model.properties,resprop={},i=0;i<resprops.length;i++)resprop[resprops[i].name]={},resprop[resprops[i].name].title=resprops[i].title,resprop[resprops[i].name].type=resprops[i].type;$scope.todo.data.schema.properties=resprop,$scope.todo.symbolicName=$scope.model.symbolicName,console.log($scope.todo),System.update($scope.todo,onSuccess)}}}]).controller("SearchFormController",["$scope","$state","updatedTodo","System",function($scope,$state,updatedTodo){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.schema=$scope.todo.data.schema,$scope.form=$scope.todo.data.form;var model={};$scope.model=model,$scope.saveTodo=function(){if($scope.todoForm.$valid){console.log($scope.todo)}}}]).controller("EditSystemController",["$scope","$state","updatedTodo","System",function($scope,$state,updatedTodo,System){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.todo.data=JSON.stringify($scope.todo.data),$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("system.view",{systemId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),System.update($scope.todo,onSuccess)}}}]).controller("ViewSystemController",["$scope","$state","viewedTodo",function($scope,$state,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("system.edit",{systemId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})}}]),angular.module("app.system.services",["ngResource"]).factory("System",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/system/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(pageNumber,pageSize){return api.query({page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]),angular.module("app.todo.controllers",["ui.bootstrap"]).constant("paginationConfig",{pageSize:200}).config(["$stateProvider",function($stateProvider){$stateProvider.state("todo",{url:"/","abstract":!0,template:"<ui-view/>"}).state("todo.index",{url:"",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["Todos","paginationConfig",function(Todos,paginationConfig){return Todos.query(0,paginationConfig.pageSize)}]}}).state("todo.tree",{url:"todo/tree",controller:"TodoTreeController",templateUrl:"frontend/partials/todo/todo-tree.html",resolve:{searchResults:["CMIS","paginationConfig","$stateParams",function(CMIS,paginationConfig){return CMIS.query("0",0,paginationConfig.pageSize)}]}}).state("todo.page",{url:"todo/page/:pageNumber/size/:pageSize",controller:"TodoListController",templateUrl:"frontend/partials/todo/todo-list.html",resolve:{searchResults:["Todos","$stateParams",function(Todos,$stateParams){return Todos.query($stateParams.pageNumber-1,$stateParams.pageSize)}]}}).state("todo.add",{url:"todo/add",controller:"AddTodoController",templateUrl:"frontend/partials/todo/add-todo.html"}).state("todo.edit",{url:"todo/:todoId/edit",controller:"EditTodoController",templateUrl:"frontend/partials/todo/edit-todo.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.editform",{url:"todo/:todoId/editform",controller:"EditFormController",templateUrl:"frontend/partials/todo/edit-form.html",resolve:{updatedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}}).state("todo.search",{url:"todo/search/:searchTerm/page/:pageNumber/size/:pageSize",controller:"SearchResultController",templateUrl:"frontend/partials/search/search-results.html",resolve:{searchTerm:["$stateParams",function($stateParams){return $stateParams.searchTerm}],searchResults:["Search","$stateParams",function(Search,$stateParams){return $stateParams.searchTerm?Search.findBySearchTerm($stateParams.searchTerm,$stateParams.pageNumber-1,$stateParams.pageSize):null}]}}).state("todo.view",{url:"todo/:todoId",controller:"ViewTodoController",templateUrl:"frontend/partials/todo/view-todo.html",resolve:{viewedTodo:["Todos","$stateParams",function(Todos,$stateParams){return $stateParams.todoId?Todos.get($stateParams.todoId):null}]}})}]).controller("TodoListController",["$scope","$state","searchResults","paginationConfig",function($scope,$state,searchResults,paginationConfig){console.log("Rendering documents."),$scope.todos=searchResults.content,console.log(searchResults),console.log(searchResults.totalElements),console.log(paginationConfig.pageSize),$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.addTodo=function(){$state.go("todo.add")},$scope.openTree=function(){$state.go("todo.tree")},$scope.pageChanged=function(newPageNumber){$state.go("todo.page",{pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("EditTodoController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo,$scope.todo.data=JSON.stringify($scope.todo.data),$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),Todos.update($scope.todo,onSuccess)}}}]).controller("SearchController",["$scope","$state","paginationConfig",function($scope,$state,paginationConfig){var userWritingSearchTerm=!1,minimumSearchTermLength=3;$scope.missingChars=minimumSearchTermLength,$scope.searchTerm="",$scope.searchFieldBlur=function(){userWritingSearchTerm=!1},$scope.searchFieldFocus=function(){userWritingSearchTerm=!0},$scope.showMissingCharacterText=function(){return userWritingSearchTerm&&$scope.searchTerm.length<minimumSearchTermLength?!0:!1},$scope.search=function(){$scope.searchTerm.length<minimumSearchTermLength?$scope.missingChars=minimumSearchTermLength-$scope.searchTerm.length:($scope.missingChars=0,$state.go("todo.search",{searchTerm:$scope.searchTerm,pageNumber:1,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0}))}}]).controller("SearchResultController",["$scope","$state","paginationConfig","searchTerm","searchResults",function($scope,$state,paginationConfig,searchTerm,searchResults){console.log("Rendering search results page."),$scope.todos=searchResults.content,$scope.pagination={currentPage:searchResults.number+1,itemsPerPage:paginationConfig.pageSize,totalItems:searchResults.totalElements},$scope.pageChanged=function(newPageNumber){$state.go("todo.search",{searchTerm:searchTerm,pageNumber:newPageNumber,pageSize:paginationConfig.pageSize},{reload:!0,inherit:!0,notify:!0})}}]).controller("DocumentModalController",["$scope","$modalInstance","$state","Todos","viewedDoc",function($scope,$modalInstance,$state,Todos,viewedDoc){$scope.todo=viewedDoc,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.editDocument=function(){}}]).controller("TodoTreeController",["$scope","$state","$modal","Todos","searchResults","paginationConfig",function($scope,$state,$modal,Todos,searchResults,paginationConfig){console.log("Rendering documents tree.");var cmis_root="/jooq/browser/test/root";$("#treecontainer").jstree({core:{data:{url:function(node){return"#"===node.id?cmis_root+"?objectId=0&cmisselector=children":cmis_root+"?objectId="+node.id+"&cmisselector=children"},dataFilter:function(data){var nodes=[];return $.each(JSON.parse(data).objects,function(i,item){var node={};node.id=item.object.properties["cmis:objectId"].value,node.data={type:item.object.properties["cmis:objectTypeId"].value},node.text=item.object.properties["cmis:name"].value,"cmis:folder"==item.object.properties["cmis:objectTypeId"].value&&(node.children=!0),nodes.push(node)}),JSON.stringify(nodes)},data:function(node){return console.log(node),{id:node.id,text:"1"}}}}}),$("#treecontainer").on("select_node.jstree",function(e,data){if(console.log("node_id: "+data.node.type+" - "+data.node.id),"cmis:folder"==data.node.data.type)$scope.loadGrid(data.node.id);else{var docid=parseInt(data.node.id);$scope.openDocument(Todos,docid)}}),$scope.openDocument=function(Todos,docid){var viewsUrl="/api/docs/"+docid;$.getJSON(viewsUrl,function(viewdata){"view"==viewdata.type?$scope.loadGrid("0",viewdata):($scope.todo=viewdata,$modal.open({templateUrl:"frontend/partials/todo/document-view-modal.html",controller:"DocumentModalController",resolve:{viewedDoc:function(){return $scope.todo}}}))})},$scope.loadGrid=function(folderId,viewdata){console.log("Rendering documents grid."),$("#jqGrid").jqGrid("GridUnload");var dateOptions={dataInit:function(element){$(element).datepicker({id:"orderDate_datePicker",dateFormat:"yy-mm-dd",maxDate:new Date(2020,0,1),showOn:"focus"})},sopt:["gt","lt","eq"]},editSettings={recreateForm:!0,jqModal:!1,reloadAfterSubmit:!1,closeOnEscape:!0,savekey:[!0,13],closeAfterEdit:!0,afterShowForm:function(){$("#lui_"+grid[0].id).hide()}},addSettings={recreateForm:!0,jqModal:!1,reloadAfterSubmit:!1,savekey:[!0,13],closeOnEscape:!0,closeAfterAdd:!0,afterShowForm:function(){$("#lui_"+grid[0].id).hide()}},delSettings={processing:!0},id=folderId,viewEntriesUrl=cmis_root+"?objectId="+id+"&cmisselector=children",sys_fields=["id","type","title","description","modifier","modificationTime","autor","creationTime"],fields=["id","title","description","modifier","modificationTime"],rowSize=paginationConfig.pageSize,columns=[{name:"id",key:!0,width:75,jsonmap:"object.properties.cmis:objectId.value"},{name:"type",label:"Тип",width:100,jsonmap:"object.properties.cmis:objectTypeId.value"},{name:"title",label:"Заголовок",width:150,jsonmap:"object.properties.cmis:name.value"},{name:"description",label:"Описание",width:150,jsonmap:"object.properties.cmis:description.value"},{name:"author",label:"Создал",width:150,jsonmap:"object.properties.cmis:createdBy.value"},{name:"creationTime",label:"Дата создания",width:150,jsonmap:"object.properties.cmis:creationDate.value",formatter:"date",formatoptions:{srcformat:"U/1000",newformat:"d.m.Y H:i"},sorttype:"date",searchoptions:dateOptions},{name:"modifier",label:"Изменил",width:150,jsonmap:"object.properties.cmis:lastModifiedBy.value"},{name:"modificationTime",label:"Дата изменения",width:150,jsonmap:"object.properties.cmis:lastModificationDate.value",formatter:"date",formatoptions:{srcformat:"U/1000",newformat:"d.m.Y H:i"},sorttype:"date",searchoptions:dateOptions}];console.log(viewdata),null!=viewdata&&(viewEntriesUrl=viewdata.data.query+"?fields=",fields=[],columns=[],$.each(viewdata.data.columnDescriptions,function(i,item){if(0!=item.visible){var colWidth=140;item.width&&(colWidth=parseInt(item.width));var fieldOps={name:item.field,label:item.name,width:colWidth};item.sortField&&(fieldOps.index=item.sortField),-1==$.inArray(item.field,sys_fields)&&(fieldOps.jsonmap="data."+item.field,fields.push(item.field)),"INTEGER"==item.type&&(fieldOps.searchoptions={sopt:["gt","lt","eq"]}),"DATE"==item.type&&(fieldOps.sorttype="date",fieldOps.searchoptions=dateOptions),columns.push(fieldOps)}}),console.log(columns),viewEntriesUrl+=fields.join(),viewEntriesUrl+="&size="+rowSize,console.log(viewEntriesUrl));var fixGridWidth=function(grid){var gviewScrollWidth=grid[0].parentNode.parentNode.parentNode.scrollWidth,mainWidth=jQuery("#main").width(),gridScrollWidth=grid[0].scrollWidth,htable=jQuery("table.ui-jqgrid-htable",grid[0].parentNode.parentNode.parentNode),scrollWidth=gridScrollWidth;if(htable.length>0){var hdivScrollWidth=htable[0].scrollWidth;hdivScrollWidth>gridScrollWidth&&(scrollWidth=hdivScrollWidth)}if(gviewScrollWidth!=scrollWidth||scrollWidth>mainWidth){var newGridWidth=mainWidth>=scrollWidth?scrollWidth:mainWidth;newGridWidth!=gviewScrollWidth&&(grid.jqGrid("setGridWidth",newGridWidth),console.log("Width fixed."))}},fixGridHeight=function(grid){var gviewNode=grid[0].parentNode.parentNode.parentNode,bdiv=jQuery(".ui-jqgrid-bdiv",gviewNode);if(bdiv.length){var delta=bdiv[0].scrollHeight-bdiv[0].clientHeight,height=grid.height();0!==delta&&height&&height-delta>0&&(grid.setGridHeight(height-delta),console.log("Height fixed."))}},fixGridSize=function(grid){fixGridWidth(grid),fixGridHeight(grid)};$(window).resize(function(){fixGridSize($("#jqGrid"))}),$("#jqGrid").jqGrid({url:viewEntriesUrl,mtype:"GET",datatype:"json",page:1,colModel:columns,autowidth:!0,shrinkToFit:!0,height:"100%",maxHeight:500,rowNum:paginationConfig.pageSize,serializeGridData:function(postData){return"number"==typeof postData.page&&postData.page--,postData.sort=null!=postData.sidx&&""!=postData.sidx?postData.sidx+","+postData.sord:"ID,DESC",postData},jsonReader:{repeatitems:!1,root:function(data){return data.content?data.content:data.objects},total:function(data){return data.totalPages},page:function(data){return data.number+1},records:function(data){return data.totalElements?data.totalElements:data.numItems}},onSelectRow:function(ids){if(null==ids)loadGridCMIS("0");else{var rowData=$("#jqGrid").getRowData(ids);if(console.log("Type: "+rowData.type),"cmis:folder"==rowData.type)$scope.loadGrid(ids);else{console.log("request doc "+ids);var docid=parseInt(ids);$scope.openDocument(Todos,docid)}}},scroll:1,emptyrecords:"Scroll to bottom to retrieve new page",pager:"#jqGridPager",loadComplete:function(){fixGridSize($("#jqGrid")),$("tr.jqgrow",this).contextMenu("folderMenu",{bindings:{edit:function(trigger){$("#jqGrid").editGridRow(trigger.id,editSettings)},add:function(){$("#jqGrid").editGridRow("new",addSettings)},del:function(trigger){$("#del").hasClass("ui-state-disabled")===!1&&$("#jqGrid").delGridRow(trigger.id,delSettings)}},onContextMenu:function(event){var rowId=$(event.target).closest("tr.jqgrow").attr("id");return $("#del").attr("disabled",Number(rowId)%2===0),Number(rowId)%2===0?$("#del").attr("disabled","disabled").addClass("ui-state-disabled"):$("#del").removeAttr("disabled").removeClass("ui-state-disabled"),!0}})}}),$("#jqGrid").navGrid("#jqGridPager",{search:!0,add:!1,edit:!1,del:!1,refresh:!0},{},{},{},{multipleSearch:!0,uniqueSearchFields:!0,multipleGroup:!0})},$scope.loadGrid("0")}]).controller("AddTodoController",["$scope","$state","Todos",function($scope,$state,Todos){console.log("Rendering add todo entry page."),$scope.todo={},$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(added){$state.go("todo.view",{todoId:added.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=JSON.parse($scope.todo.data),Todos.save($scope.todo,onSuccess)}}}]).controller("DeleteTodoController",["$scope","$modalInstance","$state","Todos","deletedTodo",function($scope,$modalInstance,$state,Todos,deletedTodo){$scope.todo=deletedTodo,$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.delete=function(){var onSuccess=function(){$modalInstance.close(),$state.go("todo.index",{},{reload:!0,inherit:!0,notify:!0})};Todos.delete($scope.todo,onSuccess)}}]).controller("EditFormController",["$scope","$state","updatedTodo","Todos",function($scope,$state,updatedTodo,Todos){console.log(updatedTodo),$scope.todo=updatedTodo;var typeUrl="/api/system/s/"+$scope.todo.type;$.ajax({type:"GET",url:typeUrl,dataType:"json",async:!1,success:function(res){$scope.schema=res.data.schema}}),$scope.form=["*"],$scope.model=$scope.todo.data,$scope.saveTodo=function(){if($scope.todoForm.$valid){var onSuccess=function(updated){$state.go("todo.view",{todoId:updated.id},{reload:!0,inherit:!0,notify:!0})};$scope.todo.data=$scope.model,Todos.update($scope.todo,onSuccess)}}}]).controller("ViewTodoController",["$scope","$state","$modal","viewedTodo",function($scope,$state,$modal,viewedTodo){console.log("Rendering view todo entry page."),$scope.todo=viewedTodo,$scope.showEditPage=function(){$state.go("todo.edit",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showEditFormPage=function(){$state.go("todo.editform",{todoId:$scope.todo.id},{reload:!0,inherit:!0,notify:!0})},$scope.showDeleteDialog=function(){$modal.open({templateUrl:"frontend/partials/todo/delete-todo-modal.html",controller:"DeleteTodoController",resolve:{deletedTodo:function(){return $scope.todo}}})}}]),angular.module("app.todo.services",["ngResource"]).factory("Todos",["$resource","NotificationService",function($resource,NotificationService){var api=$resource("/api/docs/:id",{id:"@id"},{query:{method:"GET",params:{},isArray:!1},get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}});return{"delete":function(todo,successCallback){return api.delete(todo,function(){NotificationService.flashMessage("todo.notifications.delete.success","success"),successCallback()})},query:function(pageNumber,pageSize){return api.query({page:pageNumber,size:pageSize,sort:"ID,DESC"}).$promise},get:function(todoId){return api.get({id:todoId}).$promise},save:function(todo,successCallback){api.save(todo,function(added){NotificationService.flashMessage("todo.notifications.add.success","success"),successCallback(added)})},update:function(todo,successCallback){api.update(todo,function(updated){NotificationService.flashMessage("todo.notifications.update.success","success"),successCallback(updated)})}}}]),angular.module("demo",["blueimp.fileupload"]).config(["$httpProvider","fileUploadProvider",function($httpProvider,fileUploadProvider){delete $httpProvider.defaults.headers.common["X-Requested-With"],fileUploadProvider.defaults.redirect=window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s")}]).controller("DemoFileUploadController",["$scope","$http","$filter","$window",function($scope){$scope.options={url:url}}]).controller("FileDestroyController",["$scope","$http",function($scope,$http){var state,file=$scope.file;file.url?(file.$state=function(){return state},file.$destroy=function(){return state="pending",$http({url:file.deleteUrl,method:file.deleteType}).then(function(){state="resolved",$scope.clear(file)},function(){state="rejected"})}):file.$cancel||file._index||(file.$cancel=function(){$scope.clear(file)})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZHVsZS9jb21tb24vYW5ndWxhci1qcWdyaWQuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5jb25maWcuanMiLCJtb2R1bGUvY29tbW9uL2NvbW1vbi5kaXJlY3RpdmVzLmpzIiwibW9kdWxlL2NvbW1vbi9jb21tb24uc2VydmljZXMuanMiLCJtb2R1bGUvc2VhcmNoL3NlYXJjaC5zZXJ2aWNlcy5qcyIsIm1vZHVsZS90b2RvL2NtaXMuc2VydmljZXMuanMiLCJtb2R1bGUvdG9kby9zeXN0ZW0uY29udHJvbGxlcnMuanMiLCJtb2R1bGUvdG9kby9zeXN0ZW0uc2VydmljZXMuanMiLCJtb2R1bGUvdG9kby90b2RvLmNvbnRyb2xsZXJzLmpzIiwibW9kdWxlL3RvZG8vdG9kby5zZXJ2aWNlcy5qcyIsIm1vZHVsZS90b2RvL3RvZG8udXBsb2FkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBQSxLQUFBLFFBQUEsT0FBQSxPQUNBLFdBQ0EsWUFDQSxhQUNBLGFBQ0EseUJBQ0EsZUFDQSxZQUNBLFdBQ0EsWUFDQSxnQkFDQSxnQkFDQSx3Q0FDQSxhQUNBLGlCQUdBLGVBR0Esb0JBQUEsd0JBQUEsc0JBR0Esc0JBR0EsdUJBQUEsb0JBRUEseUJBQUEsc0JBRUEscUJDSkEsU0FBQSxPQUFBLHFCQUFBLFVBQUEsU0FBQSxXQUNBLE9BQ0EsU0FBQSxLQUNBLFNBQUEsa0JBQ0EsT0FDQSxRQUFBLElBQ0EsUUFBQSxJQUNBLFNBQUEsSUFDQSxNQUFBLEtBRUEsS0FBQSxTQUFBLE1BQUEsUUFBQSxZQUNBLEdBQUEsUUFBQSxLQUNBLE9BQUEsV0FBQSxRQUFBLE9BRUEsS0FBQSxXQUNBLEdBQUEsUUFFQSxJQUFBLFNBQUEsTUFBQSxRQUVBLE1BQUEsUUFHQSxJQUFBLFdBY0EsT0FaQSxTQUFBLEtBQUEsTUFBQSxRQUVBLFFBQUEsRUFBQSxRQUFBLEVBQUEsUUFBQSxNQUFBLFNBRUEsUUFBQSxPQUFBLE9BRUEsUUFBQSxFQUFBLFFBQUEsV0FBQSxJQUFBLE9BQUEsU0FFQSxNQUFBLFVBQ0EsTUFBQSxTQUFBLFNBR0EsUUFPQSxHQUFBLFFBQUEsR0FBQSxTQUFBLFdBQ0EsR0FBQSxlQUFBLFFBQUEsUUFBQSxTQUFBLFFBQ0EsUUFBQSxhQUFBLGNBQUEsVUFNQSxJQUFBLGtCQUFBLFdBQ0EsT0FBQSxRQUdBLGVBQUEsTUFBQSxPQUFBLFVBQUEsa0JBQUEsR0FFQSxpQkFBQSxTQUFBLFNBQ0EsR0FBQSxtQkFBQSxHQUFBLE9BQUEsU0FDQSxJQUFBLE9BQUEsQ0FJQSxHQUZBLE9BQUEsT0FBQSxpQkFFQSxPQUFBLElBQUEsR0FBQSxFQUFBLFNBQUEsQ0FDQSxHQUFBLFdBQUEsR0FBQSxPQUFBLFNBQ0EsUUFBQSxJQUFBLEdBQUEsYUFDQSxLQUFBLFVBRUEsUUFBQSxJQUFBLGtCQUFBLEdBQUEsT0FBQSxVQUFBLFNBQUEsVUFHQSxRQUFBLE9BQUEsZ0JBQ0EsU0FBQSxRQUNBLEtBQUEsUUFDQSxPQUFBLFFBQUEsUUFRQSxPQUZBLFNBQUEsSUFBQSx1QkFBQSxHQUFBLE9BQUEsVUFBQSxpQkFBQSxNQUVBLE9BQUEsUUFBQSxVQUlBLE9BQUEsUUFLQSxlQUFBLE1BQUEsT0FBQSxVQUFBLGtCQUFBLEVBS0EsU0FBQSxHQUFBLFdBQUEsV0FDQSxpQkFDQSx1QkM1SEEsUUFBQSxPQUFBLHdCQUNBLFFBQUEscUJBQUEsb0JBQ0EsU0FBQSxtQkFBQSxtQkFDQSxtQkFBQSxVQUFBLEtBR0Esa0JBQUEsV0FBQSxNQUdBLFFBQUEscUJBQUEsU0FBQSxvQkFFQSxtQkFBQSxzQkFDQSxPQUFBLDBCQUNBLE9BQUEsVUFHQSxtQkFBQSxrQkFBQSxNQUNBLG1CQUFBLGtCQUNBLG1CQUFBLHFDQUVBLFFBQUEsZ0JBQUEsU0FBQSxlQUNBLGNBQUEsaUJBQUEsUUNyQkEsUUFBQSxPQUFBLDRCQUNBLFVBQUEsaUJBQUEsUUFBQSxpQkFBQSxXQUFBLFNBQUEsTUFBQSxlQUFBLFVBQ0EsTUFBQSxVQUFBLE1BQUEsUUFBQSxPQUNBLEdBQUEsY0FBQSxNQUFBLGFBRUEsT0FBQSxJQUFBLGNBQUEsTUFBQSxpQkFBQSxRQUFBLFNBQUEsVUFDQSxHQUFBLFVBQUEsRUFBQSxVQUFBLEtBQUEsVUFBQSxVQUNBLFNBQUEsS0FBQSxVQUNBLFNBQUEsVUFBQSxhQ1JBLFFBQUEsT0FBQSwwQkFDQSxRQUFBLHVCQUFBLGFBQUEsUUFBQSxTQUFBLFdBQUEsT0FHQSxRQUFBLHFCQUFBLFFBQUEsTUFDQSxZQUFBLEtBQ0EsTUFBQSxrQkFBQSxTQUNBLFNBQUEsS0FDQSxNQUFBLGVBQUEsU0FDQSxTQUFBLEtBQ0EsTUFBQSxlQUFBLFNBRUEsTUFBQSxnQkFBQSxTQVZBLEdBQUEscUJBeUJBLE9BVkEsWUFBQSxJQUFBLHNCQUFBLFdBQ0EsS0FBQSxrQkFBQSxPQUFBLEdBQUEsQ0FDQSxHQUFBLE1BQUEsa0JBQUEsT0FDQSxPQUNBLG9CQUFBLEtBQUEsUUFBQSxLQUFBLFVBT0EsYUFBQSxTQUFBLFFBQUEsTUFDQSxrQkFBQSxNQUFBLFFBQUEsUUFBQSxLQUFBLE1BQUEsY0M3QkEsUUFBQSxPQUFBLHVCQUFBLGVBQ0EsUUFBQSxVQUFBLFlBQUEsU0FBQSxXQUNBLEdBQUEsS0FBQSxVQUFBLHVCQUNBLE9BQUEsT0FBQSxNQUFBLFNBQUEsSUFHQSxRQUNBLGlCQUFBLFNBQUEsV0FBQSxXQUFBLFVBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUFBLFdBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxZQUFBLGNDUkEsUUFBQSxPQUFBLHFCQUFBLGVBQ0EsUUFBQSxRQUFBLFlBQUEsc0JBQUEsU0FBQSxXQUNBLEdBQUEsS0FBQSxVQUFBLDhEQUFBLEdBQUEsUUFDQSxPQUFBLE9BQUEsTUFBQSxVQUFBLFNBQUEsSUFHQSxRQUNBLE1BQUEsU0FBQSxTQUFBLFdBQUEsVUFDQSxNQUFBLEtBQUEsT0FBQSxHQUFBLFNBQUEsS0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLFlBQUEsY0NSQSxRQUFBLE9BQUEsNkJBQ0EsU0FBQSxvQkFDQSxTQUFBLE1BR0EsUUFBQSxpQkFDQSxTQUFBLGdCQUNBLGVBQ0EsTUFBQSxVQUNBLElBQUEsSUFDQSxZQUFBLEVBQ0EsU0FBQSxlQUVBLE1BQUEsZ0JBQ0EsSUFBQSxHQUNBLFdBQUEsdUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGVBQUEsU0FBQSxtQkFBQSxTQUFBLE9BQUEsa0JBQ0EsTUFBQSxRQUFBLE1BQUEsRUFBQSxpQkFBQSxlQUlBLE1BQUEsY0FDQSxJQUFBLGFBQ0EsV0FBQSxzQkFDQSxZQUFBLHlDQUVBLE1BQUEsZUFDQSxJQUFBLHdCQUNBLFdBQUEsdUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGFBQUEsU0FBQSxlQUFBLFNBQUEsT0FBQSxjQUNBLE1BQUEsY0FBQSxTQUNBLE9BQUEsSUFBQSxhQUFBLFVBRUEsVUFJQSxNQUFBLHFCQUNBLElBQUEsOEJBQ0EsV0FBQSx1QkFDQSxZQUFBLDBDQUNBLFNBQ0EsYUFBQSxTQUFBLGVBQUEsU0FBQSxPQUFBLGNBQ0EsTUFBQSxjQUFBLFNBQ0EsT0FBQSxJQUFBLGFBQUEsVUFFQSxVQUlBLE1BQUEsbUJBQ0EsSUFBQSw0QkFDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxhQUFBLFNBQUEsZUFBQSxTQUFBLE9BQUEsY0FDQSxNQUFBLGNBQUEsU0FDQSxPQUFBLElBQUEsYUFBQSxVQUVBLFVBSUEsTUFBQSxlQUNBLElBQUEsbUJBQ0EsV0FBQSx1QkFDQSxZQUFBLHdDQUNBLFNBQ0EsWUFBQSxTQUFBLGVBQUEsU0FBQSxPQUFBLGNBQ0EsTUFBQSxjQUFBLFNBQ0EsT0FBQSxJQUFBLGFBQUEsVUFFQSxhQU1BLFdBQUEsd0JBQUEsU0FBQSxTQUFBLGdCQUFBLG1CQUNBLFNBQUEsT0FBQSxPQUFBLGNBQUEsa0JBQ0EsUUFBQSxJQUFBLHdCQUNBLE9BQUEsTUFBQSxjQUFBLFFBQ0EsUUFBQSxJQUFBLGVBQ0EsUUFBQSxJQUFBLGNBQUEsZUFDQSxRQUFBLElBQUEsaUJBQUEsVUFDQSxPQUFBLFlBQ0EsWUFBQSxjQUFBLE9BQUEsRUFDQSxhQUFBLGlCQUFBLFNBQ0EsV0FBQSxjQUFBLGVBR0EsT0FBQSxRQUFBLFdBQ0EsT0FBQSxHQUFBLGtCQUlBLFdBQUEsdUJBQUEsU0FBQSxTQUFBLFNBQ0EsU0FBQSxPQUFBLE9BQUEsUUFDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxRQUVBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxPQUNBLE9BQUEsR0FBQSxlQUFBLFNBQUEsTUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxPQUFBLEtBQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsMEJBQUEsU0FBQSxpQkFBQSxTQUFBLFNBQUEsY0FDQSxTQUFBLE9BQUEsZUFBQSxPQUFBLE9BQUEsYUFDQSxPQUFBLEtBQUEsWUFFQSxPQUFBLE9BQUEsV0FDQSxlQUFBLFFBQUEsV0FHQSxPQUFBLE9BQUEsV0FDQSxHQUFBLFdBQUEsV0FDQSxlQUFBLFFBQ0EsT0FBQSxHQUFBLG1CQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsT0FBQSxPQUFBLEtBQUEsZUFHQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxjQUFBLFNBQ0EsU0FBQSxPQUFBLE9BQUEsWUFBQSxRQUNBLFFBQUEsSUFBQSxhQUNBLE9BQUEsS0FBQSxZQUNBLE9BQUEsUUFDQSxLQUFBLFNBQ0EsTUFBQSxTQUNBLFlBQ0EsY0FDQSxLQUFBLFNBQ0EsTUFBQSxpQ0FFQSxnQkFDQSxLQUFBLFNBQ0EsTUFBQSxxQkFFQSxZQUNBLEtBQUEsUUFDQSxPQUNBLEtBQUEsU0FDQSxZQUNBLE1BQ0EsTUFBQSx5QkFDQSxLQUFBLFVBRUEsT0FDQSxNQUFBLHFCQUNBLEtBQUEsVUFFQSxNQUNBLE1BQUEsZUFDQSxLQUFBLFdBR0EsVUFDQSxPQUNBLFFBQ0EsWUFPQSxPQUFBLE9BQ0EsSUFBQSxpQkFDQSxJQUFBLG1CQUNBLEtBQUEsT0FDQSxPQUVBLE1BQUEsV0FDQSxRQUVBLElBQUEsYUFDQSxLQUFBLFdBQ0EsSUFBQSxXQUNBLE9BQUEsVUFDQSxPQUNBLE9BQUEsY0FFQSxNQUFBLG9DQUNBLE9BQ0Esb0JBQ0EscUJBQ0EseUJBTUEsTUFBQSxnQkFDQSxZQUtBLElBQUEsT0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLFdBQ0EsTUFBQSxPQUFBLEtBQUEsSUFDQSxPQUFBLGFBQUEsT0FBQSxLQUFBLGFBQ0EsTUFBQSxhQUNBLEtBQUEsR0FBQSxRQUFBLE9BQUEsQ0FDQSxHQUFBLFFBQUEsS0FBQSxLQUFBLE1BQUEsTUFBQSxNQUFBLE1BQUEsS0FBQSxNQUFBLE1BQUEsS0FDQSxPQUFBLFdBQUEsS0FBQSxPQUVBLFFBQUEsSUFBQSxPQUNBLE9BQUEsTUFBQSxNQUNBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FNQSxJQUFBLEdBTEEsV0FBQSxTQUFBLFNBQ0EsT0FBQSxHQUFBLGVBQUEsU0FBQSxRQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEtBRUEsU0FBQSxPQUFBLE1BQUEsV0FDQSxXQUNBLEVBQUEsRUFBQSxFQUFBLFNBQUEsT0FBQSxJQUNBLFFBQUEsU0FBQSxHQUFBLFNBQ0EsUUFBQSxTQUFBLEdBQUEsTUFBQSxNQUFBLFNBQUEsR0FBQSxNQUNBLFFBQUEsU0FBQSxHQUFBLE1BQUEsS0FBQSxTQUFBLEdBQUEsSUFFQSxRQUFBLEtBQUEsS0FBQSxPQUFBLFdBQUEsUUFDQSxPQUFBLEtBQUEsYUFBQSxPQUFBLE1BQUEsYUFDQSxRQUFBLElBQUEsT0FBQSxNQUNBLE9BQUEsT0FBQSxPQUFBLEtBQUEsZ0JBS0EsV0FBQSx3QkFBQSxTQUFBLFNBQUEsY0FBQSxTQUNBLFNBQUEsT0FBQSxPQUFBLGFBQ0EsUUFBQSxJQUFBLGFBQ0EsT0FBQSxLQUFBLFlBQ0EsT0FBQSxPQUFBLE9BQUEsS0FBQSxLQUFBLE9BRUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxLQUFBLElBQ0EsSUFBQSxTQUVBLFFBQUEsTUFBQSxNQUNBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FJQSxRQUFBLElBQUEsT0FBQSxXQUtBLFdBQUEsd0JBQUEsU0FBQSxTQUFBLGNBQUEsU0FDQSxTQUFBLE9BQUEsT0FBQSxZQUFBLFFBQ0EsUUFBQSxJQUFBLGFBQ0EsT0FBQSxLQUFBLFlBQ0EsT0FBQSxLQUFBLEtBQUEsS0FBQSxVQUFBLE9BQUEsS0FBQSxNQUNBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxTQUNBLE9BQUEsR0FBQSxlQUFBLFNBQUEsUUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxPQUFBLE9BQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsd0JBQUEsU0FBQSxTQUFBLGFBQ0EsU0FBQSxPQUFBLE9BQUEsWUFDQSxRQUFBLElBQUEsbUNBQ0EsT0FBQSxLQUFBLFdBRUEsT0FBQSxhQUFBLFdBQ0EsT0FBQSxHQUFBLGVBQUEsU0FBQSxPQUFBLEtBQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsUUN0UkEsUUFBQSxPQUFBLHVCQUFBLGVBQ0EsUUFBQSxVQUFBLFlBQUEsc0JBQUEsU0FBQSxVQUFBLHFCQUNBLEdBQUEsS0FBQSxVQUFBLG1CQUFBLEdBQUEsUUFDQSxPQUFBLE9BQUEsTUFBQSxVQUFBLFNBQUEsR0FDQSxLQUFBLE9BQUEsT0FDQSxNQUFBLE9BQUEsUUFDQSxRQUFBLE9BQUEsUUFHQSxRQUNBLFNBQUEsU0FBQSxLQUFBLGlCQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsV0FDQSxvQkFBQSxhQUFBLG9DQUFBLFdBQ0EscUJBR0EsTUFBQSxTQUFBLFdBQUEsVUFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLFdBQUEsS0FBQSxTQUFBLEtBQUEsWUFBQSxVQUVBLElBQUEsU0FBQSxRQUNBLE1BQUEsS0FBQSxLQUFBLEdBQUEsU0FBQSxVQUVBLEtBQUEsU0FBQSxLQUFBLGlCQUNBLElBQUEsS0FBQSxLQUFBLFNBQUEsT0FDQSxvQkFBQSxhQUFBLGlDQUFBLFdBQ0EsZ0JBQUEsVUFHQSxPQUFBLFNBQUEsS0FBQSxpQkFDQSxJQUFBLE9BQUEsS0FBQSxTQUFBLFNBQ0Esb0JBQUEsYUFBQSxvQ0FBQSxXQUNBLGdCQUFBLGdCQy9CQSxRQUFBLE9BQUEsd0JBQUEsaUJBQ0EsU0FBQSxvQkFDQSxTQUFBLE1BR0EsUUFBQSxpQkFDQSxTQUFBLGdCQUNBLGVBQ0EsTUFBQSxRQUNBLElBQUEsSUFDQSxZQUFBLEVBQ0EsU0FBQSxlQUVBLE1BQUEsY0FDQSxJQUFBLEdBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsZUFBQSxRQUFBLG1CQUFBLFNBQUEsTUFBQSxrQkFDQSxNQUFBLE9BQUEsTUFBQSxFQUFBLGlCQUFBLGVBSUEsTUFBQSxhQUNBLElBQUEsWUFDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxlQUFBLE9BQUEsbUJBQUEsZUFBQSxTQUFBLEtBQUEsa0JBQ0EsTUFBQSxNQUFBLE1BQUEsSUFBQSxFQUFBLGlCQUFBLGVBSUEsTUFBQSxhQUNBLElBQUEsdUNBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsZUFBQSxRQUFBLGVBQUEsU0FBQSxNQUFBLGNBQ0EsTUFBQSxPQUFBLE1BQUEsYUFBQSxXQUFBLEVBQUEsYUFBQSxlQUlBLE1BQUEsWUFDQSxJQUFBLFdBQ0EsV0FBQSxvQkFDQSxZQUFBLHlDQUVBLE1BQUEsYUFDQSxJQUFBLG9CQUNBLFdBQUEscUJBQ0EsWUFBQSx3Q0FDQSxTQUNBLGFBQUEsUUFBQSxlQUFBLFNBQUEsTUFBQSxjQUNBLE1BQUEsY0FBQSxPQUNBLE1BQUEsSUFBQSxhQUFBLFFBRUEsVUFJQSxNQUFBLGlCQUNBLElBQUEsd0JBQ0EsV0FBQSxxQkFDQSxZQUFBLHdDQUNBLFNBQ0EsYUFBQSxRQUFBLGVBQUEsU0FBQSxNQUFBLGNBQ0EsTUFBQSxjQUFBLE9BQ0EsTUFBQSxJQUFBLGFBQUEsUUFFQSxVQUlBLE1BQUEsZUFDQSxJQUFBLDBEQUNBLFdBQUEseUJBQ0EsWUFBQSwrQ0FDQSxTQUNBLFlBQUEsZUFBQSxTQUFBLGNBQ0EsTUFBQSxjQUFBLGFBRUEsZUFBQSxTQUFBLGVBQUEsU0FBQSxPQUFBLGNBQ0EsTUFBQSxjQUFBLFdBQ0EsT0FBQSxpQkFBQSxhQUFBLFdBQUEsYUFBQSxXQUFBLEVBQUEsYUFBQSxVQUdBLFVBSUEsTUFBQSxhQUNBLElBQUEsZUFDQSxXQUFBLHFCQUNBLFlBQUEsd0NBQ0EsU0FDQSxZQUFBLFFBQUEsZUFBQSxTQUFBLE1BQUEsY0FDQSxNQUFBLGNBQUEsT0FDQSxNQUFBLElBQUEsYUFBQSxRQUVBLGFBTUEsV0FBQSxzQkFBQSxTQUFBLFNBQUEsZ0JBQUEsbUJBQ0EsU0FBQSxPQUFBLE9BQUEsY0FBQSxrQkFDQSxRQUFBLElBQUEsd0JBQ0EsT0FBQSxNQUFBLGNBQUEsUUFDQSxRQUFBLElBQUEsZUFDQSxRQUFBLElBQUEsY0FBQSxlQUNBLFFBQUEsSUFBQSxpQkFBQSxVQUNBLE9BQUEsWUFDQSxZQUFBLGNBQUEsT0FBQSxFQUNBLGFBQUEsaUJBQUEsU0FDQSxXQUFBLGNBQUEsZUFHQSxPQUFBLFFBQUEsV0FDQSxPQUFBLEdBQUEsYUFHQSxPQUFBLFNBQUEsV0FDQSxPQUFBLEdBQUEsY0FHQSxPQUFBLFlBQUEsU0FBQSxlQUNBLE9BQUEsR0FBQSxhQUNBLFdBQUEsY0FBQSxTQUFBLGlCQUFBLFdBQ0EsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLFFBSUEsV0FBQSxzQkFBQSxTQUFBLFNBQUEsY0FBQSxRQUNBLFNBQUEsT0FBQSxPQUFBLFlBQUEsT0FDQSxRQUFBLElBQUEsYUFDQSxPQUFBLEtBQUEsWUFDQSxPQUFBLEtBQUEsS0FBQSxLQUFBLFVBQUEsT0FBQSxLQUFBLE1BQ0EsT0FBQSxTQUFBLFdBQ0EsR0FBQSxPQUFBLFNBQUEsT0FBQSxDQUNBLEdBQUEsV0FBQSxTQUFBLFNBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxRQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsUUFBQSxLQUFBLEtBQUEsS0FBQSxNQUFBLE9BQUEsS0FBQSxNQUNBLE1BQUEsT0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSxvQkFBQSxTQUFBLFNBQUEsbUJBQ0EsU0FBQSxPQUFBLE9BQUEsa0JBRUEsR0FBQSx3QkFBQSxFQUNBLHdCQUFBLENBRUEsUUFBQSxhQUFBLHdCQUNBLE9BQUEsV0FBQSxHQUVBLE9BQUEsZ0JBQUEsV0FDQSx1QkFBQSxHQUdBLE9BQUEsaUJBQUEsV0FDQSx1QkFBQSxHQUdBLE9BQUEseUJBQUEsV0FDQSxNQUFBLHdCQUNBLE9BQUEsV0FBQSxPQUFBLHlCQUNBLEdBSUEsR0FHQSxPQUFBLE9BQUEsV0FDQSxPQUFBLFdBQUEsT0FBQSx3QkFDQSxPQUFBLGFBQUEsd0JBQUEsT0FBQSxXQUFBLFFBR0EsT0FBQSxhQUFBLEVBQ0EsT0FBQSxHQUFBLGVBQ0EsV0FBQSxPQUFBLFdBQUEsV0FBQSxFQUFBLFNBQUEsaUJBQUEsV0FDQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsU0FNQSxXQUFBLDBCQUFBLFNBQUEsU0FBQSxtQkFBQSxhQUFBLGdCQUNBLFNBQUEsT0FBQSxPQUFBLGlCQUFBLFdBQUEsZUFDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxNQUFBLGNBQUEsUUFFQSxPQUFBLFlBQ0EsWUFBQSxjQUFBLE9BQUEsRUFDQSxhQUFBLGlCQUFBLFNBQ0EsV0FBQSxjQUFBLGVBR0EsT0FBQSxZQUFBLFNBQUEsZUFDQSxPQUFBLEdBQUEsZUFDQSxXQUFBLFdBQUEsV0FBQSxjQUFBLFNBQUEsaUJBQUEsV0FDQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsUUFLQSxXQUFBLDJCQUFBLFNBQUEsaUJBQUEsU0FBQSxRQUFBLFlBQ0EsU0FBQSxPQUFBLGVBQUEsT0FBQSxNQUFBLFdBQ0EsT0FBQSxLQUFBLFVBRUEsT0FBQSxPQUFBLFdBQ0EsZUFBQSxRQUFBLFdBR0EsT0FBQSxhQUFBLGdCQU9BLFdBQUEsc0JBQUEsU0FBQSxTQUFBLFNBQUEsUUFBQSxnQkFBQSxtQkFDQSxTQUFBLE9BQUEsT0FBQSxPQUFBLE1BQUEsY0FBQSxrQkFFQSxRQUFBLElBQUEsNEJBQ0EsSUFDQSxXQUFBLHlCQUNBLEdBQUEsa0JBQUEsUUFDQSxNQUNBLE1BQ0EsSUFBQSxTQUFBLE1BQ0EsTUFBQSxNQUFBLEtBQUEsR0FDQSxVQUFBLG9DQUNBLFVBQUEsYUFBQSxLQUFBLEdBQUEsMEJBRUEsV0FBQSxTQUFBLE1BQ0EsR0FBQSxTQVdBLE9BVkEsR0FBQSxLQUFBLEtBQUEsTUFBQSxNQUFBLFFBQUEsU0FBQSxFQUFBLE1BQ0EsR0FBQSxRQUNBLE1BQUEsR0FBQSxLQUFBLE9BQUEsV0FBQSxpQkFBQSxNQUNBLEtBQUEsTUFBQSxLQUFBLEtBQUEsT0FBQSxXQUFBLHFCQUFBLE9BQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxXQUFBLGFBQUEsTUFDQSxlQUFBLEtBQUEsT0FBQSxXQUFBLHFCQUFBLFFBQUEsS0FBQSxVQUFBLEdBQ0EsTUFBQSxLQUFBLFFBSUEsS0FBQSxVQUFBLFFBRUEsS0FBQSxTQUFBLE1BRUEsTUFEQSxTQUFBLElBQUEsT0FDQSxHQUFBLEtBQUEsR0FBQSxLQUFBLFVBTUEsRUFBQSxrQkFBQSxHQUFBLHFCQUFBLFNBQUEsRUFBQSxNQUVBLEdBREEsUUFBQSxJQUFBLFlBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxLQUFBLEtBQUEsSUFDQSxlQUFBLEtBQUEsS0FBQSxLQUFBLEtBQ0EsT0FBQSxTQUFBLEtBQUEsS0FBQSxRQUNBLENBQ0EsR0FBQSxPQUFBLFNBQUEsS0FBQSxLQUFBLEdBRUEsUUFBQSxhQUFBLE1BQUEsVUFJQSxPQUFBLGFBQUEsU0FBQSxNQUFBLE9BQ0EsR0FBQSxVQUFBLGFBQUEsS0FDQSxHQUFBLFFBQUEsU0FBQSxTQUFBLFVBQ0EsUUFBQSxTQUFBLEtBQ0EsT0FBQSxTQUFBLElBQUEsV0FFQSxPQUFBLEtBQUEsU0FDQSxPQUFBLE1BQ0EsWUFBQSxrREFDQSxXQUFBLDBCQUNBLFNBQ0EsVUFBQSxXQUNBLE1BQUEsUUFBQSxhQVFBLE9BQUEsU0FBQSxTQUFBLFNBQUEsVUFDQSxRQUFBLElBQUEsNkJBRUEsRUFBQSxXQUFBLE9BQUEsYUFDQSxJQUFBLGNBR0EsU0FBQSxTQUFBLFNBQ0EsRUFBQSxTQUFBLFlBQ0EsR0FBQSx1QkFDQSxXQUFBLFdBRUEsUUFBQSxHQUFBLE1BQUEsS0FBQSxFQUFBLEdBQ0EsT0FBQSxXQUlBLE1BQUEsS0FBQSxLQUFBLE9BRUEsY0FDQSxjQUFBLEVBQ0EsU0FBQSxFQUNBLG1CQUFBLEVBQ0EsZUFBQSxFQUNBLFVBQUEsRUFBQSxJQUNBLGdCQUFBLEVBQ0EsY0FBQSxXQUNBLEVBQUEsUUFBQSxLQUFBLEdBQUEsSUFBQSxTQUdBLGFBQ0EsY0FBQSxFQUNBLFNBQUEsRUFDQSxtQkFBQSxFQUNBLFVBQUEsRUFBQSxJQUNBLGVBQUEsRUFDQSxlQUFBLEVBQ0EsY0FBQSxXQUNBLEVBQUEsUUFBQSxLQUFBLEdBQUEsSUFBQSxTQUdBLGFBQ0EsWUFBQSxHQUdBLEdBQUEsU0FFQSxlQUFBLFVBQUEsYUFBQSxHQUFBLHlCQUNBLFlBQUEsS0FBQSxPQUFBLFFBQUEsY0FBQSxXQUFBLG1CQUFBLFFBQUEsZ0JBQ0EsUUFBQSxLQUFBLFFBQUEsY0FBQSxXQUFBLG9CQUNBLFFBQUEsaUJBQUEsU0FDQSxVQUNBLEtBQUEsS0FBQSxLQUFBLEVBQUEsTUFBQSxHQUFBLFFBQUEsMENBQ0EsS0FBQSxPQUFBLE1BQUEsTUFBQSxNQUFBLElBQUEsUUFBQSw4Q0FDQSxLQUFBLFFBQUEsTUFBQSxZQUFBLE1BQUEsSUFBQSxRQUFBLHNDQUNBLEtBQUEsY0FBQSxNQUFBLFdBQUEsTUFBQSxJQUFBLFFBQUEsNkNBQ0EsS0FBQSxTQUFBLE1BQUEsU0FBQSxNQUFBLElBQUEsUUFBQSwyQ0FDQSxLQUFBLGVBQUEsTUFBQSxnQkFBQSxNQUFBLElBQUEsUUFBQSw0Q0FDQSxVQUFBLE9BQUEsZUFBQSxVQUFBLFNBQUEsVUFBQSxhQUNBLFNBQUEsT0FDQSxjQUFBLGNBRUEsS0FBQSxXQUFBLE1BQUEsVUFBQSxNQUFBLElBQUEsUUFBQSxnREFDQSxLQUFBLG1CQUFBLE1BQUEsaUJBQUEsTUFBQSxJQUFBLFFBQUEsb0RBQ0EsVUFBQSxPQUFBLGVBQUEsVUFBQSxTQUFBLFVBQUEsYUFDQSxTQUFBLE9BQ0EsY0FBQSxhQUdBLFNBQUEsSUFBQSxVQUNBLE1BQUEsV0FDQSxlQUFBLFNBQUEsS0FBQSxNQUFBLFdBQ0EsVUFDQSxXQUNBLEVBQUEsS0FBQSxTQUFBLEtBQUEsbUJBQUEsU0FBQSxFQUFBLE1BRUEsR0FBQSxHQUFBLEtBQUEsUUFBQSxDQUNBLEdBQUEsVUFBQSxHQUNBLE1BQUEsUUFBQSxTQUFBLFNBQUEsS0FBQSxPQUNBLElBQUEsV0FBQSxLQUFBLEtBQUEsTUFBQSxNQUFBLEtBQUEsS0FBQSxNQUFBLFNBQ0EsTUFBQSxZQUFBLFNBQUEsTUFBQSxLQUFBLFdBQ0EsSUFBQSxFQUFBLFFBQUEsS0FBQSxNQUFBLGNBQ0EsU0FBQSxRQUFBLFFBQUEsS0FBQSxNQUNBLE9BQUEsS0FBQSxLQUFBLFFBRUEsV0FBQSxLQUFBLE9BQUEsU0FBQSxlQUFBLE1BQUEsS0FBQSxLQUFBLFFBQ0EsUUFBQSxLQUFBLE9BQ0EsU0FBQSxTQUFBLE9BQ0EsU0FBQSxjQUFBLGFBRUEsUUFBQSxLQUFBLGFBR0EsUUFBQSxJQUFBLFNBQ0EsZ0JBQUEsT0FBQSxPQUNBLGdCQUFBLFNBQUEsUUFDQSxRQUFBLElBQUEsZ0JBRUEsSUFBQSxjQUFBLFNBQUEsTUFDQSxHQUFBLGtCQUFBLEtBQUEsR0FBQSxXQUFBLFdBQUEsV0FBQSxZQUNBLFVBQUEsT0FBQSxTQUFBLFFBQ0EsZ0JBQUEsS0FBQSxHQUFBLFlBQ0EsT0FBQSxPQUFBLHlCQUFBLEtBQUEsR0FBQSxXQUFBLFdBQUEsWUFDQSxZQUFBLGVBQ0EsSUFBQSxPQUFBLE9BQUEsRUFBQSxDQUNBLEdBQUEsaUJBQUEsT0FBQSxHQUFBLFdBQ0EsaUJBQUEsa0JBQ0EsWUFBQSxpQkFFQSxHQUFBLGtCQUFBLGFBQUEsWUFBQSxVQUFBLENBQ0EsR0FBQSxjQUFBLFdBQUEsWUFBQSxZQUFBLFNBRUEsZUFBQSxtQkFDQSxLQUFBLE9BQUEsZUFBQSxjQUNBLFFBQUEsSUFBQSxtQkFLQSxjQUFBLFNBQUEsTUFDQSxHQUFBLFdBQUEsS0FBQSxHQUFBLFdBQUEsV0FBQSxXQUdBLEtBQUEsT0FBQSxrQkFBQSxVQUNBLElBQUEsS0FBQSxPQUFBLENBQ0EsR0FBQSxPQUFBLEtBQUEsR0FBQSxhQUFBLEtBQUEsR0FBQSxhQUNBLE9BQUEsS0FBQSxRQUNBLEtBQUEsT0FBQSxRQUFBLE9BQUEsTUFBQSxJQUNBLEtBQUEsY0FBQSxPQUFBLE9BQ0EsUUFBQSxJQUFBLG9CQU1BLFlBQUEsU0FBQSxNQUNBLGFBQUEsTUFDQSxjQUFBLE1BR0EsR0FBQSxRQUFBLE9BQUEsV0FDQSxZQUFBLEVBQUEsY0FJQSxFQUFBLFdBQUEsUUFDQSxJQUFBLGVBQ0EsTUFBQSxNQUNBLFNBQUEsT0FDQSxLQUFBLEVBQ0EsU0FBQSxRQUNBLFdBQUEsRUFDQSxhQUFBLEVBQ0EsT0FBQSxPQUNBLFVBQUEsSUFDQSxPQUFBLGlCQUFBLFNBRUEsa0JBQUEsU0FBQSxVQVNBLE1BUkEsZ0JBQUEsVUFBQSxNQUNBLFNBQUEsT0FHQSxTQUFBLEtBREEsTUFBQSxTQUFBLE1BQUEsSUFBQSxTQUFBLEtBQ0EsU0FBQSxLQUFBLElBQUEsU0FBQSxLQUVBLFVBRUEsVUFFQSxZQUNBLGFBQUEsRUFDQSxLQUFBLFNBQUEsTUFDQSxNQUFBLE1BQUEsUUFDQSxLQUFBLFFBRUEsS0FBQSxTQUVBLE1BQUEsU0FBQSxNQUNBLE1BQUEsTUFBQSxZQUVBLEtBQUEsU0FBQSxNQUNBLE1BQUEsTUFBQSxPQUFBLEdBRUEsUUFBQSxTQUFBLE1BQ0EsTUFBQSxNQUFBLGNBQ0EsS0FBQSxjQUVBLEtBQUEsV0FHQSxZQUFBLFNBQUEsS0FDQSxHQUFBLE1BQUEsSUFDQSxhQUFBLFNBQ0EsQ0FDQSxHQUFBLFNBQUEsRUFBQSxXQUFBLFdBQUEsSUFFQSxJQURBLFFBQUEsSUFBQSxTQUFBLFFBQUEsTUFDQSxlQUFBLFFBQUEsS0FDQSxPQUFBLFNBQUEsU0FDQSxDQUNBLFFBQUEsSUFBQSxlQUFBLElBQ0EsSUFBQSxPQUFBLFNBQUEsSUFDQSxRQUFBLGFBQUEsTUFBQSxVQUlBLE9BQUEsRUFDQSxhQUFBLHdDQUNBLE1BQUEsZUFDQSxhQUFBLFdBQ0EsWUFBQSxFQUFBLFlBQ0EsRUFBQSxZQUFBLE1BQUEsWUFBQSxjQUNBLFVBQ0EsS0FBQSxTQUFBLFNBRUEsRUFBQSxXQUFBLFlBQUEsUUFBQSxHQUFBLGVBRUEsSUFBQSxXQUNBLEVBQUEsV0FBQSxZQUFBLE1BQUEsY0FFQSxJQUFBLFNBQUEsU0FDQSxFQUFBLFFBQUEsU0FBQSx3QkFBQSxHQUVBLEVBQUEsV0FBQSxXQUFBLFFBQUEsR0FBQSxlQUlBLGNBQUEsU0FBQSxPQUNBLEdBQUEsT0FBQSxFQUFBLE1BQUEsUUFBQSxRQUFBLGFBQUEsS0FBQSxLQVNBLE9BTkEsR0FBQSxRQUFBLEtBQUEsV0FBQSxPQUFBLE9BQUEsSUFBQSxHQUNBLE9BQUEsT0FBQSxJQUFBLEVBQ0EsRUFBQSxRQUFBLEtBQUEsV0FBQSxZQUFBLFNBQUEscUJBRUEsRUFBQSxRQUFBLFdBQUEsWUFBQSxZQUFBLHNCQUVBLFFBS0EsRUFBQSxXQUFBLFFBQUEsZ0JBQ0EsUUFBQSxFQUNBLEtBQUEsRUFDQSxNQUFBLEVBQ0EsS0FBQSxFQUNBLFNBQUEsYUFLQSxnQkFBQSxFQUFBLG9CQUFBLEVBQUEsZUFBQSxLQUtBLE9BQUEsU0FBQSxRQUVBLFdBQUEscUJBQUEsU0FBQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsT0FDQSxRQUFBLElBQUEsa0NBQ0EsT0FBQSxRQUVBLE9BQUEsU0FBQSxXQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsQ0FDQSxHQUFBLFdBQUEsU0FBQSxPQUNBLE9BQUEsR0FBQSxhQUFBLE9BQUEsTUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLFFBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLEtBQUEsTUFDQSxNQUFBLEtBQUEsT0FBQSxLQUFBLGdCQUlBLFdBQUEsd0JBQUEsU0FBQSxpQkFBQSxTQUFBLFFBQUEsY0FDQSxTQUFBLE9BQUEsZUFBQSxPQUFBLE1BQUEsYUFDQSxPQUFBLEtBQUEsWUFFQSxPQUFBLE9BQUEsV0FDQSxlQUFBLFFBQUEsV0FHQSxPQUFBLE9BQUEsV0FDQSxHQUFBLFdBQUEsV0FDQSxlQUFBLFFBQ0EsT0FBQSxHQUFBLGlCQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsUUFBQSxJQUVBLE9BQUEsT0FBQSxPQUFBLEtBQUEsZUFHQSxXQUFBLHNCQUFBLFNBQUEsU0FBQSxjQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQUEsWUFBQSxPQUNBLFFBQUEsSUFBQSxhQUNBLE9BQUEsS0FBQSxXQUNBLElBQUEsU0FBQSxpQkFBQSxPQUFBLEtBQUEsSUFFQSxHQUFBLE1BRUEsS0FBQSxNQUNBLElBQUEsUUFDQSxTQUFBLE9BQ0EsT0FBQSxFQUNBLFFBQUEsU0FBQSxLQUNBLE9BQUEsT0FBQSxJQUFBLEtBQUEsVUFJQSxPQUFBLE1BQ0EsS0FHQSxPQUFBLE1BQUEsT0FBQSxLQUFBLEtBQ0EsT0FBQSxTQUFBLFdBQ0EsR0FBQSxPQUFBLFNBQUEsT0FBQSxDQUNBLEdBQUEsV0FBQSxTQUFBLFNBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxRQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLElBRUEsUUFBQSxLQUFBLEtBQUEsT0FBQSxNQUNBLE1BQUEsT0FBQSxPQUFBLEtBQUEsZ0JBSUEsV0FBQSxzQkFBQSxTQUFBLFNBQUEsU0FBQSxhQUNBLFNBQUEsT0FBQSxPQUFBLE9BQUEsWUFDQSxRQUFBLElBQUEsbUNBQ0EsT0FBQSxLQUFBLFdBRUEsT0FBQSxhQUFBLFdBQ0EsT0FBQSxHQUFBLGFBQUEsT0FBQSxPQUFBLEtBQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFFBQUEsS0FHQSxPQUFBLGlCQUFBLFdBQ0EsT0FBQSxHQUFBLGlCQUFBLE9BQUEsT0FBQSxLQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxRQUFBLEtBR0EsT0FBQSxpQkFBQSxXQUNBLE9BQUEsTUFDQSxZQUFBLGdEQUNBLFdBQUEsdUJBQ0EsU0FDQSxZQUFBLFdBQ0EsTUFBQSxRQUFBLGFDdG5CQSxRQUFBLE9BQUEscUJBQUEsZUFDQSxRQUFBLFNBQUEsWUFBQSxzQkFBQSxTQUFBLFVBQUEscUJBQ0EsR0FBQSxLQUFBLFVBQUEsaUJBQUEsR0FBQSxRQUNBLE9BQUEsT0FBQSxNQUFBLFVBQUEsU0FBQSxHQUNBLEtBQUEsT0FBQSxPQUNBLE1BQUEsT0FBQSxRQUNBLFFBQUEsT0FBQSxRQUdBLFFBQ0EsU0FBQSxTQUFBLEtBQUEsaUJBQ0EsTUFBQSxLQUFBLE9BQUEsS0FBQSxXQUNBLG9CQUFBLGFBQUEsb0NBQUEsV0FDQSxxQkFHQSxNQUFBLFNBQUEsV0FBQSxVQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxZQUFBLFVBRUEsSUFBQSxTQUFBLFFBQ0EsTUFBQSxLQUFBLEtBQUEsR0FBQSxTQUFBLFVBRUEsS0FBQSxTQUFBLEtBQUEsaUJBQ0EsSUFBQSxLQUFBLEtBQUEsU0FBQSxPQUNBLG9CQUFBLGFBQUEsaUNBQUEsV0FDQSxnQkFBQSxVQUdBLE9BQUEsU0FBQSxLQUFBLGlCQUNBLElBQUEsT0FBQSxLQUFBLFNBQUEsU0FDQSxvQkFBQSxhQUFBLG9DQUFBLFdBQ0EsZ0JBQUEsZ0JDL0JBLFFBQUEsT0FBQSxRQUNBLHVCQUVBLFFBQ0EsZ0JBQUEscUJBQ0EsU0FBQSxjQUFBLDBCQUNBLGVBQUEsU0FBQSxRQUFBLE9BQUEsb0JBQ0EsbUJBQUEsU0FBQSxTQUFBLE9BQUEsU0FBQSxLQUFBLFFBQ0EsWUFDQSwyQkFLQSxXQUFBLDRCQUNBLFNBQUEsUUFBQSxVQUFBLFVBQ0EsU0FBQSxRQUNBLE9BQUEsU0FDQSxJQUFBLFFBS0EsV0FBQSx5QkFDQSxTQUFBLFFBQ0EsU0FBQSxPQUFBLE9BQ0EsR0FDQSxPQURBLEtBQUEsT0FBQSxJQUVBLE1BQUEsS0FDQSxLQUFBLE9BQUEsV0FDQSxNQUFBLFFBRUEsS0FBQSxTQUFBLFdBRUEsTUFEQSxPQUFBLFVBQ0EsT0FDQSxJQUFBLEtBQUEsVUFDQSxPQUFBLEtBQUEsYUFDQSxLQUNBLFdBQ0EsTUFBQSxXQUNBLE9BQUEsTUFBQSxPQUVBLFdBQ0EsTUFBQSxlQUlBLEtBQUEsU0FBQSxLQUFBLFNBQ0EsS0FBQSxRQUFBLFdBQ0EsT0FBQSxNQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBBcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAgICduZ0xvY2FsZScsXG4gICAgJ25nQ29va2llcycsXG4gICAgJ25nUmVzb3VyY2UnLFxuICAgICduZ1Nhbml0aXplJyxcbiAgICAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScsXG4gICAgJ3VpLmJvb3RzdHJhcCcsXG4gICAgJ3VpLnJvdXRlcicsXG4gICAgJ3VpLnV0aWxzJyxcbiAgICAndWkubGF5b3V0JyxcbiAgICAnYW5ndWxhci1ncm93bCcsXG4gICAgJ2FuZ3VsYXJNb21lbnQnLFxuICAgICdhbmd1bGFyVXRpbHMuZGlyZWN0aXZlcy5kaXJQYWdpbmF0aW9uJyxcbiAgICAnc2NoZW1hRm9ybScsXG4gICAgJ2FuZ3VsYXItanFncmlkJyxcblxuICAgIC8vUGFydGlhbHNcbiAgICAnYXBwLnBhcnRpYWxzJyxcblxuICAgIC8vQ29tbW9uXG4gICAgJ2FwcC5jb21tb24uY29uZmlnJywgJ2FwcC5jb21tb24uZGlyZWN0aXZlcycsICdhcHAuY29tbW9uLnNlcnZpY2VzJyxcblxuICAgIC8vU2VhcmNoXG4gICAgJ2FwcC5zZWFyY2guc2VydmljZXMnLFxuXG4gICAgLy9Ub2RvXG4gICAgJ2FwcC50b2RvLmNvbnRyb2xsZXJzJywgJ2FwcC50b2RvLnNlcnZpY2VzJyxcbiAgICBcbiAgICAnYXBwLnN5c3RlbS5jb250cm9sbGVycycsICdhcHAuc3lzdGVtLnNlcnZpY2VzJyxcbiAgICBcbiAgICAnYXBwLmNtaXMuc2VydmljZXMnXG5cbl0pO1xuXG4iLCIvKlxyXG4qIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxyXG4qXHJcbiogQ29weXJpZ2h0IChjKSAyMDE2IERldmVsZXIgZGV2Z2luaWVcclxuKlxyXG4qIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXHJcbiogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xyXG4qIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcclxuKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxyXG4qXHJcbiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXHJcbiogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cclxuKlxyXG4qIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxyXG4qIFNPRlRXQVJFLlxyXG4qL1xyXG5cclxuLyogZ2xvYmFsICQgKi9cclxuLyogZ2xvYmFsIGFuZ3VsYXIgKi9cclxuLyogZ2xvYmFsIGpRdWVyeSAqL1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXItanFncmlkJywgW10pLmRpcmVjdGl2ZSgnanFHcmlkJywgZnVuY3Rpb24oKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgdGVtcGxhdGU6ICc8dGFibGU+PC90YWJsZT4nLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgZGF0YXNldDogJz0nLFxyXG4gICAgICBvcHRpb25zOiAnPScsXHJcbiAgICAgIGNhbGxiYWNrOiAnPScsXHJcbiAgICAgIHBhZ2VyOiAnPSdcclxuICAgIH0sXHJcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xyXG4gICAgICB2YXIganFHcmlkID0gbnVsbDtcclxuICAgICAgdmFyIGhlaWdodCA9IGF0dHJpYnV0ZXMuaGVpZ2h0IHx8ICcxMDAlJztcclxuXHJcbiAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGdyaWRPYmo7XHJcblxyXG4gICAgICAgIGlmIChzY29wZS5kYXRhc2V0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIC8vIEV4Y2VwdGlvbiBwcm9jZXNzIGlmIGRhdGFzZXQgaXMgZW1wdHkuXHJcbiAgICAgICAgICByZXR1cm4gZ3JpZE9iajtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBvcHRpb25zID0ge307XHJcblxyXG4gICAgICAgIG9wdGlvbnMuZGF0YSA9IHNjb3BlLmRhdGFzZXQ7XHJcblxyXG4gICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCBvcHRpb25zLCBzY29wZS5vcHRpb25zKTtcclxuXHJcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4gICAgICAgIGdyaWRPYmogPSAkKGVsZW1lbnQuY2hpbGRyZW4oKVswXSkuanFHcmlkKG9wdGlvbnMpO1xyXG5cclxuICAgICAgICBpZiAoc2NvcGUuY2FsbGJhY2spIHtcclxuICAgICAgICAgIHNjb3BlLmNhbGxiYWNrKGdyaWRPYmopO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGdyaWRPYmo7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL1xyXG4gICAgICAvLyBFdmVudHNcclxuICAgICAgLy9cclxuICAgICAgLy8gV2luZG93IFJlc2l6ZVxyXG4gICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBwYXJlbnRFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpLnBhcmVudCgpO1xyXG4gICAgICAgIGpxR3JpZC5zZXRHcmlkV2lkdGgocGFyZW50RWxlbWVudC53aWR0aCgpKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgKiBXYXRjaGVzXHJcbiAgICAgICovXHJcbiAgICAgIHZhciBvbk9wdGlvbnNDaGFuZ2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAganFHcmlkID0gaW5pdCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdmFyIHVud2F0Y2hPcHRpb25zID0gc2NvcGUuJHdhdGNoKCdvcHRpb25zJywgb25PcHRpb25zQ2hhbmdlZCwgdHJ1ZSk7XHJcblxyXG4gICAgICB2YXIgb25EYXRhc2V0Q2hhbmdlZCA9IGZ1bmN0aW9uKGRhdGFzZXQpIHtcclxuICAgICAgICB2YXIgc3RhcnREYXRhQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIGlmIChqcUdyaWQpIHtcclxuXHJcbiAgICAgICAgICBqcUdyaWQuanFHcmlkKCdjbGVhckdyaWREYXRhJyk7XHJcbiAgICAgICAgICAvLyAvLyBCdWdmaXggOiDqsLHsi6Ag7ZuEIHVuZGVmaW5lZCDtlonsnYQg7KCc6rGw7ZWY6riwIOychO2VtCBncmlkRGF0YSDquLjsnbTrpbwg7LK07YGsIO2bhCDruYjqsJIg7ZWg64u5XHJcbiAgICAgICAgICBpZigganFHcmlkLmdldCgwKS5wLnRyZWVHcmlkKSB7XHJcbiAgICAgICAgICAgIHZhciBwZXJmVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBqcUdyaWQuZ2V0KDApLmFkZEpTT05EYXRhKHtcclxuICAgICAgICAgICAgICByb3dzIDogZGF0YXNldFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZEpTT05EYXRhIDogJywgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBwZXJmVGltZSwgJ21zJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAganFHcmlkLmpxR3JpZCgnc2V0R3JpZFBhcmFtJywge1xyXG4gICAgICAgICAgICAgIGRhdGF0eXBlOiAnbG9jYWwnLFxyXG4gICAgICAgICAgICAgIGRhdGE6IGRhdGFzZXQsXHJcbiAgICAgICAgICAgICAgcm93TnVtOiBkYXRhc2V0Lmxlbmd0aFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vXHJcbiAgICAgICAgICAvLyBqcUdyaWQudHJpZ2dlcigncmVsb2FkR3JpZCcpO1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkRhdGFzZXRDaGFuZ2VkIDogJywgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydERhdGFDaGFuZ2VkLCAnbXMnKTtcclxuXHJcbiAgICAgICAgICByZXR1cm4ganFHcmlkLnRyaWdnZXIoJ3JlbG9hZCcpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgIGpxR3JpZCA9IGluaXQoKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgdmFyIHVud2F0Y2hEYXRhc2V0ID0gc2NvcGUuJHdhdGNoKCdkYXRhc2V0Jywgb25EYXRhc2V0Q2hhbmdlZCwgZmFsc2UpO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICogVGVhciBEb3duXHJcbiAgICAgICovXHJcbiAgICAgIGVsZW1lbnQub24oJyRkZXN0cm95JywgZnVuY3Rpb24gb25EZXN0cm95KCkge1xyXG4gICAgICAgIHVud2F0Y2hEYXRhc2V0KCk7XHJcbiAgICAgICAgdW53YXRjaE9wdGlvbnMoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG4gIH07XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuY29tbW9uLmNvbmZpZycsIFtdKVxuICAgIC5jb25maWcoWyckdXJsUm91dGVyUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG4gICAgICAgICAgICAvLyBXaXRob3V0IHNlcnZlciBzaWRlIHN1cHBvcnQgaHRtbDUgbXVzdCBiZSBkaXNhYmxlZC5cbiAgICAgICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5jb25maWcoWyckdHJhbnNsYXRlUHJvdmlkZXInLCBmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgIC8vIEluaXRpYWxpemUgYW5ndWxhci10cmFuc2xhdGVcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVN0YXRpY0ZpbGVzTG9hZGVyKHtcbiAgICAgICAgICAgIHByZWZpeDogJy9pYWFkbWluL2Zyb250ZW5kL2kxOG4vJyxcbiAgICAgICAgICAgIHN1ZmZpeDogJy5qc29uJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXIucHJlZmVycmVkTGFuZ3VhZ2UoJ2VuJyk7XG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJMb2coKTtcbiAgICB9XSlcbiAgICAuY29uZmlnKFsnZ3Jvd2xQcm92aWRlcicsIGZ1bmN0aW9uIChncm93bFByb3ZpZGVyKSB7XG4gICAgICAgIGdyb3dsUHJvdmlkZXIuZ2xvYmFsVGltZVRvTGl2ZSg1MDAwKTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5kaXJlY3RpdmVzJywgW10pXG4gICAgLmRpcmVjdGl2ZSgnc3RhdGljSW5jbHVkZScsIFsnJGh0dHAnLCAnJHRlbXBsYXRlQ2FjaGUnLCAnJGNvbXBpbGUnLCBmdW5jdGlvbiAoJGh0dHAsICR0ZW1wbGF0ZUNhY2hlLCAkY29tcGlsZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgdGVtcGxhdGVQYXRoID0gYXR0cnMuc3RhdGljSW5jbHVkZTtcblxuICAgICAgICAgICAgJGh0dHAuZ2V0KHRlbXBsYXRlUGF0aCwge2NhY2hlOiAkdGVtcGxhdGVDYWNoZX0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRzID0gJCgnPGRpdi8+JykuaHRtbChyZXNwb25zZSkuY29udGVudHMoKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoY29udGVudHMpO1xuICAgICAgICAgICAgICAgICRjb21waWxlKGNvbnRlbnRzKShzY29wZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNvbW1vbi5zZXJ2aWNlcycsIFtdKVxuICAgIC5zZXJ2aWNlKCdOb3RpZmljYXRpb25TZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgJ2dyb3dsJywgZnVuY3Rpb24gKCRyb290U2NvcGUsIGdyb3dsKSB7XG4gICAgICAgIHZhciBmbGFzaE1lc3NhZ2VRdWV1ZSA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb24obWVzc2FnZSwgdHlwZSkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZFN1Y2Nlc3NNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2FybicpIHtcbiAgICAgICAgICAgICAgICBncm93bC5hZGRXYXJuTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2luZm8nKSB7XG4gICAgICAgICAgICAgICAgZ3Jvd2wuYWRkSW5mb01lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdyb3dsLmFkZEVycm9yTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERpc3BsYXkgYWxsIGZsYXNoIG5vdGlmaWNhdGlvbnMgYWZ0ZXIgc3RhdGUgaGFzIGNoYW5nZWRcbiAgICAgICAgJHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdWNjZXNzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHdoaWxlIChmbGFzaE1lc3NhZ2VRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBmbGFzaE1lc3NhZ2VRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb3RpZmljYXRpb24oaXRlbS5tZXNzYWdlLCBpdGVtLnR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUHVibGljIEFQSVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2ZsYXNoTWVzc2FnZSc6IGZ1bmN0aW9uIChtZXNzYWdlLCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgZmxhc2hNZXNzYWdlUXVldWUucHVzaCh7bWVzc2FnZTogbWVzc2FnZSwgdHlwZTogdHlwZSB8fCAnaW5mbyd9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuc2VhcmNoLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1NlYXJjaCcsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgICAgIHZhciBhcGkgPSAkcmVzb3VyY2UoJy9hcGkvZG9jcy9zZWFyY2gnLCB7fSwge1xuICAgICAgICAgICAgJ3F1ZXJ5JzogIHttZXRob2Q6J0dFVCcsIGlzQXJyYXk6ZmFsc2V9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaW5kQnlTZWFyY2hUZXJtOiBmdW5jdGlvbihzZWFyY2hUZXJtLCBwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkucXVlcnkoe3BhZ2U6IHBhZ2VOdW1iZXIsIHNlYXJjaFRlcm06IHNlYXJjaFRlcm0sIHNpemU6IHBhZ2VTaXplLCBzb3J0OiAnSUQsREVTQyd9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmNtaXMuc2VydmljZXMnLCBbJ25nUmVzb3VyY2UnXSlcbiAgICAuZmFjdG9yeSgnQ01JUycsIFsnJHJlc291cmNlJywgJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UsIE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGFwaSA9ICRyZXNvdXJjZSgnL2pvb3EvYnJvd3Nlci90ZXN0L3Jvb3Q/Y21pc3NlbGVjdG9yPWNoaWxkcmVuJm9iamVjdElkPTppZCcsIHtcImlkXCI6IFwiQGlkXCJ9LCB7XG4gICAgICAgICAgICBxdWVyeTogIHttZXRob2Q6ICdHRVQnLCBwYXJhbXM6IHt9LCBpc0FycmF5OiBmYWxzZX1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHF1ZXJ5OiBmdW5jdGlvbihmb2xkZXJJZCwgcGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpLnF1ZXJ5KHtpZDogZm9sZGVySWQsIHBhZ2U6IHBhZ2VOdW1iZXIsIHNpemU6IHBhZ2VTaXplLCBzb3J0OiAnSUQsREVTQyd9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwLnN5c3RlbS5jb250cm9sbGVycycsIFtdKVxuICAgIC5jb25zdGFudCgncGFnaW5hdGlvbkNvbmZpZycsIHtcbiAgICAgICAgcGFnZVNpemU6IDIwMFxuICAgIH0pXG4gICAgXG4gICAgLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnc3lzdGVtJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPHVpLXZpZXcvPidcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3N5c3RlbS5pbmRleCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1N5c3RlbUxpc3RDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL3RvZG8tbGlzdC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBcdHNlYXJjaFJlc3VsdHM6IFsnU3lzdGVtJywgJ3BhZ2luYXRpb25Db25maWcnLCBmdW5jdGlvbihTeXN0ZW0sIHBhZ2luYXRpb25Db25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLnF1ZXJ5KDAsIHBhZ2luYXRpb25Db25maWcucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdzeXN0ZW0uYWRkJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdzeXN0ZW0vYWRkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FkZFN5c3RlbUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vYWRkLXRvZG8uaHRtbCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnc3lzdGVtLmVkaXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3N5c3RlbS86c3lzdGVtSWQvZWRpdCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0U3lzdGVtQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9lZGl0LXRvZG8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRUb2RvOiBbJ1N5c3RlbScsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihTeXN0ZW0sICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuc3lzdGVtSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5nZXQoJHN0YXRlUGFyYW1zLnN5c3RlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3N5c3RlbS5zZWFyY2hmb3JtJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdzeXN0ZW0vc2VhcmNoZm9ybS86c3lzdGVtSWQnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU2VhcmNoRm9ybUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vc2VhcmNoLWZvcm0uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRUb2RvOiBbJ1N5c3RlbScsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihTeXN0ZW0sICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuc3lzdGVtSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5nZXQoJHN0YXRlUGFyYW1zLnN5c3RlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3N5c3RlbS5lZGl0Zm9ybScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnc3lzdGVtLzpzeXN0ZW1JZC9lZGl0Zm9ybScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0Rm9ybUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vZWRpdC1mb3JtLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkVG9kbzogWydTeXN0ZW0nLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oU3lzdGVtLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnN5c3RlbUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTeXN0ZW0uZ2V0KCRzdGF0ZVBhcmFtcy5zeXN0ZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdzeXN0ZW0udmlldycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnc3lzdGVtLzpzeXN0ZW1JZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdWaWV3U3lzdGVtQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby92aWV3LXRvZG8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdlZFRvZG86IFsnU3lzdGVtJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFN5c3RlbSwgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5zeXN0ZW1JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3lzdGVtLmdldCgkc3RhdGVQYXJhbXMuc3lzdGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIF0pXG4gICAgLmNvbnRyb2xsZXIoJ1N5c3RlbUxpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3NlYXJjaFJlc3VsdHMnLCdwYWdpbmF0aW9uQ29uZmlnJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHNlYXJjaFJlc3VsdHMsIHBhZ2luYXRpb25Db25maWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBkb2N1bWVudHMuJyk7XG4gICAgICAgICRzY29wZS50b2RvcyA9IHNlYXJjaFJlc3VsdHMuY29udGVudDtcbiAgICAgICAgY29uc29sZS5sb2coc2VhcmNoUmVzdWx0cyk7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlYXJjaFJlc3VsdHMudG90YWxFbGVtZW50cyk7XG4gICAgICAgIGNvbnNvbGUubG9nKHBhZ2luYXRpb25Db25maWcucGFnZVNpemUpO1xuICAgICAgICAkc2NvcGUucGFnaW5hdGlvbiA9IHtcbiAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBzZWFyY2hSZXN1bHRzLm51bWJlciArIDEsXG4gICAgICAgICAgICBpdGVtc1BlclBhZ2U6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemUsXG4gICAgICAgICAgICB0b3RhbEl0ZW1zOiBzZWFyY2hSZXN1bHRzLnRvdGFsRWxlbWVudHNcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5hZGRUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3N5c3RlbS5hZGQnKTtcbiAgICAgICAgfTtcblxuICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdBZGRTeXN0ZW1Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ1N5c3RlbScsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBTeXN0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgYWRkIHRvZG8gZW50cnkgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0ge307XG5cbiAgICAgICAgICAgICRzY29wZS5zYXZlVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudG9kb0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihhZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdzeXN0ZW0udmlldycsIHtzeXN0ZW1JZDogYWRkZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04ucGFyc2UoJHNjb3BlLnRvZG8uZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbS5zYXZlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdEZWxldGVTeXN0ZW1Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJG1vZGFsSW5zdGFuY2UnLCAnJHN0YXRlJywgJ1N5c3RlbScsICdkZWxldGVkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgU3lzdGVtLCBkZWxldGVkVG9kbykge1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSBkZWxldGVkVG9kbztcblxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdzeXN0ZW0uaW5kZXgnLCB7fSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFN5c3RlbS5kZWxldGUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSkgICAgICAgIFxuICAgIC5jb250cm9sbGVyKCdFZGl0Rm9ybUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAndXBkYXRlZFRvZG8nLCAnU3lzdGVtJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHVwZGF0ZWRUb2RvLCBTeXN0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgIFx0JHNjb3BlLnNjaGVtYSA9IHtcbiAgICAgICAgICAgXHRcdCAgXCJ0eXBlXCI6IFwib2JqZWN0XCIsXG4gICAgICAgICAgIFx0XHQgIFwidGl0bGVcIjogXCJzY2hlbWFcIixcbiAgICAgICAgICAgXHRcdCAgXCJwcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgXHRcdFx0XCJzeW1ib2xpY05hbWVcIjp7XG4gICAgICAgICAgIFx0XHRcdFx0XCJ0eXBlXCI6XCJzdHJpbmdcIixcbiAgICAgICAgICAgXHRcdFx0XHRcInRpdGxlXCI6XCLQodC40LzQstC+0LvRjNC90YvQuSDQuNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDRgtC40L/QsFwiXG4gICAgICAgICAgIFx0XHRcdH0sXG4gICAgICAgICAgIFx0XHRcdFwic3RvcmFnZV9wb2xpY3lcIjp7XG4gICAgICAgICAgIFx0XHRcdFx0XCJ0eXBlXCI6XCJzdHJpbmdcIixcbiAgICAgICAgICAgXHRcdFx0XHRcInRpdGxlXCI6XCLQn9C+0LvQuNGC0LjQutCwINGF0YDQsNC90LXQvdC40Y9cIlxuICAgICAgICAgICBcdFx0XHR9LFxuICAgICAgICAgICBcdFx0ICAgIFwicHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgIFx0XHQgICAgICBcInR5cGVcIjogXCJhcnJheVwiLFxuICAgICAgICAgICBcdFx0ICAgICAgXCJpdGVtc1wiOiB7XG4gICAgICAgICAgIFx0XHQgICAgICAgIFwidHlwZVwiOiBcIm9iamVjdFwiLFxuICAgICAgICAgICBcdFx0ICAgICAgICBcInByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICBcdFx0ICAgICAgICAgIFwibmFtZVwiOiB7XG4gICAgICAgICAgIFx0XHQgICAgICAgICAgICBcInRpdGxlXCI6IFwi0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0LDRgtGA0LjQsdGD0YLQsFwiLFxuICAgICAgICAgICBcdFx0ICAgICAgICAgICAgXCJ0eXBlXCI6IFwic3RyaW5nXCJcbiAgICAgICAgICAgXHRcdCAgICAgICAgICB9LFxuICAgICAgICAgICBcdFx0ICAgICAgICAgIFwidGl0bGVcIjoge1xuICAgICAgICAgICBcdFx0ICAgICAgICAgICAgXCJ0aXRsZVwiOiBcItCX0LDQs9C+0LvQvtCy0L7QuiDQsNGC0YDQuNCx0YPRgtCwXCIsXG4gICAgICAgICAgIFx0XHQgICAgICAgICAgICBcInR5cGVcIjogXCJzdHJpbmdcIlxuICAgICAgICAgICBcdFx0ICAgICAgICAgIH0sXG4gICAgICAgICAgIFx0XHQgICAgICAgICAgXCJ0eXBlXCI6IHtcbiAgICAgICAgICAgXHRcdCAgICAgICAgICAgIFwidGl0bGVcIjogXCLQotC40L8g0LDRgtGA0LjQsdGD0YLQsFwiLFxuICAgICAgICAgICBcdFx0ICAgICAgICAgICAgXCJ0eXBlXCI6IFwic3RyaW5nXCJcbiAgICAgICAgICAgXHRcdCAgICAgICAgICB9XG4gICAgICAgICAgIFx0XHQgICAgICAgIH0sXG4gICAgICAgICAgIFx0XHQgICAgICAgIFwicmVxdWlyZWRcIjogW1xuICAgICAgICAgICBcdFx0ICAgICAgICAgIFwibmFtZVwiLFxuICAgICAgICAgICBcdFx0ICAgICAgICAgIFwidGl0bGVcIixcbiAgICAgICAgICAgXHRcdCAgICAgICAgICBcInR5cGVcIlxuICAgICAgICAgICBcdFx0ICAgICAgICBdXG4gICAgICAgICAgIFx0XHQgICAgICB9XG4gICAgICAgICAgIFx0XHQgICAgfVxuICAgICAgICAgICBcdFx0ICB9XG4gICAgICAgICAgIFx0XHR9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkc2NvcGUuZm9ybSA9IFtcbiAgICAgICAgICAgIFx0e1wia2V5XCI6XCJzeW1ib2xpY05hbWVcIn0sXG4gICAgICAgICAgICBcdHtcImtleVwiOlwic3RvcmFnZV9wb2xpY3lcIn0sXG4gICAgICAgICAgICBcdHtcInR5cGVcIjogXCJ0YWJzXCIsXG4gICAgICAgICBcdFx0ICAgICAgICBcInRhYnNcIjogW1xuICAgICAgICAgXHRcdCAgICAgICAgICB7XG4gICAgICAgICBcdFx0ICAgICAgICAgICAgXCJ0aXRsZVwiOiBcItCQ0YLRgNC40LHRg9GC0YtcIixcbiAgICAgICAgIFx0XHQgICAgICAgICAgICBcIml0ZW1zXCI6IFtcbiAgICAgICAgIFx0XHQgICAgICAgICAgICBcdHtcblx0XHQgICAgICAgICAgICBcdFx0ICAgIFwia2V5XCI6IFwicHJvcGVydGllc1wiLFxuXHRcdCAgICAgICAgICAgIFx0XHQgICAgXCJ0eXBlXCI6IFwidGFiYXJyYXlcIixcblx0XHQgICAgICAgICAgICBcdFx0ICAgIFwiYWRkXCI6IFwi0JTQvtCx0LDQstC40YLRjFwiLFxuXHRcdCAgICAgICAgICAgIFx0XHQgICAgXCJyZW1vdmVcIjogXCLQo9C00LDQu9C40YLRjFwiLFxuXHRcdCAgICAgICAgICAgIFx0XHQgICAgXCJzdHlsZVwiOiB7XG5cdFx0ICAgICAgICAgICAgXHRcdCAgICAgIFwicmVtb3ZlXCI6IFwiYnRuLWRhbmdlclwiXG5cdFx0ICAgICAgICAgICAgXHRcdCAgICB9LFxuXHRcdCAgICAgICAgICAgIFx0XHQgICAgXCJ0aXRsZVwiOiBcInt7IHZhbHVlLm5hbWUgfHwgJ1RhYiAnKyRpbmRleCB9fVwiLFxuXHRcdCAgICAgICAgICAgIFx0XHQgICAgXCJpdGVtc1wiOiBbXG5cdFx0ICAgICAgICAgICAgXHRcdCAgICAgIFwicHJvcGVydGllc1tdLm5hbWVcIixcblx0XHQgICAgICAgICAgICBcdFx0ICAgICAgXCJwcm9wZXJ0aWVzW10udGl0bGVcIixcblx0XHQgICAgICAgICAgICBcdFx0ICAgICAgXCJwcm9wZXJ0aWVzW10udHlwZVwiXG5cdFx0ICAgICAgICAgICAgXHRcdCAgICBdXG5cdFx0ICAgICAgICAgICAgXHRcdCAgfVxuICAgICAgICAgXHRcdCAgICAgICAgICAgIF1cbiAgICAgICAgIFx0XHQgICAgICAgICAgfSxcbiAgICAgICAgIFx0XHQgICAgICAgICAge1xuICAgICAgICAgXHRcdCAgICAgICAgXHRcInRpdGxlXCI6IFwi0J/RgNCw0LLQsCDQtNC+0YHRgtGD0L/QsFwiLFxuICAgICAgICAgICBcdFx0ICAgICAgICAgICAgXCJpdGVtc1wiOiBbIF0gXG4gICAgICAgICBcdFx0ICAgICAgICAgIH1cbiAgICAgICAgIFx0XHQgICAgICAgIF1cbiAgICAgICAgICAgIFx0XHR9XG4gICAgICAgICAgICBcdFx0XTtcbiAgICAgICAgICAgIHZhciBwcm9wcyA9ICRzY29wZS50b2RvLmRhdGEuc2NoZW1hLnByb3BlcnRpZXM7XG4gICAgICAgICAgICB2YXIgbW9kZWwgPSAkc2NvcGUudG9kby5kYXRhO1xuICAgICAgICAgICAgbW9kZWwuc3ltYm9saWNOYW1lPSRzY29wZS50b2RvLnN5bWJvbGljTmFtZTtcbiAgICAgICAgICAgIG1vZGVsLnByb3BlcnRpZXM9W107XG4gICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIHByb3BzKXtcbiAgICAgICAgICAgIFx0dmFyIG1wcm9wID0ge1wibmFtZVwiOnByb3AsXCJ0aXRsZVwiOnByb3BzW3Byb3BdLnRpdGxlLFwidHlwZVwiOnByb3BzW3Byb3BdLnR5cGV9XG4gICAgICAgICAgICBcdG1vZGVsLnByb3BlcnRpZXMucHVzaChtcHJvcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtb2RlbCk7XG4gICAgICAgICAgICAkc2NvcGUubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgICAgICRzY29wZS5zYXZlVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudG9kb0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbih1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N5c3RlbS52aWV3Jywge3N5c3RlbUlkOiB1cGRhdGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3Byb3BzID0gJHNjb3BlLm1vZGVsLnByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwcm9wID0ge31cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNwcm9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBcdHJlc3Byb3BbcmVzcHJvcHNbaV0ubmFtZV09e307XG4gICAgICAgICAgICAgICAgICAgIFx0cmVzcHJvcFtyZXNwcm9wc1tpXS5uYW1lXS50aXRsZT1yZXNwcm9wc1tpXS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgXHRyZXNwcm9wW3Jlc3Byb3BzW2ldLm5hbWVdLnR5cGU9cmVzcHJvcHNbaV0udHlwZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhLnNjaGVtYS5wcm9wZXJ0aWVzPXJlc3Byb3A7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2RvLnN5bWJvbGljTmFtZT0kc2NvcGUubW9kZWwuc3ltYm9saWNOYW1lO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUudG9kbyk7XG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbS51cGRhdGUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgICAgIFxuICAgIC5jb250cm9sbGVyKCdTZWFyY2hGb3JtQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICd1cGRhdGVkVG9kbycsICdTeXN0ZW0nLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgdXBkYXRlZFRvZG8sIFN5c3RlbSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2codXBkYXRlZFRvZG8pO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB1cGRhdGVkVG9kbztcbiAgICAgICAgICAgXHQkc2NvcGUuc2NoZW1hID0gJHNjb3BlLnRvZG8uZGF0YS5zY2hlbWE7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5mb3JtID0gJHNjb3BlLnRvZG8uZGF0YS5mb3JtO1xuICAgICAgICAgICAgdmFyIG1vZGVsID0ge307XG5cbiAgICAgICAgICAgICRzY29wZS5tb2RlbCA9IG1vZGVsO1xuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3lzdGVtLnZpZXcnLCB7c3lzdGVtSWQ6IHVwZGF0ZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUudG9kbyk7XG4gICAgICAgICAgICAgICAgICAgIC8vU3lzdGVtLnVwZGF0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSlcbiAgICAuY29udHJvbGxlcignRWRpdFN5c3RlbUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAndXBkYXRlZFRvZG8nLCAnU3lzdGVtJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHVwZGF0ZWRUb2RvLCBTeXN0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04uc3RyaW5naWZ5KCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3lzdGVtLnZpZXcnLCB7c3lzdGVtSWQ6IHVwZGF0ZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPUpTT04ucGFyc2UoJHNjb3BlLnRvZG8uZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIFN5c3RlbS51cGRhdGUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ1ZpZXdTeXN0ZW1Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3ZpZXdlZFRvZG8nLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgdmlld2VkVG9kbykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyB2aWV3IHRvZG8gZW50cnkgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdmlld2VkVG9kbztcblxuICAgICAgICAgICAgJHNjb3BlLnNob3dFZGl0UGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyhcInN5c3RlbS5lZGl0XCIsIHtzeXN0ZW1JZDogJHNjb3BlLnRvZG8uaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAuc3lzdGVtLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1N5c3RlbScsIFsnJHJlc291cmNlJywgJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UsIE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGFwaSA9ICRyZXNvdXJjZSgnL2FwaS9zeXN0ZW0vOmlkJywge1wiaWRcIjogXCJAaWRcIn0sIHtcbiAgICAgICAgICAgIHF1ZXJ5OiAge21ldGhvZDogJ0dFVCcsIHBhcmFtczoge30sIGlzQXJyYXk6IGZhbHNlfSxcbiAgICAgICAgICAgIGdldDogICAge21ldGhvZDogJ0dFVCd9LFxuICAgICAgICAgICAgc2F2ZToge21ldGhvZDogJ1BPU1QnfSxcbiAgICAgICAgICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCd9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWxldGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkuZGVsZXRlKHRvZG8sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmRlbGV0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcXVlcnk6IGZ1bmN0aW9uKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5xdWVyeSh7cGFnZTogcGFnZU51bWJlciwgc2l6ZTogcGFnZVNpemUsIHNvcnQ6ICdJRCxERVNDJ30pLiRwcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24odG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQoe2lkOiB0b2RvSWR9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlOiBmdW5jdGlvbih0b2RvLCBzdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBhcGkuc2F2ZSh0b2RvLCBmdW5jdGlvbihhZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmFkZC5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGFkZGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUodG9kbywgZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLnVwZGF0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdhcHAudG9kby5jb250cm9sbGVycycsIFsndWkuYm9vdHN0cmFwJ10pXG4gICAgLmNvbnN0YW50KCdwYWdpbmF0aW9uQ29uZmlnJywge1xuICAgICAgICBwYWdlU2l6ZTogMjAwXG4gICAgfSlcbiAgICBcbiAgICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPHVpLXZpZXcvPidcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uaW5kZXgnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJycsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUb2RvTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdG9kby1saXN0Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIFx0c2VhcmNoUmVzdWx0czogWydUb2RvcycsICdwYWdpbmF0aW9uQ29uZmlnJywgZnVuY3Rpb24oVG9kb3MsIHBhZ2luYXRpb25Db25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9kb3MucXVlcnkoMCwgcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8udHJlZScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby90cmVlJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RvZG9UcmVlQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby90b2RvLXRyZWUuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgXHRzZWFyY2hSZXN1bHRzOiBbJ0NNSVMnLCAncGFnaW5hdGlvbkNvbmZpZycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihDTUlTLCBwYWdpbmF0aW9uQ29uZmlnLCRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDTUlTLnF1ZXJ5KCcwJywwLCBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8ucGFnZScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby9wYWdlLzpwYWdlTnVtYmVyL3NpemUvOnBhZ2VTaXplJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RvZG9MaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby90b2RvLWxpc3QuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgXHRzZWFyY2hSZXN1bHRzOiBbJ1RvZG9zJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFRvZG9zLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9kb3MucXVlcnkoJHN0YXRlUGFyYW1zLnBhZ2VOdW1iZXIgLSAxLCAkc3RhdGVQYXJhbXMucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLmFkZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAndG9kby9hZGQnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQWRkVG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vYWRkLXRvZG8uaHRtbCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndG9kby5lZGl0Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvLzp0b2RvSWQvZWRpdCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0VG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vZWRpdC10b2RvLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkVG9kbzogWydUb2RvcycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihUb2RvcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy50b2RvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLmdldCgkc3RhdGVQYXJhbXMudG9kb0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uZWRpdGZvcm0nLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vOnRvZG9JZC9lZGl0Zm9ybScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0Rm9ybUNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vZWRpdC1mb3JtLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkVG9kbzogWydUb2RvcycsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbihUb2RvcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy50b2RvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRvZG9zLmdldCgkc3RhdGVQYXJhbXMudG9kb0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3RvZG8uc2VhcmNoJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICd0b2RvL3NlYXJjaC86c2VhcmNoVGVybS9wYWdlLzpwYWdlTnVtYmVyL3NpemUvOnBhZ2VTaXplJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NlYXJjaFJlc3VsdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3NlYXJjaC9zZWFyY2gtcmVzdWx0cy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoVGVybTogWyckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbigkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLnNlYXJjaFRlcm07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFJlc3VsdHM6IFsnU2VhcmNoJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFNlYXJjaCwgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5zZWFyY2hUZXJtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTZWFyY2guZmluZEJ5U2VhcmNoVGVybSgkc3RhdGVQYXJhbXMuc2VhcmNoVGVybSwgJHN0YXRlUGFyYW1zLnBhZ2VOdW1iZXIgLSAxLCAkc3RhdGVQYXJhbXMucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd0b2RvLnZpZXcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3RvZG8vOnRvZG9JZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdWaWV3VG9kb0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zyb250ZW5kL3BhcnRpYWxzL3RvZG8vdmlldy10b2RvLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3ZWRUb2RvOiBbJ1RvZG9zJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKFRvZG9zLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLnRvZG9JZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9kb3MuZ2V0KCRzdGF0ZVBhcmFtcy50b2RvSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIF0pXG4gICAgLmNvbnRyb2xsZXIoJ1RvZG9MaXN0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdzZWFyY2hSZXN1bHRzJywncGFnaW5hdGlvbkNvbmZpZycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBzZWFyY2hSZXN1bHRzLCBwYWdpbmF0aW9uQ29uZmlnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgZG9jdW1lbnRzLicpO1xuICAgICAgICAkc2NvcGUudG9kb3MgPSBzZWFyY2hSZXN1bHRzLmNvbnRlbnQ7XG4gICAgICAgIGNvbnNvbGUubG9nKHNlYXJjaFJlc3VsdHMpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWFyY2hSZXN1bHRzLnRvdGFsRWxlbWVudHMpO1xuICAgICAgICBjb25zb2xlLmxvZyhwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplKTtcbiAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgICBjdXJyZW50UGFnZTogc2VhcmNoUmVzdWx0cy5udW1iZXIgKyAxLFxuICAgICAgICAgICAgaXRlbXNQZXJQYWdlOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplLFxuICAgICAgICAgICAgdG90YWxJdGVtczogc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAkc2NvcGUuYWRkVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLmFkZCcpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLm9wZW5UcmVlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udHJlZScpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgJHNjb3BlLnBhZ2VDaGFuZ2VkID0gZnVuY3Rpb24obmV3UGFnZU51bWJlcikge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnBhZ2UnLFxuICAgICAgICAgICAgICAgIHtwYWdlTnVtYmVyOiBuZXdQYWdlTnVtYmVyLCBwYWdlU2l6ZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZX0sXG4gICAgICAgICAgICAgICAge3JlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcbiAgICB9XSlcbiAgICAuY29udHJvbGxlcignRWRpdFRvZG9Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3VwZGF0ZWRUb2RvJywgJ1RvZG9zJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHVwZGF0ZWRUb2RvLCBUb2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2codXBkYXRlZFRvZG8pO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB1cGRhdGVkVG9kbztcbiAgICAgICAgICAgICRzY29wZS50b2RvLmRhdGE9SlNPTi5zdHJpbmdpZnkoJHNjb3BlLnRvZG8uZGF0YSk7XG4gICAgICAgICAgICAkc2NvcGUuc2F2ZVRvZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnRvZG9Gb3JtLiR2YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnZpZXcnLCB7dG9kb0lkOiB1cGRhdGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZG8uZGF0YT1KU09OLnBhcnNlKCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBUb2Rvcy51cGRhdGUoJHNjb3BlLnRvZG8sIG9uU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgLmNvbnRyb2xsZXIoJ1NlYXJjaENvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAncGFnaW5hdGlvbkNvbmZpZycsXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRzdGF0ZSwgcGFnaW5hdGlvbkNvbmZpZykge1xuXG4gICAgICAgICAgICB2YXIgdXNlcldyaXRpbmdTZWFyY2hUZXJtID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgbWluaW11bVNlYXJjaFRlcm1MZW5ndGggPSAzO1xuXG4gICAgICAgICAgICAkc2NvcGUubWlzc2luZ0NoYXJzID0gbWluaW11bVNlYXJjaFRlcm1MZW5ndGg7XG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoVGVybSA9IFwiXCI7XG5cbiAgICAgICAgICAgICRzY29wZS5zZWFyY2hGaWVsZEJsdXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1c2VyV3JpdGluZ1NlYXJjaFRlcm0gPSBmYWxzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS5zZWFyY2hGaWVsZEZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXNlcldyaXRpbmdTZWFyY2hUZXJtID0gdHJ1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS5zaG93TWlzc2luZ0NoYXJhY3RlclRleHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodXNlcldyaXRpbmdTZWFyY2hUZXJtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoVGVybS5sZW5ndGggPCBtaW5pbXVtU2VhcmNoVGVybUxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zZWFyY2hUZXJtLmxlbmd0aCA8IG1pbmltdW1TZWFyY2hUZXJtTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNzaW5nQ2hhcnMgPSBtaW5pbXVtU2VhcmNoVGVybUxlbmd0aCAtICRzY29wZS5zZWFyY2hUZXJtLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNzaW5nQ2hhcnMgPSAwO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8uc2VhcmNoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtOiAkc2NvcGUuc2VhcmNoVGVybSwgcGFnZU51bWJlcjogMSwgcGFnZVNpemU6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemV9LFxuICAgICAgICAgICAgICAgICAgICAgICAge3JlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfV0pXG4gIC5jb250cm9sbGVyKCdTZWFyY2hSZXN1bHRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ3BhZ2luYXRpb25Db25maWcnLCAnc2VhcmNoVGVybScsICdzZWFyY2hSZXN1bHRzJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIHBhZ2luYXRpb25Db25maWcsIHNlYXJjaFRlcm0sIHNlYXJjaFJlc3VsdHMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgc2VhcmNoIHJlc3VsdHMgcGFnZS4nKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvcyA9IHNlYXJjaFJlc3VsdHMuY29udGVudDtcblxuICAgICAgICAgICAgJHNjb3BlLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IHNlYXJjaFJlc3VsdHMubnVtYmVyICsgMSxcbiAgICAgICAgICAgICAgICBpdGVtc1BlclBhZ2U6IHBhZ2luYXRpb25Db25maWcucGFnZVNpemUsXG4gICAgICAgICAgICAgICAgdG90YWxJdGVtczogc2VhcmNoUmVzdWx0cy50b3RhbEVsZW1lbnRzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUucGFnZUNoYW5nZWQgPSBmdW5jdGlvbihuZXdQYWdlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd0b2RvLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtOiBzZWFyY2hUZXJtLCBwYWdlTnVtYmVyOiBuZXdQYWdlTnVtYmVyLCBwYWdlU2l6ZTogcGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZX0sXG4gICAgICAgICAgICAgICAgICAgIHtyZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZX1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgICAgIFxuICAuY29udHJvbGxlcignRG9jdW1lbnRNb2RhbENvbnRyb2xsZXInLCBbJyRzY29wZScsICckbW9kYWxJbnN0YW5jZScsICckc3RhdGUnLCAnVG9kb3MnLCAndmlld2VkRG9jJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkbW9kYWxJbnN0YW5jZSwgJHN0YXRlLCBUb2Rvcywgdmlld2VkRG9jKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IHZpZXdlZERvYztcblxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLmVkaXREb2N1bWVudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pICAgICAgXG4gIC5jb250cm9sbGVyKCdUb2RvVHJlZUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnJG1vZGFsJywgJ1RvZG9zJywgJ3NlYXJjaFJlc3VsdHMnLCdwYWdpbmF0aW9uQ29uZmlnJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRtb2RhbCwgVG9kb3MsIHNlYXJjaFJlc3VsdHMsIHBhZ2luYXRpb25Db25maWcpIHtcblxuICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIGRvY3VtZW50cyB0cmVlLicpO1xuICAgICAgICB2YXIgY3VycmVudERlZkZvcm1JZD0nJztcbiAgICAgICAgdmFyIGNtaXNfcm9vdD0gXCIvam9vcS9icm93c2VyL3Rlc3Qvcm9vdFwiO1xuXHRcdCAgICAkKCcjdHJlZWNvbnRhaW5lcicpLmpzdHJlZSh7XG5cdFx0ICAgICdjb3JlJyA6IHtcblx0XHQgICAgICAnZGF0YScgOiB7XG5cdFx0ICAgICAgICBcInVybFwiIDogZnVuY3Rpb24gKG5vZGUpIHtcblx0XHRcdFx0XHQgIHJldHVybiBub2RlLmlkID09PSAnIycgP1xuXHRcdFx0XHRcdFx0Y21pc19yb290K1wiP29iamVjdElkPTAmY21pc3NlbGVjdG9yPWNoaWxkcmVuXCIgOlxuXHRcdFx0XHRcdFx0Y21pc19yb290K1wiP29iamVjdElkPVwiK25vZGUuaWQrXCImY21pc3NlbGVjdG9yPWNoaWxkcmVuXCI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XCJkYXRhRmlsdGVyXCIgOiBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRcdHZhciBub2RlcyA9IFtdO1xuXHRcdFx0XHRcdCQuZWFjaChKU09OLnBhcnNlKGRhdGEpLm9iamVjdHMsIGZ1bmN0aW9uKGksaXRlbSl7XG5cdFx0XHRcdFx0XHR2YXIgbm9kZSA9IHt9O1xuXHRcdFx0XHRcdFx0bm9kZS5pZD0gaXRlbS5vYmplY3QucHJvcGVydGllc1tcImNtaXM6b2JqZWN0SWRcIl0udmFsdWU7XG5cdFx0XHRcdFx0XHRub2RlLmRhdGEgPSB7XCJ0eXBlXCI6IGl0ZW0ub2JqZWN0LnByb3BlcnRpZXNbXCJjbWlzOm9iamVjdFR5cGVJZFwiXS52YWx1ZX07XG5cdFx0XHRcdFx0XHRub2RlLnRleHQ9aXRlbS5vYmplY3QucHJvcGVydGllc1tcImNtaXM6bmFtZVwiXS52YWx1ZTtcblx0XHRcdFx0XHRcdGlmIChpdGVtLm9iamVjdC5wcm9wZXJ0aWVzW1wiY21pczpvYmplY3RUeXBlSWRcIl0udmFsdWU9PVwiY21pczpmb2xkZXJcIil7bm9kZS5jaGlsZHJlbj10cnVlfVxuXHRcdFx0XHRcdFx0bm9kZXMucHVzaChub2RlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0ICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobm9kZXMpO1xuXHRcdFx0XHQgICB9LFxuXHRcdCAgICAgICAgXCJkYXRhXCIgOiBmdW5jdGlvbiAobm9kZSkge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKG5vZGUgKTtcblx0XHQgICAgICAgICAgcmV0dXJuIHsgXCJpZFwiIDogbm9kZS5pZCwgXCJ0ZXh0XCI6IFwiMVwiIH07XG5cdFx0ICAgICAgICB9XG5cdFx0ICAgICAgfVxuXHRcdCAgICB9XG5cdFx0ICB9KTtcblx0XHQgIC8vJChcIiN0cmVlY29udGFpbmVyXCIpLmpzdHJlZSgnY3JlYXRlX25vZGUnLCAnIycsIHsnaWQnIDogJzAnLCAndGV4dCcgOiAnUm9vdCBmb2xkZXInfSwgJ2xhc3QnKTtcblx0XHQgICQoJyN0cmVlY29udGFpbmVyJykub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIiwgZnVuY3Rpb24gKGUsIGRhdGEpIHtcblx0XHRcdCAgY29uc29sZS5sb2coXCJub2RlX2lkOiBcIisgZGF0YS5ub2RlLnR5cGUgKyBcIiAtIFwiICsgZGF0YS5ub2RlLmlkKTsgXG5cdFx0XHQgIGlmIChkYXRhLm5vZGUuZGF0YS50eXBlPT1cImNtaXM6Zm9sZGVyXCIpe1xuXHRcdFx0XHQkc2NvcGUubG9hZEdyaWQoZGF0YS5ub2RlLmlkKTtcblx0XHRcdCAgfWVsc2V7XG5cdFx0XHRcdHZhciBkb2NpZCA9IHBhcnNlSW50KGRhdGEubm9kZS5pZCk7XG5cdFx0XHRcdC8vJHN0YXRlLmdvKCd0b2RvLnZpZXcnLCB7dG9kb0lkOiBkb2NpZH0sIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWUgfSk7XG5cdFx0XHRcdCRzY29wZS5vcGVuRG9jdW1lbnQoVG9kb3MsIGRvY2lkKTtcblx0XHRcdCAgfVxuXHRcdFx0ICBcblx0XHRcdH0pO1xuXHQkc2NvcGUub3BlbkRvY3VtZW50ID0gZnVuY3Rpb24oVG9kb3MsIGRvY2lkKXtcblx0XHR2YXIgdmlld3NVcmwgPSAnL2FwaS9kb2NzLycrZG9jaWQ7XG5cdFx0JC5nZXRKU09OKHZpZXdzVXJsLCBmdW5jdGlvbih2aWV3ZGF0YSkge1xuXHQgICAgICAgIGlmICh2aWV3ZGF0YS50eXBlPT0ndmlldycpe1xuXHRcdFx0XHQkc2NvcGUubG9hZEdyaWQoJzAnLHZpZXdkYXRhKTtcblx0ICAgICAgICB9ZWxzZXtcblx0ICAgICAgICBcdCRzY29wZS50b2RvID0gIHZpZXdkYXRhO1xuXHRcdFx0XHQkbW9kYWwub3Blbih7XG5cdFx0ICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdmcm9udGVuZC9wYXJ0aWFscy90b2RvL2RvY3VtZW50LXZpZXctbW9kYWwuaHRtbCcsXG5cdFx0ICAgICAgICAgICAgY29udHJvbGxlcjogJ0RvY3VtZW50TW9kYWxDb250cm9sbGVyJyxcblx0XHQgICAgICAgICAgICByZXNvbHZlOiB7XG5cdFx0ICAgICAgICAgICAgICAgIHZpZXdlZERvYzogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS50b2RvO1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB9XG5cdFx0ICAgICAgICAgICAgfVxuXHRcdFx0XHR9KTsgXG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdH1cblx0JHNjb3BlLmxvYWRHcmlkID0gZnVuY3Rpb24oZm9sZGVySWQsdmlld2RhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBkb2N1bWVudHMgZ3JpZC4nKTtcbiAgICAgICAgXG4gICAgXHQkKFwiI2pxR3JpZFwiKS5qcUdyaWQoJ0dyaWRVbmxvYWQnKTtcbiAgICBcdHZhciBkYXRlT3B0aW9ucz0ge1xuICAgIFx0XHRcdC8vIGRhdGFJbml0IGlzIHRoZSBjbGllbnQtc2lkZSBldmVudCB0aGF0IGZpcmVzIHVwb24gaW5pdGlhbGl6aW5nIHRoZSB0b29sYmFyIHNlYXJjaCBmaWVsZCBmb3IgYSBjb2x1bW5cbiAgICBcdFx0XHQvLyB1c2UgaXQgdG8gcGxhY2UgYSB0aGlyZCBwYXJ0eSBjb250cm9sIHRvIGN1c3RvbWl6ZSB0aGUgdG9vbGJhclxuICAgIFx0XHRcdGRhdGFJbml0OiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIFx0XHRcdFx0JChlbGVtZW50KS5kYXRlcGlja2VyKHtcbiAgICBcdFx0XHRcdFx0aWQ6ICdvcmRlckRhdGVfZGF0ZVBpY2tlcicsXG4gICAgXHRcdFx0XHRcdGRhdGVGb3JtYXQ6ICd5eS1tbS1kZCcsXG4gICAgXHRcdFx0XHRcdC8vbWluRGF0ZTogbmV3IERhdGUoMjAxMCwgMCwgMSksXG4gICAgXHRcdFx0XHRcdG1heERhdGU6IG5ldyBEYXRlKDIwMjAsIDAsIDEpLFxuICAgIFx0XHRcdFx0XHRzaG93T246ICdmb2N1cydcbiAgICBcdFx0XHRcdH0pO1xuICAgIFx0XHRcdH0sXG4gICAgXHRcdFx0Ly8gc2hvdyBzZWFyY2ggb3B0aW9uc1xuICAgIFx0XHRcdHNvcHQ6IFtcImd0XCIsXCJsdFwiLFwiZXFcIl0gLy8gZ3QgPSBncmVhdGVyICwgbHQgPSBsZXNzICwgZXEgPSBlcXVhbCB0b1x0XHRcdFx0XHRcdFx0XG4gICAgXHRcdH07XG4gICAgXHR2YXIgZWRpdFNldHRpbmdzID0ge1xuICAgIFx0XHRcdHJlY3JlYXRlRm9ybTp0cnVlLFxuICAgIFx0XHRcdGpxTW9kYWw6ZmFsc2UsXG4gICAgXHRcdFx0cmVsb2FkQWZ0ZXJTdWJtaXQ6ZmFsc2UsXG4gICAgXHRcdFx0Y2xvc2VPbkVzY2FwZTp0cnVlLFxuICAgIFx0XHRcdHNhdmVrZXk6IFt0cnVlLDEzXSxcbiAgICBcdFx0XHRjbG9zZUFmdGVyRWRpdDp0cnVlLFxuICAgIFx0XHRcdGFmdGVyU2hvd0Zvcm06ZnVuY3Rpb24oKXtcbiAgICBcdFx0XHRcdCQoXCIjbHVpX1wiK2dyaWRbMF0uaWQpLmhpZGUoKTtcbiAgICBcdFx0XHR9XG4gICAgXHRcdH07XG4gICAgXHR2YXIgYWRkU2V0dGluZ3MgPSB7XG4gICAgXHRcdFx0cmVjcmVhdGVGb3JtOnRydWUsXG4gICAgXHRcdFx0anFNb2RhbDpmYWxzZSxcbiAgICBcdFx0XHRyZWxvYWRBZnRlclN1Ym1pdDpmYWxzZSxcbiAgICBcdFx0XHRzYXZla2V5OiBbdHJ1ZSwxM10sXG4gICAgXHRcdFx0Y2xvc2VPbkVzY2FwZTp0cnVlLFxuICAgIFx0XHRcdGNsb3NlQWZ0ZXJBZGQ6dHJ1ZSxcbiAgICBcdFx0XHRhZnRlclNob3dGb3JtOmZ1bmN0aW9uKCl7XG4gICAgXHRcdFx0XHQkKFwiI2x1aV9cIitncmlkWzBdLmlkKS5oaWRlKCk7XG4gICAgXHRcdFx0fVxuICAgIFx0XHR9O1xuICAgIFx0dmFyIGRlbFNldHRpbmdzID0ge1xuICAgIFx0XHRcdHByb2Nlc3Npbmc6dHJ1ZVxuICAgIFx0XHR9O1xuICAgIFx0XHRcbiAgICBcdHZhciBpZD1mb2xkZXJJZDtcbiAgICBcdFxuICAgIFx0dmFyIHZpZXdFbnRyaWVzVXJsID0gY21pc19yb290Kyc/b2JqZWN0SWQ9JytpZCsnJmNtaXNzZWxlY3Rvcj1jaGlsZHJlbic7XG4gICAgXHR2YXIgc3lzX2ZpZWxkcz1bJ2lkJywgJ3R5cGUnLCAndGl0bGUnLCAnZGVzY3JpcHRpb24nLCAnbW9kaWZpZXInLCAnbW9kaWZpY2F0aW9uVGltZScsJ2F1dG9yJywnY3JlYXRpb25UaW1lJ107XG4gICAgXHR2YXIgZmllbGRzPVsnaWQnLCAndGl0bGUnLCAnZGVzY3JpcHRpb24nLCAnbW9kaWZpZXInLCAnbW9kaWZpY2F0aW9uVGltZSddO1xuICAgIFx0dmFyIHJvd1NpemU9cGFnaW5hdGlvbkNvbmZpZy5wYWdlU2l6ZTtcbiAgICBcdHZhciBjb2x1bW5zID1bXG4gICAgXHRcdFx0eyBuYW1lOiAnaWQnLCBrZXk6IHRydWUsIHdpZHRoOiA3NSwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6b2JqZWN0SWQudmFsdWUnfSxcbiAgICBcdFx0XHR7IG5hbWU6ICd0eXBlJywgbGFiZWwgOiBcItCi0LjQv1wiLHdpZHRoOiAxMDAsIGpzb25tYXA6ICdvYmplY3QucHJvcGVydGllcy5jbWlzOm9iamVjdFR5cGVJZC52YWx1ZScgfSxcbiAgICBcdFx0XHR7IG5hbWU6ICd0aXRsZScsIGxhYmVsIDogXCLQl9Cw0LPQvtC70L7QstC+0LpcIix3aWR0aDogMTUwLCBqc29ubWFwOiAnb2JqZWN0LnByb3BlcnRpZXMuY21pczpuYW1lLnZhbHVlJyB9LFxuICAgIFx0XHRcdHsgbmFtZTogJ2Rlc2NyaXB0aW9uJywgbGFiZWwgOiBcItCe0L/QuNGB0LDQvdC40LVcIiwgd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6ZGVzY3JpcHRpb24udmFsdWUnIH0sXG4gICAgXHRcdFx0eyBuYW1lOiAnYXV0aG9yJywgbGFiZWwgOiBcItCh0L7Qt9C00LDQu1wiLCB3aWR0aDogMTUwLCBqc29ubWFwOiAnb2JqZWN0LnByb3BlcnRpZXMuY21pczpjcmVhdGVkQnkudmFsdWUnIH0sXG4gICAgXHRcdFx0eyBuYW1lOiAnY3JlYXRpb25UaW1lJywgbGFiZWwgOiBcItCU0LDRgtCwINGB0L7Qt9C00LDQvdC40Y9cIiwgd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6Y3JlYXRpb25EYXRlLnZhbHVlJyAsIFxuICAgIFx0XHRcdFx0XHRcdGZvcm1hdHRlcjonZGF0ZScsIGZvcm1hdG9wdGlvbnM6IHtzcmNmb3JtYXQ6ICdVLzEwMDAnLCBuZXdmb3JtYXQ6J2QubS5ZIEg6aSd9LFxuICAgIFx0XHRcdFx0XHRcdHNvcnR0eXBlOidkYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hvcHRpb25zOiBkYXRlT3B0aW9uc1xuICAgIFx0XHRcdH0sXG4gICAgXHRcdFx0eyBuYW1lOiAnbW9kaWZpZXInLCBsYWJlbCA6IFwi0JjQt9C80LXQvdC40LtcIiwgd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6bGFzdE1vZGlmaWVkQnkudmFsdWUnIH0sXG4gICAgXHRcdFx0eyBuYW1lOiAnbW9kaWZpY2F0aW9uVGltZScsIGxhYmVsIDogXCLQlNCw0YLQsCDQuNC30LzQtdC90LXQvdC40Y9cIiwgd2lkdGg6IDE1MCwganNvbm1hcDogJ29iamVjdC5wcm9wZXJ0aWVzLmNtaXM6bGFzdE1vZGlmaWNhdGlvbkRhdGUudmFsdWUnLCBcbiAgICBcdFx0XHRcdFx0XHRmb3JtYXR0ZXI6J2RhdGUnLCBmb3JtYXRvcHRpb25zOiB7c3JjZm9ybWF0OiAnVS8xMDAwJywgbmV3Zm9ybWF0OidkLm0uWSBIOmknfSxcbiAgICBcdFx0XHRcdFx0XHRzb3J0dHlwZTonZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNob3B0aW9uczogZGF0ZU9wdGlvbnNcbiAgICBcdFx0XHR9XG4gICAgXHRcdF07XG4gICAgXHRjb25zb2xlLmxvZyh2aWV3ZGF0YSk7XG4gICAgXHRpZiAodmlld2RhdGEhPW51bGwpe1xuICAgIFx0XHR2aWV3RW50cmllc1VybCA9IHZpZXdkYXRhLmRhdGEucXVlcnkrJz9maWVsZHM9JztcbiAgICBcdFx0ZmllbGRzPVtdO1xuICAgIFx0XHRjb2x1bW5zPVtdO1xuICAgIFx0XHQkLmVhY2godmlld2RhdGEuZGF0YS5jb2x1bW5EZXNjcmlwdGlvbnMsIGZ1bmN0aW9uKGksaXRlbSl7XG4gICAgXHRcdFx0XG4gICAgXHRcdFx0aWYgKGl0ZW0udmlzaWJsZSE9ZmFsc2Upe1xuICAgIFx0XHRcdFx0dmFyIGNvbFdpZHRoID0gMTQwO1xuICAgIFx0XHRcdFx0aWYgKGl0ZW0ud2lkdGgpIGNvbFdpZHRoID0gcGFyc2VJbnQoaXRlbS53aWR0aCk7XG4gICAgXHRcdFx0XHR2YXIgZmllbGRPcHMgPSB7XCJuYW1lXCI6IGl0ZW0uZmllbGQsIFwibGFiZWxcIjogaXRlbS5uYW1lLCBcIndpZHRoXCI6IGNvbFdpZHRofTtcbiAgICBcdFx0XHRcdGlmIChpdGVtLnNvcnRGaWVsZCkge2ZpZWxkT3BzLmluZGV4ID0gaXRlbS5zb3J0RmllbGR9XG4gICAgXHRcdFx0XHRpZiAoJC5pbkFycmF5KGl0ZW0uZmllbGQsIHN5c19maWVsZHMpPT0tMSl7XG4gICAgXHRcdFx0XHRcdGZpZWxkT3BzLmpzb25tYXA9XCJkYXRhLlwiK2l0ZW0uZmllbGQ7XG4gICAgXHRcdFx0XHRcdGZpZWxkcy5wdXNoKGl0ZW0uZmllbGQpO1xuICAgIFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0aWYgKGl0ZW0udHlwZT09J0lOVEVHRVInKSBmaWVsZE9wcy5zZWFyY2hvcHRpb25zPXtzb3B0OiBbXCJndFwiLFwibHRcIixcImVxXCJdIH07XG4gICAgXHRcdFx0XHRpZiAoaXRlbS50eXBlPT0nREFURScpIHtcbiAgICBcdFx0XHRcdFx0ZmllbGRPcHMuc29ydHR5cGU9J2RhdGUnO1xuICAgIFx0XHRcdFx0XHRmaWVsZE9wcy5zZWFyY2hvcHRpb25zPWRhdGVPcHRpb25zO1xuICAgIFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0Y29sdW1ucy5wdXNoKGZpZWxkT3BzKTtcbiAgICBcdFx0XHR9XG4gICAgXHRcdH0pO1xuICAgIFx0XHRjb25zb2xlLmxvZyhjb2x1bW5zKTtcbiAgICBcdFx0dmlld0VudHJpZXNVcmwgKz1maWVsZHMuam9pbigpO1xuICAgIFx0XHR2aWV3RW50cmllc1VybCArPScmc2l6ZT0nK3Jvd1NpemU7XG4gICAgXHRcdGNvbnNvbGUubG9nKHZpZXdFbnRyaWVzVXJsKTtcbiAgICBcdH1cbiAgICBcdHZhciBmaXhHcmlkV2lkdGggPSBmdW5jdGlvbiAoZ3JpZCkge1xuICAgIFx0ICAgIHZhciBndmlld1Njcm9sbFdpZHRoID0gZ3JpZFswXS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5zY3JvbGxXaWR0aDtcbiAgICBcdCAgICB2YXIgbWFpbldpZHRoID0galF1ZXJ5KCcjbWFpbicpLndpZHRoKCk7XG4gICAgXHQgICAgdmFyIGdyaWRTY3JvbGxXaWR0aCA9IGdyaWRbMF0uc2Nyb2xsV2lkdGg7XG4gICAgXHQgICAgdmFyIGh0YWJsZSA9IGpRdWVyeSgndGFibGUudWktanFncmlkLWh0YWJsZScsIGdyaWRbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUpO1xuICAgIFx0ICAgIHZhciBzY3JvbGxXaWR0aCA9IGdyaWRTY3JvbGxXaWR0aDtcbiAgICBcdCAgICBpZiAoaHRhYmxlLmxlbmd0aCA+IDApIHtcbiAgICBcdCAgICAgICAgdmFyIGhkaXZTY3JvbGxXaWR0aCA9IGh0YWJsZVswXS5zY3JvbGxXaWR0aDtcbiAgICBcdCAgICAgICAgaWYgKChncmlkU2Nyb2xsV2lkdGggPCBoZGl2U2Nyb2xsV2lkdGgpKVxuICAgIFx0ICAgICAgICAgICAgc2Nyb2xsV2lkdGggPSBoZGl2U2Nyb2xsV2lkdGg7IC8vIG1heCAoZ3JpZFNjcm9sbFdpZHRoLCBoZGl2U2Nyb2xsV2lkdGgpXG4gICAgXHQgICAgfVxuICAgIFx0ICAgIGlmIChndmlld1Njcm9sbFdpZHRoICE9IHNjcm9sbFdpZHRoIHx8IHNjcm9sbFdpZHRoID4gbWFpbldpZHRoKSB7XG4gICAgXHQgICAgICAgIHZhciBuZXdHcmlkV2lkdGggPSAoc2Nyb2xsV2lkdGggPD0gbWFpbldpZHRoKT8gc2Nyb2xsV2lkdGg6IG1haW5XaWR0aDsgIC8vIG1pbiAoc2Nyb2xsV2lkdGgsIG1haW5XaWR0aClcbiAgICBcdCAgICAgICAgLy8gaWYgdGhlIGdyaWQgaGFzIG5vIGRhdGEsIGdyaWRTY3JvbGxXaWR0aCBjYW4gYmUgbGVzcyB0aGVuIGhkaXZbMF0uc2Nyb2xsV2lkdGhcbiAgICBcdCAgICAgICAgaWYgKG5ld0dyaWRXaWR0aCAhPSBndmlld1Njcm9sbFdpZHRoKXtcbiAgICBcdCAgICAgICAgICAgIGdyaWQuanFHcmlkKFwic2V0R3JpZFdpZHRoXCIsIG5ld0dyaWRXaWR0aCk7XG4gICAgXHQgICAgICAgICAgICBjb25zb2xlLmxvZyhcIldpZHRoIGZpeGVkLlwiKVxuICAgIFx0ICAgICAgICB9XG4gICAgXHQgICAgfVxuICAgIFx0fTtcblxuICAgIFx0dmFyIGZpeEdyaWRIZWlnaHQgPSBmdW5jdGlvbiAoZ3JpZCkge1xuICAgIFx0ICAgIHZhciBndmlld05vZGUgPSBncmlkWzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgIFx0ICAgIC8vdmFyIGd2aWV3ID0gZ3JpZC5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKTtcbiAgICBcdCAgICAvL3ZhciBiZGl2ID0galF1ZXJ5KFwiI2d2aWV3X1wiICsgZ3JpZFswXS5pZCArIFwiIC51aS1qcWdyaWQtYmRpdlwiKTtcbiAgICBcdCAgICB2YXIgYmRpdiA9IGpRdWVyeShcIi51aS1qcWdyaWQtYmRpdlwiLCBndmlld05vZGUpO1xuICAgIFx0ICAgIGlmIChiZGl2Lmxlbmd0aCkge1xuICAgIFx0ICAgICAgICB2YXIgZGVsdGEgPSBiZGl2WzBdLnNjcm9sbEhlaWdodCAtIGJkaXZbMF0uY2xpZW50SGVpZ2h0O1xuICAgIFx0ICAgICAgICB2YXIgaGVpZ2h0ID0gZ3JpZC5oZWlnaHQoKTtcbiAgICBcdCAgICAgICAgaWYgKGRlbHRhICE9PSAwICYmIGhlaWdodCAmJiAoaGVpZ2h0LWRlbHRhPjApKSB7XG4gICAgXHQgICAgICAgICAgICBncmlkLnNldEdyaWRIZWlnaHQoaGVpZ2h0LWRlbHRhKTtcbiAgICBcdCAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSGVpZ2h0IGZpeGVkLlwiKVxuICAgIFx0ICAgICAgICBcbiAgICBcdCAgICAgICAgfVxuICAgIFx0ICAgIH1cbiAgICBcdH07XG5cbiAgICBcdHZhciBmaXhHcmlkU2l6ZSA9IGZ1bmN0aW9uIChncmlkKSB7XG4gICAgXHQgICAgZml4R3JpZFdpZHRoKGdyaWQpO1xuICAgIFx0ICAgIGZpeEdyaWRIZWlnaHQoZ3JpZCk7XG4gICAgXHR9O1xuICAgIFx0XG4gICAgXHQkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcbiAgICBcdFx0Zml4R3JpZFNpemUoJCgnI2pxR3JpZCcpKTtcbiAgICBcdH0pO1xuXG4gICAgXHRcbiAgICBcdCQoXCIjanFHcmlkXCIpLmpxR3JpZCh7XG4gICAgXHRcdHVybDogdmlld0VudHJpZXNVcmwsXG4gICAgXHRcdG10eXBlOiBcIkdFVFwiLFxuICAgIFx0XHRkYXRhdHlwZTogXCJqc29uXCIsXG4gICAgXHRcdHBhZ2U6IDEsXG4gICAgXHRcdGNvbE1vZGVsOiBjb2x1bW5zLFxuICAgIFx0XHRhdXRvd2lkdGg6IHRydWUsXG4gICAgXHRcdHNocmlua1RvRml0OiB0cnVlLFxuICAgIFx0XHRoZWlnaHQ6JzEwMCUnLFxuICAgIFx0XHRtYXhIZWlnaHQ6IDUwMCxcbiAgICBcdFx0cm93TnVtOiBwYWdpbmF0aW9uQ29uZmlnLnBhZ2VTaXplLFxuICAgIFx0XHQvL2d1aVN0eWxlOiBcImJvb3RzdHJhcFwiLFxuICAgIFx0XHRzZXJpYWxpemVHcmlkRGF0YTogZnVuY3Rpb24ocG9zdERhdGEpIHtcbiAgICBcdFx0XHRpZiAodHlwZW9mKHBvc3REYXRhLnBhZ2UpID09PSBcIm51bWJlclwiKSB7XG4gICAgXHRcdFx0XHRwb3N0RGF0YS5wYWdlLS07IC8vIGRlY3JlYXNlIHRoZSB2YWx1ZSBvZiBwYWdlIGJlZm9yZSBzZW5kaW5nIHRvIHRoZSBzZXJ2ZXJcbiAgICBcdFx0XHR9XG4gICAgXHRcdFx0aWYgKHBvc3REYXRhLnNpZHghPW51bGwgJiYgcG9zdERhdGEuc2lkeCE9Jycpe1xuICAgIFx0XHRcdFx0cG9zdERhdGEuc29ydD1wb3N0RGF0YS5zaWR4K1wiLFwiK3Bvc3REYXRhLnNvcmQ7XG4gICAgXHRcdFx0fWVsc2V7XG4gICAgXHRcdFx0XHRwb3N0RGF0YS5zb3J0PVwiSUQsREVTQ1wiXG4gICAgXHRcdFx0fVxuICAgIFx0XHRcdHJldHVybiBwb3N0RGF0YTtcbiAgICBcdFx0fSxcbiAgICBcdFx0anNvblJlYWRlcjoge1xuICAgIFx0XHRcdHJlcGVhdGl0ZW1zOiBmYWxzZSxcbiAgICBcdFx0XHRyb290OiBmdW5jdGlvbihkYXRhKXtcbiAgICBcdFx0XHRcdGlmIChkYXRhLmNvbnRlbnQpe1xuICAgIFx0XHRcdFx0XHRyZXR1cm4gZGF0YS5jb250ZW50O1xuICAgIFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0cmV0dXJuIGRhdGEub2JqZWN0cztcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdHRvdGFsOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgXHRcdFx0XHRyZXR1cm4gZGF0YS50b3RhbFBhZ2VzO1xuICAgIFx0XHRcdH0sXG4gICAgXHRcdFx0cGFnZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgXHRcdFx0XHRyZXR1cm4gZGF0YS5udW1iZXIrMTtcbiAgICBcdFx0XHR9LFxuICAgIFx0XHRcdHJlY29yZHM6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIFx0XHRcdFx0aWYoZGF0YS50b3RhbEVsZW1lbnRzKXtcbiAgICBcdFx0XHRcdFx0cmV0dXJuIGRhdGEudG90YWxFbGVtZW50cztcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHRcdHJldHVybiBkYXRhLm51bUl0ZW1zO1xuICAgIFx0XHRcdH0gXG4gICAgXHRcdH0sXG4gICAgXHRcdG9uU2VsZWN0Um93OiBmdW5jdGlvbihpZHMpIHsgXG4gICAgICAgICAgICAgICAgaWYoaWRzID09IG51bGwpIHtcbiAgICBcdFx0XHRcdGxvYWRHcmlkQ01JUyhcIjBcIik7XG4gICAgXHRcdFx0fWVsc2V7XG4gICAgXHRcdFx0XHR2YXIgcm93RGF0YSA9ICQoXCIjanFHcmlkXCIpLmdldFJvd0RhdGEoaWRzKTtcbiAgICBcdFx0XHRcdGNvbnNvbGUubG9nKFwiVHlwZTogXCIrcm93RGF0YVsndHlwZSddKVxuICAgIFx0XHRcdFx0aWYgKHJvd0RhdGFbJ3R5cGUnXT09XCJjbWlzOmZvbGRlclwiKXtcbiAgICBcdFx0XHRcdFx0JHNjb3BlLmxvYWRHcmlkKGlkcyk7XG4gICAgXHRcdFx0XHR9ZWxzZXtcbiAgICBcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJyZXF1ZXN0IGRvYyBcIitpZHMpO1xuICAgIFx0XHRcdFx0XHR2YXIgZG9jaWQgPSBwYXJzZUludChpZHMpO1xuICAgIFx0XHRcdFx0XHQkc2NvcGUub3BlbkRvY3VtZW50KFRvZG9zLCBkb2NpZCk7XG4gICAgXHRcdFx0XHR9XG4gICAgXHRcdFx0fVxuICAgIFx0XHR9LFxuICAgIFx0XHRzY3JvbGw6IDEsIC8vIHNldCB0aGUgc2Nyb2xsIHByb3BlcnR5IHRvIDEgdG8gZW5hYmxlIHBhZ2luZyB3aXRoIHNjcm9sbGJhciAtIHZpcnR1YWwgbG9hZGluZyBvZiByZWNvcmRzXG4gICAgXHRcdGVtcHR5cmVjb3JkczogJ1Njcm9sbCB0byBib3R0b20gdG8gcmV0cmlldmUgbmV3IHBhZ2UnLCAvLyB0aGUgbWVzc2FnZSB3aWxsIGJlIGRpc3BsYXllZCBhdCB0aGUgYm90dG9tIFxuICAgIFx0XHRwYWdlcjogXCIjanFHcmlkUGFnZXJcIixcbiAgICBcdFx0bG9hZENvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICBcdFx0XHRmaXhHcmlkU2l6ZSgkKCcjanFHcmlkJykpO1xuICAgIFx0XHRcdCQoXCJ0ci5qcWdyb3dcIiwgdGhpcykuY29udGV4dE1lbnUoJ2ZvbGRlck1lbnUnLCB7XG4gICAgXHRcdFx0XHRiaW5kaW5nczoge1xuICAgIFx0XHRcdFx0XHQnZWRpdCc6IGZ1bmN0aW9uKHRyaWdnZXIpIHtcbiAgICBcdFx0XHRcdFx0XHQvLyB0cmlnZ2VyIGlzIHRoZSBET00gZWxlbWVudCAoXCJ0ci5qcWdyb3dcIikgd2hpY2ggYXJlIHRyaWdnZXJlZFxuICAgIFx0XHRcdFx0XHRcdCQoJyNqcUdyaWQnKS5lZGl0R3JpZFJvdyh0cmlnZ2VyLmlkLCBlZGl0U2V0dGluZ3MpO1xuICAgIFx0XHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0XHQnYWRkJzogZnVuY3Rpb24oLyp0cmlnZ2VyKi8pIHtcbiAgICBcdFx0XHRcdFx0XHQkKCcjanFHcmlkJykuZWRpdEdyaWRSb3coXCJuZXdcIiwgYWRkU2V0dGluZ3MpO1xuICAgIFx0XHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0XHQnZGVsJzogZnVuY3Rpb24odHJpZ2dlcikge1xuICAgIFx0XHRcdFx0XHRcdGlmICgkKCcjZGVsJykuaGFzQ2xhc3MoJ3VpLXN0YXRlLWRpc2FibGVkJykgPT09IGZhbHNlKSB7XG4gICAgXHRcdFx0XHRcdFx0XHQvLyBkaXNhYmxlZCBpdGVtIGNhbiBkbyBiZSBjaG9vc2VkXG4gICAgXHRcdFx0XHRcdFx0XHQkKCcjanFHcmlkJykuZGVsR3JpZFJvdyh0cmlnZ2VyLmlkLCBkZWxTZXR0aW5ncyk7XG4gICAgXHRcdFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0XHR9XG4gICAgXHRcdFx0XHR9LFxuICAgIFx0XHRcdFx0b25Db250ZXh0TWVudTogZnVuY3Rpb24oZXZlbnQvKiwgbWVudSovKSB7XG4gICAgXHRcdFx0XHRcdHZhciByb3dJZCA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwidHIuanFncm93XCIpLmF0dHIoXCJpZFwiKTtcbiAgICBcdFx0XHRcdFx0Ly9ncmlkLnNldFNlbGVjdGlvbihyb3dJZCk7XG4gICAgXHRcdFx0XHRcdC8vIGRpc2FibGUgbWVudSBmb3Igcm93cyB3aXRoIGV2ZW4gcm93aWRzXG4gICAgXHRcdFx0XHRcdCQoJyNkZWwnKS5hdHRyKFwiZGlzYWJsZWRcIixOdW1iZXIocm93SWQpJTIgPT09IDApO1xuICAgIFx0XHRcdFx0XHRpZiAoTnVtYmVyKHJvd0lkKSUyID09PSAwKSB7XG4gICAgXHRcdFx0XHRcdFx0JCgnI2RlbCcpLmF0dHIoXCJkaXNhYmxlZFwiLFwiZGlzYWJsZWRcIikuYWRkQ2xhc3MoJ3VpLXN0YXRlLWRpc2FibGVkJyk7XG4gICAgXHRcdFx0XHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0XHRcdFx0JCgnI2RlbCcpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKS5yZW1vdmVDbGFzcygndWktc3RhdGUtZGlzYWJsZWQnKTtcbiAgICBcdFx0XHRcdFx0fVxuICAgIFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9KTtcbiAgICBcdFx0fVxuICAgIFx0fSk7XG4gICAgXHQkKCcjanFHcmlkJykubmF2R3JpZChcIiNqcUdyaWRQYWdlclwiLCB7ICAgICAgICAgICAgICAgIFxuICAgIFx0XHRzZWFyY2g6IHRydWUsIC8vIHNob3cgc2VhcmNoIGJ1dHRvbiBvbiB0aGUgdG9vbGJhclxuICAgIFx0XHRhZGQ6IGZhbHNlLFxuICAgIFx0XHRlZGl0OiBmYWxzZSxcbiAgICBcdFx0ZGVsOiBmYWxzZSxcbiAgICBcdFx0cmVmcmVzaDogdHJ1ZVxuICAgIFx0XHR9LFxuICAgIFx0XHR7fSwgLy8gZWRpdCBvcHRpb25zXG4gICAgXHRcdHt9LCAvLyBhZGQgb3B0aW9uc1xuICAgIFx0XHR7fSwgLy8gZGVsZXRlIG9wdGlvbnNcbiAgICBcdFx0eyBtdWx0aXBsZVNlYXJjaDogdHJ1ZSwgdW5pcXVlU2VhcmNoRmllbGRzIDogdHJ1ZSwgbXVsdGlwbGVHcm91cCA6IHRydWV9XG4gICAgXHQpO1xuXHRcdCAgfVxuXHRcdCAgXG5cblx0XHQgICRzY29wZS5sb2FkR3JpZCgnMCcpO1xuICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdBZGRUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBUb2Rvcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBhZGQgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB7fTtcblxuICAgICAgICAgICAgJHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50b2RvRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGFkZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IGFkZGVkLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZG8uZGF0YT1KU09OLnBhcnNlKCRzY29wZS50b2RvLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBUb2Rvcy5zYXZlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdEZWxldGVUb2RvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRtb2RhbEluc3RhbmNlJywgJyRzdGF0ZScsICdUb2RvcycsICdkZWxldGVkVG9kbycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgVG9kb3MsIGRlbGV0ZWRUb2RvKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9kbyA9IGRlbGV0ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8uaW5kZXgnLCB7fSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFRvZG9zLmRlbGV0ZSgkc2NvcGUudG9kbywgb25TdWNjZXNzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKSAgICAgICAgXG4gICAgLmNvbnRyb2xsZXIoJ0VkaXRGb3JtQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICd1cGRhdGVkVG9kbycsICdUb2RvcycsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCB1cGRhdGVkVG9kbywgVG9kb3MpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVwZGF0ZWRUb2RvKTtcbiAgICAgICAgICAgICRzY29wZS50b2RvID0gdXBkYXRlZFRvZG87XG4gICAgICAgICAgICB2YXIgdHlwZVVybD1cIi9hcGkvc3lzdGVtL3MvXCIrJHNjb3BlLnRvZG8udHlwZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJC5hamF4XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiB0eXBlVXJsLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICBcdCRzY29wZS5zY2hlbWEgPSByZXMuZGF0YS5zY2hlbWE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJHNjb3BlLmZvcm0gPSBbXG5cdCAgICBcdCAgICBcIipcIlxuXHQgICAgXHQgIF07XG5cdFxuICAgICAgICAgICAgJHNjb3BlLm1vZGVsID0gJHNjb3BlLnRvZG8uZGF0YTtcbiAgICAgICAgICAgICRzY29wZS5zYXZlVG9kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudG9kb0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbih1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3RvZG8udmlldycsIHt0b2RvSWQ6IHVwZGF0ZWQuaWR9LCB7IHJlbG9hZDogdHJ1ZSwgaW5oZXJpdDogdHJ1ZSwgbm90aWZ5OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG9kby5kYXRhPSRzY29wZS5tb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgVG9kb3MudXBkYXRlKCRzY29wZS50b2RvLCBvblN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgIC5jb250cm9sbGVyKCdWaWV3VG9kb0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckc3RhdGUnLCAnJG1vZGFsJywgJ3ZpZXdlZFRvZG8nLFxuICAgICAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJG1vZGFsLCB2aWV3ZWRUb2RvKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIHZpZXcgdG9kbyBlbnRyeSBwYWdlLicpO1xuICAgICAgICAgICAgJHNjb3BlLnRvZG8gPSB2aWV3ZWRUb2RvO1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0VkaXRQYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwidG9kby5lZGl0XCIsIHt0b2RvSWQ6ICRzY29wZS50b2RvLmlkfSwgeyByZWxvYWQ6IHRydWUsIGluaGVyaXQ6IHRydWUsIG5vdGlmeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRzY29wZS5zaG93RWRpdEZvcm1QYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwidG9kby5lZGl0Zm9ybVwiLCB7dG9kb0lkOiAkc2NvcGUudG9kby5pZH0sIHsgcmVsb2FkOiB0cnVlLCBpbmhlcml0OiB0cnVlLCBub3RpZnk6IHRydWUgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0RlbGV0ZURpYWxvZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZnJvbnRlbmQvcGFydGlhbHMvdG9kby9kZWxldGUtdG9kby1tb2RhbC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0RlbGV0ZVRvZG9Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZFRvZG86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnRvZG87XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ2FwcC50b2RvLnNlcnZpY2VzJywgWyduZ1Jlc291cmNlJ10pXG4gICAgLmZhY3RvcnkoJ1RvZG9zJywgWyckcmVzb3VyY2UnLCAnTm90aWZpY2F0aW9uU2VydmljZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSwgTm90aWZpY2F0aW9uU2VydmljZSkge1xuICAgICAgICB2YXIgYXBpID0gJHJlc291cmNlKCcvYXBpL2RvY3MvOmlkJywge1wiaWRcIjogXCJAaWRcIn0sIHtcbiAgICAgICAgICAgIHF1ZXJ5OiAge21ldGhvZDogJ0dFVCcsIHBhcmFtczoge30sIGlzQXJyYXk6IGZhbHNlfSxcbiAgICAgICAgICAgIGdldDogICAge21ldGhvZDogJ0dFVCd9LFxuICAgICAgICAgICAgc2F2ZToge21ldGhvZDogJ1BPU1QnfSxcbiAgICAgICAgICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCd9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWxldGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcGkuZGVsZXRlKHRvZG8sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmRlbGV0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcXVlcnk6IGZ1bmN0aW9uKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5xdWVyeSh7cGFnZTogcGFnZU51bWJlciwgc2l6ZTogcGFnZVNpemUsIHNvcnQ6ICdJRCxERVNDJ30pLiRwcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24odG9kb0lkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQoe2lkOiB0b2RvSWR9KS4kcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzYXZlOiBmdW5jdGlvbih0b2RvLCBzdWNjZXNzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBhcGkuc2F2ZSh0b2RvLCBmdW5jdGlvbihhZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLmFkZC5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGFkZGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHRvZG8sIHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUodG9kbywgZnVuY3Rpb24odXBkYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlLmZsYXNoTWVzc2FnZSgndG9kby5ub3RpZmljYXRpb25zLnVwZGF0ZS5zdWNjZXNzJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnZGVtbycsIFtcclxuICAgICdibHVlaW1wLmZpbGV1cGxvYWQnXHJcbl0pXHJcbiAgICAuY29uZmlnKFtcclxuICAgICAgICAnJGh0dHBQcm92aWRlcicsICdmaWxlVXBsb2FkUHJvdmlkZXInLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyLCBmaWxlVXBsb2FkUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgZGVsZXRlICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtUmVxdWVzdGVkLVdpdGgnXTtcclxuICAgICAgICAgICAgZmlsZVVwbG9hZFByb3ZpZGVyLmRlZmF1bHRzLnJlZGlyZWN0ID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZShcclxuICAgICAgICAgICAgICAgIC9cXC9bXlxcL10qJC8sXHJcbiAgICAgICAgICAgICAgICAnL2NvcnMvcmVzdWx0Lmh0bWw/JXMnXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgXSlcclxuXHJcbiAgICAuY29udHJvbGxlcignRGVtb0ZpbGVVcGxvYWRDb250cm9sbGVyJywgW1xyXG4gICAgICAgICckc2NvcGUnLCAnJGh0dHAnLCAnJGZpbHRlcicsICckd2luZG93JyxcclxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCkge1xyXG4gICAgICAgICAgICAkc2NvcGUub3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHVybDogdXJsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgXSlcclxuXHJcbiAgICAuY29udHJvbGxlcignRmlsZURlc3Ryb3lDb250cm9sbGVyJywgW1xyXG4gICAgICAgICckc2NvcGUnLCAnJGh0dHAnLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWxlID0gJHNjb3BlLmZpbGUsXHJcbiAgICAgICAgICAgICAgICBzdGF0ZTtcclxuICAgICAgICAgICAgaWYgKGZpbGUudXJsKSB7XHJcbiAgICAgICAgICAgICAgICBmaWxlLiRzdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZmlsZS4kZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9ICdwZW5kaW5nJztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGZpbGUuZGVsZXRlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IGZpbGUuZGVsZXRlVHlwZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gJ3Jlc29sdmVkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jbGVhcihmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAncmVqZWN0ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZpbGUuJGNhbmNlbCAmJiAhZmlsZS5faW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGZpbGUuJGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xlYXIoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==